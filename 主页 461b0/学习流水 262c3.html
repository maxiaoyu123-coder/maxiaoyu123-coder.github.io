<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>å­¦ä¹ æµæ°´</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	text-indent: -1.7em;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

.simple-table {
	margin-top: 1em;
	font-size: 0.875rem;
}

.simple-table-header {
	background: rgb(247, 246, 243);
	color: black;
	font-weight: 500;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	max-height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.highlight-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.highlight-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.highlight-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.highlight-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.highlight-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.highlight-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.highlight-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.highlight-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.highlight-gray_background {
	background: rgba(241, 241, 239, 1);
}
.highlight-brown_background {
	background: rgba(244, 238, 238, 1);
}
.highlight-orange_background {
	background: rgba(251, 236, 221, 1);
}
.highlight-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.highlight-teal_background {
	background: rgba(237, 243, 236, 1);
}
.highlight-blue_background {
	background: rgba(231, 243, 248, 1);
}
.highlight-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.highlight-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.highlight-red_background {
	background: rgba(253, 235, 236, 1);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.block-color-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.block-color-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.block-color-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.block-color-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.block-color-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.block-color-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.block-color-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.block-color-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.block-color-gray_background {
	background: rgba(241, 241, 239, 1);
}
.block-color-brown_background {
	background: rgba(244, 238, 238, 1);
}
.block-color-orange_background {
	background: rgba(251, 236, 221, 1);
}
.block-color-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.block-color-teal_background {
	background: rgba(237, 243, 236, 1);
}
.block-color-blue_background {
	background: rgba(231, 243, 248, 1);
}
.block-color-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.block-color-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.block-color-red_background {
	background: rgba(253, 235, 236, 1);
}
.select-value-color-pink { background-color: rgba(245, 224, 233, 1); }
.select-value-color-purple { background-color: rgba(232, 222, 238, 1); }
.select-value-color-green { background-color: rgba(219, 237, 219, 1); }
.select-value-color-gray { background-color: rgba(227, 226, 224, 1); }
.select-value-color-opaquegray { background-color: rgba(255, 255, 255, 0.0375); }
.select-value-color-orange { background-color: rgba(250, 222, 201, 1); }
.select-value-color-brown { background-color: rgba(238, 224, 218, 1); }
.select-value-color-red { background-color: rgba(255, 226, 221, 1); }
.select-value-color-yellow { background-color: rgba(253, 236, 200, 1); }
.select-value-color-blue { background-color: rgba(211, 229, 239, 1); }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="262c366a-2e16-4184-a4ce-e9b9da1dd8d3" class="page sans"><header><h1 class="page-title">å­¦ä¹ æµæ°´</h1></header><div class="page-body"><nav id="fb5cb939-21dd-4ea4-8285-4384b518e36d" class="block-color-gray table_of_contents"><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#28e582a1-7003-4028-8137-70be4d1c20c9"><time>@October 9, 2021</time> </a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#567ded6a-aa01-4d76-b3de-14538e0f1387"><time>@October 10, 2021</time> </a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#d009a7a8-c101-45cc-a679-bc8dd08797be"><time>@October 11, 2021</time> </a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#154ac6f4-0821-406d-b6bf-5b7e4f4aaec8"><time>@October 12, 2021</time> </a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#386494fd-1ac9-40e9-9cbe-76226148b39c"><time>@October 13, 2021</time> </a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#3c4b83db-d603-4733-bee0-7291c0c70298"><time>@October 15, 2021</time> </a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#cc74bbbe-8b8d-43b3-a9fe-58ac97ca390d"><time>@October 16, 2021</time> </a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#b1d42d44-5ab9-4e26-ad4c-6f7106173213"><time>@October 17, 2021</time> </a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#8028c71f-3f8b-4b5f-9f22-d58bceccacf8"><time>@October 18, 2021</time> </a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#f2220418-7828-4ad2-9d0f-c01753dedc2d"><time>@October 19, 2021</time> </a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#9d6bae1b-06b0-4f85-9104-43784d275a0a"><time>@October 20, 2021</time> </a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#61765493-58ee-440d-b15f-24123826c436"><time>@October 25, 2021</time> </a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#2cc03372-05d9-4444-9014-b557ffdd6b70"><time>@October 26, 2021</time> </a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#929811b4-ac33-4ce0-ba07-b6c1808546ae"><time>@October 28, 2021</time> </a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#0f567f9b-780a-4125-b2bc-282e69265838"><time>@October 31, 2021</time> </a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#f8f94ff9-12fc-4e48-a91f-6ef93234058e"><time>@November 1, 2021</time> </a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#a3a4f1a1-e39e-4e6c-b42d-f9ec0854386f"><time>@November 6, 2021</time> </a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#0301a7b9-62f9-44ab-aa70-fcb685abea7d"><time>@November 23, 2021</time> </a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#ad25da08-8695-4c47-ac1d-d994c2347f98"><time>@November 24, 2021</time> </a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#acc3c882-0119-40b5-b648-8c0727539d0a"><time>@November 25, 2021</time> </a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#201b524b-e911-4e8a-a266-85c4e8bdaeef"><time>@December 3, 2021</time> </a></div></nav><h2 id="28e582a1-7003-4028-8137-70be4d1c20c9" class=""><time>@October 9, 2021</time> </h2><p id="35b684be-0b6b-48ac-ab54-6f700d98a2b0" class="">
</p><p id="2bb8bb5b-50fe-49a4-9200-9a84aa205757" class="block-color-teal_background">æ•´ç†çš„ï¼š<div class="indented"><p id="ccc89394-890b-4fbf-8ee5-5db1300fbec2" class="">âš ï¸æµè§ˆå™¨å‘é€çš„acceptå­—æ®µåªæ˜¯å»ºè®®å€¼ï¼ŒæœåŠ¡å™¨æ˜¯å¦ä½¿ç”¨è¿™ä¸ªå€¼ç”±æœåŠ¡ç«¯ç¨‹åºå†³å®šã€‚å¦‚æœæœåŠ¡ç«¯æŒ‰Restfulè§„èŒƒå¼€å‘æ¥å£çš„è¯ï¼Œå¯ä»¥è€ƒè™‘æ ¹æ®acceptçš„ä¸åŒå€¼è¿”å›ä¸åŒæ ¼å¼çš„å†…å®¹ã€‚åŒä¸€ä»½æ•°æ®å¯ä»¥æŒ‰json, xmlæ ¼å¼åˆ†åˆ«è¾“å‡ºã€‚</p><p id="7559fea6-2cb2-4157-9447-e3d405c9be24" class=""><mark class="highlight-orange">jenkinåœ¨shell docker buildæ—¶,é‡åˆ°permission deny,è¿™ä¹ˆè§£å†³:</mark><a href="https://www.cnblogs.com/ding2016/p/12988080.html">https://www.cnblogs.com/ding2016/p/12988080.html</a>  <a href="https://stackoverflow.com/questions/47854463/docker-got-permission-denied-while-trying-to-connect-to-the-docker-daemon-socke">https://stackoverflow.com/questions/47854463/docker-got-permission-denied-while-trying-to-connect-to-the-docker-daemon-socke</a>
insecureé—®é¢˜è¡¥å……åˆ°docker harbor</p><p id="b6e7dc55-38dc-40ea-9185-bf048e4d14a9" class="">ğŸ’¡æˆ‘è®¤ä¸ºä¼ä¸šè‡ªå·±å¼€å‘NPMç»„ä»¶éœ€è¦ä¼ åˆ°åˆ¶å“åº“, å› ä¸ºå¾ˆå¥½èƒ½æŸäº›åœºæ™¯ä¸‹ï¼Œå…¶ä»–ç»„ä»¶å¯¹å…¶æœ‰ä¾èµ–, æ•…å³ä½¿åšæˆé•œåƒ,ä¹Ÿéœ€è¦å…ˆä¸Šä¼ åˆ¶å“åº“å†ä½œé•œåƒã€‚</p><p id="d1769fd6-5a50-4fc5-a327-9b7401a830d0" class="">Jenkinsæ–°å‘ç°çš„ç”¨æ³•<div class="indented"><ul id="b334858c-2ca4-402e-b2c2-892f3627f503" class="bulleted-list"><li style="list-style-type:disc">ä½¿ç”¨httpRequestè®¿é—®APIæ¥å£,ä¿å­˜è‡³å˜é‡, é€šè¿‡jsonæˆ–yamlæ’ä»¶å˜æˆç»“æ„åŒ–æ•°æ®, å†è¿›è¡Œå¤„ç†</li></ul></div></p><p id="19f7d35f-acf5-49b2-834a-12da60340be8" class="">groovyè¯­æ³•ï¼Œåœ¨å®šä¹‰å‡½æ•°çš„æ—¶å€™, å½¢å‚å¯ä»¥è¿™æ ·è¢«æ˜¾å¼ç”³æ˜æ•°æ®ç±»å‹<div class="indented"><pre id="6983a5f7-b444-42c1-9569-3cc91692a32b" class="code code-wrap"><code>def å‡½æ•°(Map args = [:]){
}
ä¼ å‚è¿™æ ·
å‡½æ•°(
key1: value1,
key2: value2
)

</code></pre></div></p><p id="c066153b-f159-4a5b-a051-1a03dd22a904" class="">è·å–ShortCommitHash: <code>git log -n 1 --pretty=format:&#x27;%h&#x27;</code>
	</p></div></p><h2 id="567ded6a-aa01-4d76-b3de-14538e0f1387" class=""><time>@October 10, 2021</time> </h2><p id="e3e7a77c-3880-464d-ba9f-70715c0f8070" class="">vscodeå¦‚ä½•åˆ©ç”¨æ”¯æŒhelmçš„æ’ä»¶<div class="indented"><p id="776ba8af-2747-4b92-aef3-762f8b549891" class="">å°è¯•å®‰è£…helm  <div class="indented"><p id="7457d687-4d00-4fe7-9f99-b160a25eae15" class="">å‘ç°chocoæ˜¯win10 powershellä¸‹ç®¡ç†å·¥å…·ï¼Œå®‰è£…choco<code>iwr https://chocolatey.org/install.ps1 -UseBasicParsing | iex</code>ï¼Œ<div class="indented"><p id="11989651-9120-48c1-950f-853d503d4e85" class="">å‚è€ƒï¼š<a href="https://www.jianshu.com/p/be19a2bebc48">https://www.jianshu.com/p/be19a2bebc48</a></p><p id="ce42105c-1731-4ff0-9957-710dbadafc88" class="">chocoç½‘å€ï¼š<a href="https://community.chocolatey.org/">https://community.chocolatey.org/</a></p></div></p></div></p><p id="d60e3aca-d2d7-4eab-b03f-967be9fa97d7" class="">vscodeå®‰è£…äº†remoteæ’ä»¶ï¼Œå¯ä»¥è¿œç¨‹ç¼–è¾‘ï¼Œä½†ç›®å‰ä¸èƒ½åŒæ—¶ä½¿ç”¨helmæ’ä»¶çš„åŠŸèƒ½</p><p id="b6a3edc4-4caa-4d2e-9010-551b0279a909" class="">
</p></div></p><h1 id="d009a7a8-c101-45cc-a679-bc8dd08797be" class=""><time>@October 11, 2021</time> </h1><p id="518c2ff2-b0b2-404e-8fbd-bbed0c557804" class="">å­¦ä¹ <div class="indented"><p id="c285bbd8-1268-45f6-b6c3-5af5a1722197" class="">chartä¾èµ–ï¼š<a href="https://helm.sh/docs/chart_template_guide/subcharts_and_globals/">https://helm.sh/docs/chart_template_guide/subcharts_and_globals/</a></p><ul id="7e23c937-bded-47a2-803a-e107a9a2d602" class="bulleted-list"><li style="list-style-type:disc">subchartæ˜¯ç‹¬ç«‹çš„ä¸€ä¸ªchartï¼Œçˆ¶chartä¾èµ–å®ƒä½†å®ƒä¸ä¾èµ–çˆ¶chart<p id="79472882-b4db-4882-8c23-33eda144ab89" class="">ä¾‹å¦‚mychart/charts/mysubchart/ï¼Œè™½ç„¶mysubchartæ˜¯å­chartï¼Œä½†ä¾ç„¶å¯ç‹¬ç«‹åˆ›å»º<code>helm install --generate-name --dry-run --debug mychart/charts/mysubchart</code></p></li></ul><ul id="1b10a07d-a9aa-495e-ab48-866bf28d67c8" class="bulleted-list"><li style="list-style-type:disc">å­chartä¸å¯ç›´æ¥è®¿é—®çˆ¶chartçš„Valuesï¼Œç„¶çˆ¶chartçš„valueså¯ä¼ é€’åˆ°å­chartçš„valuesï¼Œå¯è¦†ç›–åŒåæˆ–åŠ å…¥æ–°çš„<mark class="highlight-orange">ï¼Œå¦‚æ­¤å­chartå¯é—´æ¥è®¿é—®åˆ°ã€‚</mark><p id="350f0a8c-e283-4fb2-807d-4cf7acf57245" class="">ä½œä¸ºç‹¬ç«‹çš„chartå®‰è£…ï¼Œå­chartä¸çˆ¶chartæ˜¯æ²¡æœ‰è”ç³»çš„ï¼Œæ•…æ— æ³•ä¼ é€’çˆ¶chartçš„valuesï¼Œåªæœ‰å®‰è£…çˆ¶chartæ‰æœ‰è”ç³»æ‰å¯ä¼ é€’ã€‚</p><pre id="32f4b1f1-fb8a-42b6-87f5-1c75cb100c9b" class="code code-wrap"><code>çˆ¶chartçš„valuesä¸­æŒ‡å®šå­chartçš„value
mysubchart:  #ä¸å­chartç›®å½•çš„åå­—ï¼Œå®ƒä½äºchartsç›®å½•ä¸­ã€‚è¿™ä¸ªå€¼åªèƒ½è¢«mysubchartè®¿é—®ï¼Œå…¶ä»–å­chartæ˜¯è®¿é—®ä¸åˆ°çš„
  dessert: ice cream

å­chartå°±åƒå¼•ç”¨è‡ªå·±çš„values
dessert: {{ .Values.dessert }}</code></pre></li></ul><ul id="b4673981-2329-4ef7-82f6-2c11d47c5f20" class="bulleted-list"><li style="list-style-type:disc">è€Œglobal valueså¯ä»¥è¢«æ‰€æœ‰chartè®¿é—®åˆ°<pre id="82b9aea0-cae7-4ef3-9568-132c98b441d8" class="code code-wrap"><code>çˆ¶chartçš„valuesä¸­æŒ‡å®šglobalçš„value
global:  #åªèƒ½è¢«mysubchartè®¿é—®ï¼Œå…¶ä»–å­chartæ˜¯è®¿é—®ä¸åˆ°çš„
  salad: caesar
 
æ‰€æœ‰chartéƒ½å¯å¼•ç”¨
dessert: {{ .Values.global.salad }}</code></pre></li></ul></div></p><p id="c2edb3ef-d266-4dd1-8a6b-89962c2549d4" class="">
</p><p id="d77f9ff3-3d41-42ad-81c1-6990b2f954d7" class="">ğŸ‘ï¸â€ğŸ—¨ï¸å…³äºæŒç»­äº¤ä»˜å’ŒæŒç»­é›†æˆçš„æ¦‚å¿µ<a href="https://dzone.com/articles/continuous-delivery-vs-continuous-deployment-an-ov">https://dzone.com/articles/continuous-delivery-vs-continuous-deployment-an-ov</a></p><p id="cdc42252-559c-4f07-804e-f9e77cc476b0" class="">
</p><p id="cdbfbfc2-f320-4260-844f-d85e45c11325" class="">å‘ç°ï¼š<div class="indented"><p id="aff6de4c-468f-4851-9c93-30ccd831840c" class="">åƒifï¼Œrangeï¼Œscopeæˆ–å˜é‡èµ‹å€¼çš„æ¨¡æ¿å‘½ä»¤ä¸æ›¿æ¢ä¸ºå€¼ï¼Œè¦ç¡®ä¿åœ¨æ¸²æŸ“åæ‰€åœ¨è¡Œè¢«åˆ é™¤ï¼Œè€Œå…¶ä»–éƒ½æ˜¯æ›¿æ¢ä¸ºå€¼ï¼Œ<code>{{æ¨¡æ¿å‘½ä»¤}}</code> æ•´ä¸ªåˆ é™¤ï¼Œç•™ä¸‹ç¼©è¿›çš„ç©ºæ ¼å’Œå›è½¦ç¬¦ï¼Œå€¼æ’å…¥ç¼©è¿›ä½ç½®åé¢</p><p id="399a9f4e-f5a6-481d-bf3b-e2502754c67e" class="block-color-teal">æœ‰ä¸€ç§å‡½æ•°å«<code>toYaml</code>å¾ˆå¥½ç”¨ï¼Œåœ¨ç‰ˆæœ¬3æŒ‡å—ä¸­æ²¡æœ‰ï¼Œåœ¨ç‰ˆæœ¬2æŒ‡å—æ‰¾åˆ°äº†ã€‚ä½œç”¨ï¼šValueså¯¹è±¡å¦‚æœæ˜¯åˆ—è¡¨æˆ–è€…mapï¼Œä¸èƒ½ç›´æ¥å¼•ç”¨ï¼Œå› ä¸ºå…¶ä¸­åŒ…å«å…ƒæ•°æ®(è¡¨ç¤ºæ•°æ®ç±»å‹)ï¼ŒtoYamlå¯è§£å†³ï¼Œå®ƒä»¥YAMLè¯­æ³•è§£æå…ƒæ•°æ®å¹¶å»é™¤å®ƒä»¬</p><pre id="ac3777cd-f872-4d23-8390-17199b431544" class="code code-wrap"><code>æ¯”å¦‚values.yamlæœ‰
labels:
 traffic-type: external
 traffic-type: internal

{{ .Values.labels | toYaml | trimSuffix &quot;\n&quot; | indent 4}} 
å®ƒå°†å…¶è§£æä¸ºmapç±»å‹ï¼Œæ•…å®ƒå‘ç°æœ‰é‡å¤çš„keyæ‰€ä»¥åªå†™å…¥ä¸€ä¸ªé”®å€¼å¯¹

æ¯”å¦‚
imagePullSecrets:
- name: secret1
- name: secret2

{{- with .Values.imagePullSecrets }}  
      imagePullSecrets:
        {{- toYaml . | nindent 8 }}  è§£æä¸ºlist
{{- end }}</code></pre><p id="5e22e695-525c-4aa8-bb1f-fa09db052c0d" class="">
</p><p id="0a612536-565a-401c-9f26-128499e753a5" class="">
</p><p id="d226dc75-88cf-45da-91ab-4d20b557ba61" class=""> <strong>Jenkins</strong><div class="indented"><p id="39f0db5a-09c1-47ca-b074-cc7ecef4e790" class="block-color-orange_background">ç–‘é—®ï¼š<div class="indented"><p id="9057817f-961c-47c4-9e46-cf68af5f23d2" class="">æ¯ä¸ªåˆ†æ”¯éƒ½éœ€è¦ä¸€ä¸ªJenkinsfileä¹ˆï¼Ÿ</p></div></p><p id="edd537fc-d69f-4005-8ac9-b51a992d655e" class="block-color-teal_background">å€Ÿé‰´æ€»ç»“ï¼š<div class="indented"><ul id="cb50a98e-8f7e-4a8e-983a-fc6a4823b569" class="bulleted-list"><li style="list-style-type:disc">å°½å¯èƒ½ä½¿ç”¨å…±äº«åº“:</li></ul><p id="ebef2132-ac17-460e-be26-41fca6aa9c2d" class="">å½“æœ‰å¾ˆå¤šé¡¹ç›®ï¼Œéšä¹‹è€Œæ¥çš„æ˜¯åŒæ ·å¤šçš„jenkinsfileï¼Œä»»ä½•å˜åŠ¨æˆ‘éƒ½éœ€è¦ä¿®æ”¹æ‰€æœ‰çš„jenkinsfile</p><p id="a4dd1b37-4b57-457b-acd8-48e01a3fea84" class="">æ›´å®¹æ˜“å®ç°æ ‡å‡†åŒ–</p><p id="e8e91ef4-f3e7-4e0b-be89-59e108b0239c" class="">é›†ä¸­å­˜æ”¾Jenkinsfileçš„å¥½å¤„ï¼š<div class="indented"><p id="6a72bb5a-a4bc-42bd-8d9d-aac26740164e" class="">jenkinsfileå’Œä»£ç å¯èƒ½ä¼šè¢«å¼€å‘ç¯¡æ”¹ï¼Œé›†ä¸­æ”¾ç½®æ›´åŠ å®‰å…¨</p></div></p><p id="530c4bc4-de9d-4eb2-8039-8b9f970d5159" class="">åœ¨environmentå—ä¸­å†™å…¥å·¥å…·é“¾åœ°å€ä¸å‡­è¯çš„æ–¹å¼ï¼Œæ˜¯æ­£ç¡®çš„ï¼Œå› ä¸ºç½‘ä¸Šä¹Ÿæœ‰è¿™ä¹ˆç”¨çš„</p><p id="4e0e7253-ee20-44cd-a32e-f21f8d1f1d7f" class="">æˆ‘è®¤ä¸ºchartæ”¾ä¸€ä»½ä½œä¸ºæ¨¡æ¿ï¼Œå¦‚æœæ¯æ¬¡CIéƒ½è¦æäº¤ä¸€ä¸ªchart</p><ul id="913b7679-0e99-4fb2-a20f-dcfd75671a26" class="toggle"><li><details open=""><summary>æ–°å‘ç°çš„å†™æ³•</summary><pre id="c7852dbd-ba9e-4155-a5e5-5b718e8a8af7" class="code code-wrap"><code>æ²¡è§è¿‡
kubernetes {
    defaultContainer &#x27;jnlp&#x27;
    yamlFile &#x27;build.yaml&#x27;
}

ä¹Ÿåˆ†ä¸ºäº†å‡ ä¸ªé•œåƒï¼Œæ¯ä¸ªé•œåƒåˆ†åˆ«å¤„ç†mavenæ‰“åŒ…ï¼Œ
container(&#x27;maven&#x27;) {
    sh &#x27;mvn package&#x27;
}

dockeré•œåƒæ„å»ºä¸push
container(&#x27;docker&#x27;) {
                    sh &quot;docker build -t ${REGISTRY}:${VERSION} .&quot;
}
container(&#x27;docker&#x27;) {
    withDockerRegistry([credentialsId: &quot;${REGISTRY_CREDENTIAL}&quot;, url: &quot;&quot;]) {
        sh &quot;docker push ${REGISTRY}:${VERSION}&quot;
    }
}

helmå®‰è£…
container(&#x27;helm&#x27;) {
    sh &quot;helm upgrade --install --force --set name=${NAME} --set image.tag=${VERSION} --set domain=${DOMAIN} ${NAME} ./helm&quot;
}

è·³è¿‡æŠ¥é”™
pipeline {
    agent any
    stages {
        stage(&#x27;1&#x27;) {
            steps {
                sh &#x27;exit 0&#x27;
            }
        }
        stage(&#x27;2&#x27;) {
            steps {
                catchError(buildResult: &#x27;SUCCESS&#x27;, stageResult: &#x27;FAILURE&#x27;) {
                    sh &quot;exit 1&quot;
                }
            }
        }
        stage(&#x27;3&#x27;) {
            steps {
                sh &#x27;exit 0&#x27;
            }
        }
    }
}

groovyåˆ¤æ–­å‹èµ‹å€¼:?
def BRANCH_NAME = &quot;develp&quot;
DEPLOY = BRANCH_NAME == &quot;master&quot; || BRANCH_NAME == &quot;develop&quot; || BRANCH_NAME == &quot;develp&quot; ? &quot;true&quot; : &quot;false&quot;
println DEPLOY</code></pre></details></li></ul></div></p><p id="94755ca3-8368-4545-b01a-f78c50c4ff95" class="">æ’ä»¶<div class="indented"><pre id="f33054a4-b0b0-46b5-b077-6b166e4ee599" class="code code-wrap"><code>docker æ’ä»¶ NOK
docker.withRegistry( &quot;[https://registry.hub.docker.com](https://registry.hub.docker.com/)&quot;, &quot;dockerhub&quot; ) {
// dockerImage.push()
app.push(&quot;latest&quot;)
docker.withRegistry(&quot;${ECRLink}&quot;, &#x27;ecr:ap-southeast-2:helloworld-ecr&#x27;){
docker.image(&quot;${ImageName}&quot;).push(&quot;${ImageTag}&quot;)

writeFile æ’ä»¶

podTemplate NOK</code></pre></div></p><p id="6942578b-4675-4d7e-a302-3e40e360fad9" class="">harborä¸Šçš„chart museumåŠŸèƒ½ï¼š<a href="https://goharbor.io/docs/2.1.0/working-with-projects/working-with-images/managing-helm-charts/">https://goharbor.io/docs/2.1.0/working-with-projects/working-with-images/managing-helm-charts/</a></p><p id="7c1d216e-b2a6-425d-bd71-c26d411a9049" class="">
</p><p id="ec70b8e1-f86f-47f4-a263-f3a589fdad25" class="">
</p></div></p></div></p><h1 id="154ac6f4-0821-406d-b6bf-5b7e4f4aaec8" class="block-color-teal_background"><time>@October 12, 2021</time> </h1><p id="96a8e8ce-5936-4f5f-b1d4-1b69bfaf1dc7" class="">ç–‘é—®</p><ul id="4bc6b6b8-4695-40eb-b640-0d1afcfa06f1" class="bulleted-list"><li style="list-style-type:disc">what is jenkins controller ï¼Ÿå°±æ˜¯Jenkinsçš„masterï¼Œ2.27.1</li></ul><ul id="9d3ab65e-ffd6-4a2f-bf3b-4f8e5b589aca" class="bulleted-list"><li style="list-style-type:disc">å¦‚ä½•è®©shellçš„PSæ˜¾ç¤ºå½“å‰çš„gitåˆ†æ”¯ä¿¡æ¯</li></ul><ul id="8e493209-b572-4b5f-a397-554f47db990a" class="bulleted-list"><li style="list-style-type:disc">git push <code>--upstream origin fix-123</code>  ä»€ä¹ˆæŒ‡ä»¤<p id="6f334bc9-d65e-4df4-81d0-c01d5072ca05" class="">git status</p></li></ul><p id="b917bd13-daf4-45a9-ba8f-247067847388" class="">æ–°å­¦ä¹ </p><ul id="d78f9b53-b95c-42b9-aae8-a16efedfb1f7" class="bulleted-list"><li style="list-style-type:disc"><code>GitLab Branch Source plugin</code>æ’ä»¶çš„ç‰¹ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ<ul id="913824f3-13bc-40c2-a155-dbbed4f40586" class="bulleted-list"><li style="list-style-type:circle">ç‰¹ç‚¹ï¼šJenkins MultiBranch Pipeline feature</li></ul><ul id="473eaab2-66b2-47da-b2ba-5053574db324" class="bulleted-list"><li style="list-style-type:circle">multi-branch pipelineç‰¹æ€§ç”¨æ¥è§£å†³ï¼šä¸€ä¸ªgité¡¹ç›®å¿…ç„¶åŒ…å«å¤šä¸ªåˆ†æ”¯ï¼Œæ–°å»ºåˆ†æ”¯å°±è¦å®šä¹‰æ–°çš„jobï¼Œmergeå¹¶åˆ é™¤åˆ†æ”¯åè¦åˆ é™¤jobï¼Œè€—æ—¶ï¼Œå®ƒå¯ä»¥å®ç°åŠ¨æ€åˆ›å»ºä¸åˆ é™¤</li></ul><ul id="34590005-51e9-426f-8759-42afb99e2a58" class="bulleted-list"><li style="list-style-type:circle">ç–‘é—®ï¼š<ul id="c4c7b9e4-d58e-47c6-8938-9b34bc4c5da9" class="bulleted-list"><li style="list-style-type:square">åœ¨åˆ†æ”¯åˆå¹¶æ—¶Jenkinsfileä¹Ÿä¼šåˆå¹¶ï¼Ÿå¦‚ä½•æ˜¯é‚£ä¹ˆä¸ºä»€ä¹ˆè¦æ”¹åŠ¨Jenkinsfileï¼Ÿä¼šé€ æˆä¸ç¨³å®šä¹ˆï¼Ÿ</li></ul><ul id="04657a8b-d79c-44ff-a6df-bb498cd2538f" class="bulleted-list"><li style="list-style-type:square">æ¯ä¸ªåŠ¨æ€çš„jobæ˜¯å¦æœ‰è‡ªå·±çš„workspace</li></ul></li></ul><ul id="85e99898-50bb-438b-847d-46d23ccd4a1d" class="bulleted-list"><li style="list-style-type:circle">å®ƒçš„å±€é™ï¼šå¦‚æœjenkinsfileéœ€è¦ä¿®æ”¹é‚£ä¹ˆåˆ†æ”¯éƒ½è¦å˜åŒ–ï¼Œè™½ç„¶å¯ä»¥ç”¨share Libraryæ¥è§£å†³ï¼Œä½†æ˜¯ä»ç„¶æœ‰ä¸€äº›éœ€è¦æ‰‹åŠ¨å¤„ç†ã€‚</li></ul><ul id="eb8f6a02-0b6d-4344-a08f-cbc5122844dd" class="bulleted-list"><li style="list-style-type:circle">åŸç†ï¼šæ‰«ææŒ‡å®šçš„gité¡¹ç›®çš„æ‰€æœ‰åˆ†æ”¯ï¼Œå¦‚å‘ç°æ–°çš„Jenkinsfileæ–‡ä»¶ï¼Œåˆ™åŠ¨æ€åˆ›å»ºä¸€ä¸ªjobï¼Œå¦‚å‘ç°åˆ†æ”¯ä¸å­˜å†åˆ™åˆ é™¤Jenkinsfile<p id="740e36f1-c0c5-4c23-8355-1226fcbefc58" class="">å‚è€ƒï¼š<a href="https://www.youtube.com/watch?v=y4XGFluzPHY&amp;list=PLvBBnHmZuNQJeznYL2F-MpZYBUeLIXYEe&amp;index=52">https://www.youtube.com/watch?v=y4XGFluzPHY&amp;list=PLvBBnHmZuNQJeznYL2F-MpZYBUeLIXYEe&amp;index=52</a></p></li></ul><ul id="48738551-23a9-4207-88ba-03d1fa1a67e7" class="bulleted-list"><li style="list-style-type:circle">å®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªjenkinsfileç›®å½•</li></ul><ul id="ab40c4b0-8aea-492c-b14e-a6e38e49cd19" class="bulleted-list"><li style="list-style-type:circle">ç‰¹æ€§çš„é€‰é¡¹ï¼š<figure id="d6cd6307-831d-4c7d-b2c6-afbb636e9295" class="image"><a href="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled.png"><img style="width:336px" src="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled.png"/></a></figure></li></ul></li></ul><ul id="9f47feca-515a-49c1-b792-2fea5513e08b" class="block-color-orange bulleted-list"><li style="list-style-type:disc">Remote Jenkinsfile Provideræ’ä»¶çš„è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ<ul id="cdd4a982-3ea8-4064-8c51-a1f113b70c52" class="bulleted-list"><li style="list-style-type:circle">è§£å†³äº†Jenkins MultiBranch Pipelineçš„é—®é¢˜</li></ul><ul id="a331bed5-33a7-4d8c-acf4-c318228b1403" class="bulleted-list"><li style="list-style-type:circle">ç‰¹ç‚¹ï¼šåœ¨Jenkins MultiBranch Pipelineç‰¹æ€§åŸºç¡€ä¸Šæ”¯æŒä»¥ä¸‹ï¼š<ul id="9209997d-737b-4358-b2f9-b550d46a1272" class="bulleted-list"><li style="list-style-type:square">Centralize Jenkins Files in another repository</li></ul><ul id="5b5136ae-17fd-4521-84a0-10f674fdbe69" class="bulleted-list"><li style="list-style-type:square">Easily maintain</li></ul><ul id="c98dd7ee-5109-4e3a-9001-c1f3603306e4" class="bulleted-list"><li style="list-style-type:square">Review or restrict changes</li></ul><ul id="e2ddcadb-b687-4527-91ba-7adfd40dacec" class="bulleted-list"><li style="list-style-type:square">Apply changes to all Pipelines in seconds</li></ul></li></ul></li></ul><ul id="ba672666-e1e9-4763-8c12-dbfd2d671465" class="block-color-teal bulleted-list"><li style="list-style-type:disc">K8S deploymentçš„<code>imagePullSecrets</code> å­—æ®µï¼Œæ˜¨å¤©æˆåŠŸä½¿ç”¨äº†ï¼Œä½œç”¨æ˜¯æ— éœ€æ‰‹åŠ¨ç™»é™†harborå³å¯æ‹‰å–é•œåƒ<p id="c013ad04-4769-4b42-aa03-5e27fb2f47f2" class="">åŠ å…¥ä¸€ä¸ªsecretï¼Œå®ƒç”¨äºä¿å­˜base64çš„å‡­è¯ï¼›ç„¶å<code>imagePullSecrets</code> å­—æ®µåŠ å…¥è¿™ä¸ªsecret
 å‚è€ƒï¼š<a href="https://blog.51cto.com/lvnian/2314456">https://blog.51cto.com/lvnian/2314456</a></p></li></ul><ul id="5535b24d-e5db-4a20-b4c7-29ff145f46b0" class="block-color-orange bulleted-list"><li style="list-style-type:disc">å¦‚ä½•æ‰“åŒ…ï¼šhelm package helmç›®å½•<p id="ca55ece2-3b2d-4607-8bcb-b3333dce9ab1" class="">å‚è€ƒï¼š<a href="https://helm.sh/docs/helm/helm_package/">https://helm.sh/docs/helm/helm_package/</a></p></li></ul><ul id="aa078606-b5e5-4af6-b3eb-01edbae6c751" class="bulleted-list"><li style="list-style-type:disc">å¦‚ä½•ä¸Šä¼ ï¼š<p id="40577a78-2ea2-4793-a5f4-68e7f73f581c" class="">å‚è€ƒï¼š<a href="https://goharbor.io/docs/1.10/working-with-projects/working-with-images/managing-helm-charts/">https://goharbor.io/docs/1.10/working-with-projects/working-with-images/managing-helm-charts/</a></p><p id="ae1d1110-2c1b-41ad-b92b-dd7d7187c530" class="">helm add repoæ·»åŠ harborå‡ºç°é—®é¢˜<div class="indented"><p id="596b6001-7dfd-4d01-916e-40a592ab0909" class="">
</p></div></p></li></ul><h1 id="386494fd-1ac9-40e9-9cbe-76226148b39c" class=""><time>@October 13, 2021</time> </h1><p id="de544846-4e98-4ccb-b9e6-3035b1fb807c" class="block-color-orange">ç–‘é—®ï¼š<div class="indented"><ul id="00da173f-b86a-4733-bf74-1f16125bd481" class="bulleted-list"><li style="list-style-type:disc">æ·»åŠ harbor chartä»“åº“çš„å°è¯•å¤±è´¥ï¼ŒæŠ¥é”™ï¼š<pre id="5ead09c5-7eba-4e35-9682-056379c32b76" class="code code-wrap"><code>helm repo add test http://192.168.31.102:80/chartrepo/library
Error: looks like &quot;http://192.168.31.102:80/chartrepo/library&quot; is not a valid chart repository or cannot be reached: failed to fetch http://192.168.31.102:80/chartrepo/library/index.yaml : 404 Not Found</code></pre></li></ul><ul id="a61fd30f-ce8b-4c37-9959-f8200b370706" class="bulleted-list"><li style="list-style-type:disc">ChartMuseumï¼ˆ1.6.0.ï¼‰å’ŒOCI-compatible registryï¼ˆ2.0.0.<a href="https://www.cnblogs.com/ding2016/p/12988080.html">https://www.cnblogs.com/ding2016/p/12988080.html</a>ï¼‰æ˜¯ä»€ä¹ˆï¼Ÿ</li></ul><ul id="67f80808-0d18-42c1-b434-46de6f477209" class="bulleted-list"><li style="list-style-type:disc">docker imageçš„tagæ ¼å¼æœ‰è¿™å‡ ç§ï¼šæ—¶é—´æˆ³/git commit/ç‰ˆæœ¬å·<p id="827f1873-a958-4ba3-b221-5d60729fa8be" class="">å‚è€ƒåˆ«äººçš„tagï¼š<a href="https://github.com/jupyter/docker-stacks/wiki/">https://github.com/jupyter/docker-stacks/wiki/</a></p></li></ul><ul id="5f048190-db2e-4e07-a17c-8aabd7c6727e" class="bulleted-list"><li style="list-style-type:disc">é•œåƒæ‰«ææ˜¯ä»€ä¹ˆï¼Ÿ</li></ul><ul id="2acff3a4-3daa-43b9-8243-5096b88336de" class="block-color-teal bulleted-list"><li style="list-style-type:disc">stagingæ˜¯è¿›å…¥ç”Ÿäº§ç¯å¢ƒçš„æœ€åä¸€æ­¥æµ‹è¯•ï¼Œä¹Ÿå«é¢„ç”Ÿäº§æˆ–é¢„å‘å¸ƒ<pre id="de43bebe-6a65-4b32-bc74-09e0889e101f" class="code code-wrap"><code>[:code, &quot;ä»£ç &quot;, &quot;ç›¸å…³åˆå¹¶è¯·æ±‚&quot;, &quot;ç¼–å†™ä»£ç çš„æ—¶é—´&quot;],
[:test, &quot;æµ‹è¯•&quot;, &quot;ç”±æäº¤è§¦å‘çš„æ„å»º&quot;, &quot;æ„å»ºå’Œæµ‹è¯•ç¨‹åºæ‰€èŠ±è´¹çš„æ—¶é—´&quot;],
[:review, &quot;è¯„å®¡&quot;, &quot;å·²åˆå¹¶çš„åˆå¹¶è¯·æ±‚&quot;, &quot;è¯„å®¡ä»£ç æ‰€èŠ±è´¹çš„æ—¶é—´&quot;],
[:staging, &quot;æ­¥éª¤&quot;, &quot;ç›¸å…³å·²éƒ¨ç½²çš„æ„å»º&quot;, &quot;å„ä¸ªæ­¥éª¤æ‰€èŠ±è´¹çš„æ—¶é—´&quot;],
[:staging, &quot;é¢„å‘å¸ƒ&quot;, &quot;å·²éƒ¨ç½²çš„æ„å»º&quot;, &quot;é¢„å‘å¸ƒæ‰€èŠ±è´¹çš„æ—¶é—´&quot;],
[:production, &quot;ç”Ÿäº§&quot;, &quot;ç›¸å…³é—®é¢˜&quot;, &quot;äº§å“ä»æ¦‚å¿µæå‡ºåˆ°ç”Ÿäº§å‘å¸ƒçš„æ—¶é—´&quot;]]</code></pre></li></ul><ul id="1d8aaac4-949a-40ec-bfcf-168c20f15682" class="bulleted-list"><li style="list-style-type:disc">K8Sæœ‰å“ªäº›roleï¼Ÿ</li></ul></div></p><p id="afed9bf5-8391-440c-84b5-2962d4f053fd" class="">å­¦ä¹ ï¼š<div class="indented"><ul id="db43759f-7cf4-4266-a016-91188fcc0810" class="bulleted-list"><li style="list-style-type:disc">ä½¿ç”¨Nexusä½œä¸ºhelmä»“åº“</li></ul><ul id="cf265cbb-f622-40aa-9dc2-2466ce4af8f0" class="toggle"><li><details open=""><summary>jenkinsä½¿ç”¨k8s podä½œä¸ºagent</summary><ol type="1" id="3f12d468-057b-4738-9ceb-daeb444e4cb6" class="numbered-list" start="1"><li>å–æ¶ˆmasterèŠ‚ç‚¹<figure id="36b7181d-89fa-4dba-9676-9305425efdaa" class="image"><a href="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%201.png"><img style="width:240px" src="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%201.png"/></a></figure></li></ol><ol type="1" id="aca38496-5298-4bcd-beb3-6e390db4d0db" class="numbered-list" start="2"><li>æ’ä»¶kubernetes</li></ol><ol type="1" id="f36e04b6-11f7-4ec0-b15f-5a3ce0de1303" class="numbered-list" start="3"><li>configure clouds<p id="10894345-1722-4a26-bf0c-abb3a546a6d2" class="">æ·»åŠ Kubernetesï¼Œåå­—ä¿æŒkubernetes</p><p id="c230d144-ab31-4ead-b7f3-941b12e2376b" class="">æ·»åŠ cloud<div class="indented"><p id="7bec64b8-19db-43ab-875f-74dfdc0071b0" class="">k8s apiåœ°å€</p><p id="866f72ff-2abe-4e0c-a2b7-2bc326f79e30" class="">å‹¾é€‰ç¦æ­¢httpsæ£€æŸ¥ï¼ˆè‡ªç­¾è¯ä¹¦ï¼‰</p><p id="e4330a2d-d996-48cc-a696-f014b97851cf" class="">namespaceï¼š jenkinsï¼ˆä½ å¸Œæœ›podåœ¨å“ªä¸ªnsä¸Šè¿è¡Œï¼Œk8séœ€åˆ›ï¼‰</p><p id="9bd2c72c-85ef-41e5-a800-a56f40addccf" class="">k8s åˆ›å»ºç”¨æˆ·jenkinsï¼š<code>kubectl create serviceaccount jenkins -n jenkins</code></p><p id="241bf8fe-ab1f-430a-9901-924b5f888424" class="">k8sä¸ºjenkinsç”¨æˆ·å…³è”adminè§’è‰²ï¼š<code>kubectl create rolebinding jenkins-admin-binding --clusterrole=admin --serviceaccount=jenkins:jenkins --namespace=jenkins</code></p><p id="14d3be51-d98c-4259-bfce-4b0870fbd4ca" class="">æ·»åŠ credentialsï¼š<div class="indented"><p id="37f5548c-2660-4887-b944-ba2dfe7727f5" class="">secret textå†…å®¹æ¥è‡ªï¼š<code>kubectl describe secret $(kubectl describe serviceaccount jenkins -n jenkins | grep Token | awk &#x27;{print $2}&#x27;) -n jenkins</code></p></div></p><p id="61be47f9-2675-4e81-8c15-071e1a77c269" class="">å‹¾é€‰Websocket<div class="indented"><p id="9e1228da-dfe0-4a38-9beb-a5565e597af7" class="">jnlp agentä¹Ÿå«inbound agentsï¼Œagentåœ¨å¯åŠ¨ä¹‹åé€šè¿‡httpåè®®å‘controllerå‘èµ·è¿æ¥å¹¶ä¿æŒè¿æ¥</p></div></p><p id="6c090c8b-83a7-4489-a38c-c8a738cab98d" class="">ä¿å­˜</p></div></p><p id="92798acd-331a-48a4-a98d-1eb4774ba5c3" class="">åœ¨jenkinsfileä¸­ä½¿ç”¨çš„æ–¹æ³•<div class="indented"><pre id="b52580a9-4904-40a7-beb5-f1acc6c4f5c1" class="code code-wrap"><code>pipeline{
    agent{
        kubernetes {    è¿™é‡Œä¸cloudå®šä¹‰çš„åå­—å¯¹åº”
            yaml &#x27;&#x27;&#x27;
                apiVersion: v1
                kind: Pod
                spec:
                  containers:
                  - name: maven
                    image: maven:alpine
                    command:
                    - cat
                    tty: true
                  - name: node
                    image: node:16-alpine3.12
                    command:
                    - cat
                    tty: true
            &#x27;&#x27;&#x27;
        }
    }
    
    stages{
        stage(&#x27;Run maven&#x27;){
            steps{
                container(&#x27;maven&#x27;){
                    sh &#x27;mvn -version&#x27;
                }
                container(&#x27;node&#x27;){
                    sh &#x27;npm version&#x27;
                }
            }
        }
    }
}</code></pre></div></p></li></ol></details></li></ul></div></p><p id="18bedab4-48ad-47db-9f77-ff1f9b342625" class="">æ€»ç»“ï¼š<div class="indented"><ul id="ed94261f-8d65-4b77-956f-b77cef474ed5" class="bulleted-list"><li style="list-style-type:disc">é¡¹ç›®ä»£ç ä¼šç»å†çš„ç¯å¢ƒï¼šdevï¼Œqaï¼Œstagingï¼Œprod</li></ul><ul id="2d26524e-5888-44e6-afd2-ed3645d4427c" class="bulleted-list"><li style="list-style-type:disc">åœ¨å¼€å‘ç¯å¢ƒä¸­ï¼Œæˆ‘å†³å®šä½¿ç”¨git commitæ¥ä½œä¸ºé•œåƒæ ‡ç­¾</li></ul><ul id="ef31a09f-ebea-4ec6-a6e8-72fc9b9679a4" class="bulleted-list"><li style="list-style-type:disc">Jenkinsçš„ç¯å¢ƒå˜é‡PATHä¸­æ²¡æœ‰/usr/local/bin/</li></ul><ul id="115498b2-113c-47e9-aaa4-6b7befbb3b42" class="bulleted-list"><li style="list-style-type:disc">Jenkinsfileä¸­çš„ç¯å¢ƒå˜é‡åœ¨nodeä¸Šä¹Ÿæ˜¯æœ‰æ•ˆçš„</li></ul></div></p><p id="a51ef10e-ae21-4db4-8063-9caec4e79e0c" class="">åšä»€ä¹ˆï¼š<div class="indented"><ol type="1" id="bb1a7659-501c-4f1a-af34-e0ea075288e1" class="numbered-list" start="1"><li>ä¸Šä¼ chartåŒ…åˆ°nexus chartä»“åº“</li></ol><ol type="1" id="ed8f2f79-f1eb-4221-b0d0-4595211f2b88" class="numbered-list" start="2"><li>å®Œæˆæµæ°´çº¿å‰©ä¸‹çš„éƒ¨åˆ†ï¼šé€šè¿‡chartå‘å¸ƒ<ol type="a" id="f3418735-cb06-4cd5-a6fa-de1b0aa4c0e0" class="numbered-list" start="1"><li>uiçš„é•œåƒæ²¡äº†ï¼Œpipelineè¿è¡Œä¸€æ¬¡ç”Ÿæˆé•œåƒ</li></ol><ol type="a" id="f5d3ca0e-6883-4b86-8960-75bd51bcf3a9" class="numbered-list" start="2"><li>æ‰“åŒ…chartï¼Œæ¨é€åˆ°nexus<p id="916e58b7-f893-40ae-b360-111d111ec840" class="">ä¸Šä¼ <div class="indented"><p id="e649f607-70b7-411a-84d4-639fa90ba9e1" class=""><code>curl -v -F file=@devops02-devops-ui-0.1.0.tgz -u admin:nokiadocker http://192.168.31.102:8081/service/rest/v1/components?repository=helm-hosted</code></p></div></p><figure id="e6823140-6686-4f80-9fb1-3ec561855141" class="image"><a href="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%202.png"><img style="width:432px" src="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%202.png"/></a></figure><p id="29a38a00-2e1d-4501-b00d-dc065f70188b" class="">å…ˆæ›´æ–°å’Œæœç´¢ï¼š<code>helm repo update &amp;&amp; helm search repo -l devops02-devops-ui</code></p><p id="8f7cc978-dd42-4851-9361-a50a8b8c007e" class="">å®‰è£…ï¼š<code>helm install devops02-devops-ui nexus/devops02-devops-ui --set image.tag=139</code></p></li></ol><ol type="a" id="4442d4a2-b3dd-4ffd-9a57-103e5e32ca3a" class="numbered-list" start="3"><li>åˆ¤æ–­releaseæ˜¯å¦å­˜åœ¨ï¼Œå¦‚å­˜åœ¨å°±æ›´æ–°</li></ol><ol type="a" id="3c93e2d9-e62f-4dc1-9575-7747bb9f8650" class="numbered-list" start="4"><li>å¦‚ä¸å­˜åœ¨åˆ™ä»nexux charä»“åº“å®‰è£…</li></ol><ol type="a" id="07a6a945-9e36-40d2-a5cb-a82d19a95e2a" class="numbered-list" start="5"><li>ç­‰å¾…releaseæˆåŠŸï¼Œå¦‚å¤±è´¥åˆ™æµæ°´çº¿å¤±è´¥</li></ol><p id="18397c1e-e080-422e-834a-cc51391e41aa" class="block-color-orange">ç–‘é—®ï¼š<div class="indented"><p id="b6449b7a-5de8-40a8-b0e4-649ba9af8964" class=""><mark class="highlight-teal">tagæ”¹æˆcommit-idï¼Œéœ€è¦ç¡®å®šé•¿åº¦:</mark><code><mark class="highlight-teal">COMMIT_ID = sh(returnStdout: true, script: &#x27;git rev-parse HEAD&#x27;).trim()</mark></code></p><p id="b6b34d1f-fcf6-47fa-8173-2fc59c1ce3f0" class="">nexusä¸Šçš„chartä¿¡æ¯æœ‰å“ªäº›ï¼Ÿ</p><p id="94b20119-6696-4a8b-902c-6a068f4079c3" class="">jenkinfileçš„sh stepï¼Œawkçš„æ­£åˆ™é‡Œèƒ½å¦ç”¨å˜é‡</p></div></p></li></ol><ol type="1" id="15addb72-fbb1-4d5c-9200-10dceb72c1e7" class="numbered-list" start="3"><li>æ€»ç»“å¥½æ‰€æœ‰çš„</li></ol><h1 id="c4f2a0bd-b02b-46da-b57d-164f3c44f202" class=""><time>@October 14, 2021</time> </h1><p id="fe1574cf-152a-4337-b367-304bcc82a4b4" class="">Jenkins share library<div class="indented"><p id="54fc61eb-52fc-47a7-897d-5e885539f303" class="">å¼€å¤´<code>#ï¼/usr/bin/env groovy</code></p><p id="ecb47344-ee18-48eb-966f-8078064c63b5" class="">åœ¨éœ€è¦çš„å˜é‡é›†ä¸­ç”³æ˜åœ¨å¼€å¤´éƒ¨åˆ†ï¼Œçš†ä»¥<code>def</code></p><p id="39dfc890-41a2-4384-8f93-b827a3c60b21" class="">SCMæ’ä»¶</p><p id="c21b764e-c97f-490e-93ba-681007a14e38" class="">å…±äº«åº“å¾ˆå…³é”®ï¼Œå¿…é¡»ä¸¥æ ¼ç®¡æ§</p><p id="eea14d53-32c6-47c7-a2c0-57fe5394e7b8" class=""><mark class="highlight-teal_background">çœ‹åˆ°äº†â†’</mark><mark class="highlight-teal_background"><a href="https://www.jenkins.io/doc/book/pipeline/shared-libraries/#accessing-steps">https://www.jenkins.io/doc/book/pipeline/shared-libraries/#accessing-steps</a></mark></p><p id="7aaa1a8a-a54d-4d6c-9183-9d0788d7ed5a" class="">è‡ªå®šä¹‰stepâ†’<a href="https://www.jenkins.io/doc/book/pipeline/shared-libraries/#defining-custom-steps">https://www.jenkins.io/doc/book/pipeline/shared-libraries/#defining-custom-steps</a><div class="indented"><p id="1f24c375-6407-421c-9dad-5ee4a1cfe514" class="">åƒstepä¸€æ ·è¢«è°ƒç”¨</p><p id="0088c130-f43a-491a-9559-a81039c8985a" class="">ä½¿ç”¨<code>def call(å½¢å‚){...}</code></p></div></p><p id="20da91ab-b5a2-48c3-b49c-156216b86fa5" class="">å…ˆåŠ è½½åº“åœ¨åŠ è½½jenkinsfile</p><p id="fb473614-6852-4663-b8b0-ac2fbddd4f2c" class="">å…¨å±€å˜é‡å¿…é¡»å¼€å¤´å°å†™ä¸”é©¼å³°<div class="indented"><p id="c48cfcd4-f140-4887-9ed4-e5b4836fe0da" class="">Global variables defined in Shared Libraries must be named with all lower-case or &quot;camelCased&quot; in order to be loaded properly by Pipeline. [2]</p></div></p><p id="5d84166b-1923-46d4-b926-916ecff94ec6" class="">æ–‡ç« å‚è€ƒï¼š<div class="indented"><p id="9d7c05a6-7a24-44c1-bd77-09d0befcb9a9" class="">Colin Butå†™çš„éå¸¸å®Œå–„çš„ç¤ºä¾‹ï¼š<a href="https://medium.com/codex/my-jenkins-story-writing-a-jenkins-shared-library-f255c036c4e7">https://medium.com/codex/my-jenkins-story-writing-a-jenkins-shared-library-f255c036c4e7</a></p><p id="66b40582-d767-45dc-9a15-7d33292182a4" class="">æ¯”è¾ƒè¯¦ç»†çš„æ•™å­¦ï¼Œæ²¡çœ‹å®Œï¼š<a href="https://www.tutorialworks.com/jenkins-shared-library/">https://www.tutorialworks.com/jenkins-shared-library/</a></p></div></p><p id="c9656890-0857-4e46-a745-69ff645dbeb4" class="">
</p></div></p><p id="4d57e1bf-5654-4be8-9e27-0dfe47524175" class="">groovyè¯­è¨€å¤ä¹ äº†æ­£åˆ™<div class="indented"><p id="120a5a2b-8c1e-405c-a9d4-e218fabc31f5" class="">Manning Groovy P3.5.1</p></div></p><p id="a540c6c1-4f23-4450-8ef7-4121ea91fb57" class="block-color-orange">QAï¼š<div class="indented"><p id="acd6ca8a-9ca3-496a-acdd-7ce8874de928" class="">jenkins share libraryä¸­ï¼Œsrcä¸varsçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ<div class="indented"><p id="2a892391-01eb-4d2e-a2bf-f64d2a897d57" class="">srcç›®å½•é‡Œé¢ä¿å­˜æºä»£ç ï¼Œé‡‡ç”¨åƒJAVAæºä»£ç ç›®å½•ç»“æ„ï¼Œæ¯”å¦‚org/devops, å½“åŠ è½½æ—¶ï¼Œä¼šè¢«åŠ å…¥classpath<div class="indented"><p id="ac63c9d8-0269-420f-b23c-b9b506eb48df" class="">æ–‡ä»¶é‡‡ç”¨å¼€å¤´å¤§å†™çš„é©¼å³°</p><p id="6ef900d8-e63b-4702-a48a-9a305844a8ec" class="">common pipeline code</p><p id="6dd5818d-b2cb-4ea6-a991-06b54641ed0a" class="">æˆ‘æ‰“ç®—å°†å¸¸é‡å†™åœ¨ç±»é‡Œ</p><p id="66995572-8df9-4dd8-8dc7-0c0d40f07f35" class="">åœ¨share libraryæ˜¯è¿™æ ·å®šä¹‰å¸¸é‡çš„ï¼š<div class="indented"><pre id="275bda82-84d7-449d-8077-8833b3d1b602" class="code code-wrap"><code>åœ¨srcç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªç±»ï¼Œæ³¨æ„æ–‡ä»¶åæ˜¯å¼€å¤´å¤§å†™é©¼å³°ï¼Œåç¼€.groovy
ä¾‹å­ï¼š
ç±»æ–‡ä»¶åConstant.groovy
package org.devops   ç±»çš„å®šä½

class Constants {                  Constantæ˜¯ç±»åï¼Œå¿…é¡»ä¸æ–‡ä»¶åä¸€è‡´å³æ–‡ä»¶åæ˜¯Constant.groovy
    static String foo = &quot;bar&quot;      æ‰€æœ‰å®šä¹‰çš„å¸¸é‡éƒ½åœ¨Constantç±»åç©ºé—´ä¸‹
}

åœ¨å…¶ä»–ç±»æ–‡ä»¶ä¸­å°±å¯ä»¥å¼•ç”¨å¸¸é‡äº†ï¼Œç±»æ–‡ä»¶åTest.groovy
package org.devops   ç±»çš„å®šä½
import org.devops.Constants  å¯¼å…¥Constantsç±»

def test(){
    echo Constants.foo  å¼•ç”¨ç±»
}

å€ŸåŠ©è¿™ä¸ªï¼Œæˆ‘å¯ä»¥é›†ä¸­å°†å·¥å…·é“¾æœåŠ¡å™¨ä¿¡æ¯æ¯”å¦‚å‡­è¯å’Œåœ°å€æ”¾åœ¨è¿™é‡Œã€‚</code></pre></div></p></div></p><p id="5bfbf9c7-0cd6-4c00-81c0-fd54f457e75d" class="">varsç›®å½•ä¿å­˜è„šæœ¬æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶èƒ½å¤Ÿä»¥å˜é‡å½¢å¼åœ¨Jenkinsfileä¸­å¼•ç”¨<div class="indented"><p id="6927ee56-85d9-4930-83de-fe72681bdda5" class="">æ–‡ä»¶åé©¼å³°</p></div></p><p id="0dfb8e86-16d4-4af7-bebf-df5d2980f70e" class="">åº“çš„trustå’Œuntrustæ¦‚å¿µï¼Ÿ</p><p id="0b2bf803-968a-4026-83d2-643be642022d" class="">ä»€ä¹ˆæ˜¯static variable</p><p id="1730f1f1-714e-4119-9ef1-9bdc9f2a26b4" class="">å¯ä»¥å°†å¸¸é‡æ¯”å¦‚å·¥å…·é“¾åœ°å€å‡­æ®IDï¼Œè¿™ç§å¸¸é‡ï¼Œé›†ä¸­åœ¨ä¸€ä¸ªç±»ä¸­ä¹ˆï¼Ÿ</p><p id="5ce63947-a203-494d-a603-1bde78672047" class=""><code>final string</code> ä¸ <code>static string</code>  åŒºåˆ«</p><p id="b3338d45-39ed-4d21-9ce5-4706682c06c1" class="">âš ï¸Mavenèµ„æ–™ä¸­å…³äºè®¤è¯ï¼Œæ˜¯å¦å†™æ¸…æ¥šäº†ï¼Ÿ</p><p id="36c7fb97-d82f-4648-8799-8b91e2f4615e" class="">
</p></div></p></div></p><p id="d91a836c-7751-49da-8ab0-b09c88524abf" class="">å€Ÿé‰´<div class="indented"><ul id="e7b8240d-deea-44f3-95b5-fcf1306fb652" class="toggle"><li><details open=""><summary>generic webhook trigger</summary><pre id="c7a0af0c-4026-4972-89d0-d66a77d04173" class="code code-wrap"><code>triggers {
        GenericTrigger(
                genericVariables: [
                        [key: &#x27;prNumber&#x27;, value: &#x27;number&#x27;],
                        [key: &#x27;prAction&#x27;, value: &#x27;action&#x27;],
                        [key: &#x27;prMergeStatus&#x27;, value: &#x27;pull_request.merged&#x27;]
                ],

                causeString: &#x27;$prNumber merged&#x27;,

                printContributedVariables: true,
                printPostContent: true,

                silentResponse: false,

                regexpFilterText: &#x27;$prMergeStatus&#x27;,
                regexpFilterExpression: &#x27;\\b(\\w*true\\w*)\\b&#x27;
        )
    }</code></pre></details></li></ul></div></p></div></p><p id="529da39f-2505-4361-932c-18bb2e7e99e5" class="">
</p><h1 id="3c4b83db-d603-4733-bee0-7291c0c70298" class=""><time>@October 15, 2021</time> </h1><p id="404d3ab9-fcf3-4f0e-bb49-6ff5c4972a65" class="">ç»éªŒæ€»ç»“ï¼š<div class="indented"><p id="57d2cd23-89a9-43f5-a7d7-5f94bf02590c" class="">å…±äº«åº“çš„å…¨å±€å˜é‡æ–‡ä»¶åå¿…é¡»å°å†™å¼€å¤´</p><p id="5850f3b8-ed41-4a7d-be1c-9bd28edb25bf" class="">httpRequestæ’ä»¶è¿”å›ç»“æœåªæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¦è·å–ç»“æœå¿…é¡».contents</p></div></p><p id="8b496d5d-35ae-4dbc-a34d-0336bdee767c" class="">æ€è€ƒä¸é—®é¢˜ï¼š<div class="indented"><p id="8ec180bd-29ce-45a2-a296-2d6a6c3f5261" class="">è§£å†³NPMä»“åº“è®¤è¯é—®é¢˜</p><p id="7d126217-4672-43c0-9d1a-787e1acfb60b" class="">withcredentialsæ˜¯å¦çš„credentialsIdæ˜¯å¦å¼•ç”¨å¸¸é‡ï¼Ÿ</p><p id="05b0bcc5-dc55-4129-9eeb-71ba518ca5c1" class=""><del>æˆ‘è§‰å¾—å¯ä»¥å°†å·¥å…·é“¾åœ°å€å‡­è¯ç›¸å…³çš„æ•°æ®æ”¾åœ¨æ–‡ä»¶ä¸­ï¼Œå¯èƒ½åœ¨properties fileä¸­å¾—åˆ°è§£ç­”</del> æ— æ³•å®ç°ï¼Œpropertiesåªèƒ½ä¸æºç æ‰€åœ¨åº“æ”¾åœ¨ä¸€èµ·æ‰èƒ½è¢«è®¿é—®åˆ°ï¼Œé‚£æ ·å°†å¤±å»æ„ä¹‰ã€‚<div class="indented"><p id="63fb53aa-b2b2-43fd-b48f-4437c1261788" class="">å¦‚ä½•è¯»å–properties file<div class="indented"><ol type="1" id="b2271d72-2259-483e-bbc2-4b85282792bd" class="numbered-list" start="1"><li>éœ€è¦plugin: pipeline utility steps æä¾›readProperties</li></ol><ol type="1" id="dc2e9870-a3f9-47c3-abeb-813975223bd3" class="numbered-list" start="2"><li>åœ¨gitä»“åº“ä¸­åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œåç¼€æ— æ‰€è°“ï¼Œgroovyæˆ–propertieséƒ½å¯ä»¥<p id="857c7c9a-ef9b-4579-a3b1-29a17d861521" class="">æŒ‰ç…§å¦‚ä¸‹ä¾‹å­æ ¼å¼åˆ›å»º</p><pre id="81e10ce9-2ba4-4618-81fb-ed5e941319a8" class="code code-wrap"><code>SONAR_SERVER = &quot;http://192.168.31.102:9000&quot;
SONAR_SCANNER_HOME = &quot;/opt/sonar-scanner-4.2.0.1873-linux&quot;
SONARQUBE_TOKEN = sonarqube-root-token
NEXUS_CRED = nexus-jenkins-password
HARBOR_CRED = &#x27;harbor-admin-password&#x27;
SONARQUBE_CRED = &#x27;sonarqube-admin-password&#x27;
GITLAB_CRED = &#x27;gitlab-token&#x27;
NPM_GROUP_REPO = &quot;http://192.168.31.102:8081/repository/npm-group/&quot;
NPM_HOSTED_REPO = &quot;http://192.168.31.102:8081/repository/npm-hosted/&quot;
GITLAB_HOST = &quot;http://192.168.31.102&quot;
HARBOR = &quot;https://192.168.31.102/&quot;
</code></pre></li></ol><ol type="1" id="c7336330-f331-41ef-bbd9-a33c2c7df105" class="numbered-list" start="3"><li>åœ¨Jenkinsfileä¸­åŠ è½½å’Œå¼•ç”¨<p id="a4d9f373-4363-4939-838a-55419a41bffd" class="">å› é¡»åœ¨pipelineå¼€å§‹å‰åŠ è½½ï¼Œæ•…åœ¨pipelineså—ä¹‹ä¸ŠåŠ å…¥åŠ è½½å‘½ä»¤</p><p id="e97abec5-a620-4e7d-94e0-56aedeb71863" class="">å› éœ€ä¸€ä¸ªèŠ‚ç‚¹æ¥å¤„ç†åŠ è½½ä»»åŠ¡ï¼Œæ•…è‹¥é‡‡ç”¨é™æ€èŠ‚ç‚¹åˆ™ç”¨<code>node</code>å—ï¼›è‹¥é‡‡ç”¨PodèŠ‚ç‚¹åˆ™ç”¨<code>podTemplate</code>å—ï¼›å¦‚é‡‡ç”¨dockerå®¹å™¨åˆ™é‡‡ç”¨<code>container</code>å—ã€‚</p><pre id="5b81f057-0b50-4c15-9a97-0de8d1be207c" class="code code-wrap"><code>//é’ˆå¯¹é™æ€èŠ‚ç‚¹ï¼Œæˆ‘ä»¬ç”¨nodeï¼Œå¿…é¡»
node (&#x27;master&#x27;){ //åœ†æ‹¬å·æ˜¯label
    props = readProperties(file: &#x27;test.properties&#x27;)  //è¿™ä¸ªç›¸å¯¹è·¯å¾„æ˜¯workspaceçš„jobç›®å½•
}
pipelines{
		environment{
				SONAR_SERVER = &quot;${props[&quot;SONAR_SERVER]}&quot;  //å¼•ç”¨ï¼Œæ³¨æ„ä¸€å®šè¦åŠ åŒå¼•å·ï¼Œåœ¨environmentå—å®šä¹‰ç¯å¢ƒå˜é‡åªèƒ½ç”¨å•å¼•æˆ–åŒå¼•æˆ–æ–¹æ³•
		}
}</code></pre></li></ol></div></p></div></p><p id="f4ee37e2-5857-4657-b17b-3a20c81c0a67" class="">tagæ˜¯ä»€ä¹ˆï¼Ÿä¸branchæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ<div class="indented"><p id="95f179dc-3e1f-43ee-844b-14b651fa94b3" class="">åŒºåˆ«ï¼šå½“æ·»åŠ æ–°commitæ—¶ï¼Œbranch headæŒ‡é’ˆä¼šæŒ‡å‘æ–°çš„commitï¼›tagæ˜¯å†»ç»“åœ¨æŒ‡å®šcommitä¸Š</p></div></p><pre id="cf78fb26-a576-43f3-b423-3d2977895478" class="code code-wrap"><code>node(&#x27;master&#x27;){            è¿™ä¸ªå·¥ä½œç›®å½•ç«Ÿç„¶åœ¨è·³è½¬åˆ°æºä»£ç ç›®å½•ä¸Šäº†
    props = readProperties(file: &#x27;value.properties&#x27;)
    println props

}

pipeline{
    agent {
        node {
            label &quot;master&quot;
        }
    }</code></pre></div></p><h1 id="cc74bbbe-8b8d-43b3-a9fe-58ac97ca390d" class=""><time>@October 16, 2021</time> </h1><p id="08ed3410-0d81-4c79-94d1-1525e81617aa" class="">ç›‘æ§</p><p id="d4c9e05f-022c-4d56-bc29-6c0a3620ca13" class="">æ—¥å¿—<div class="indented"><p id="0a239be9-096b-4488-8a3f-8da06332f529" class=""><a href="ElasticSea%20eebed.html">ElasticSearch</a> </p><p id="b1084d3d-61bb-4737-910a-434df8f1fba7" class="">dockeræ—¥å¿—ç‰¹ç‚¹<div class="indented"><p id="9f61b807-5ea6-4ba2-8727-853e398043ae" class="">dockeré€‰é¡¹logging driveræ˜¯json-fileæ—¶ï¼šå®¹å™¨æ ‡å‡†è¾“å‡ºï¼Œdockeræ”¶é›†æ ‡å‡†è¾“å‡ºï¼Œä»¥Jsonæ ¼å¼ä¿å­˜äº<code>/var/lib/docker/contaners/å®¹å™¨id/å®¹å™¨id-json.log</code> å¹¶ç»´æŒæ—¥å¿—åˆ‡å‰²(å³ä¼šæ¸…ç©ºè€æ—¥å¿—)</p></div></p><p id="4eb9bdaa-5e13-489f-ba79-f72709cd1976" class="">centralized logging system<div class="indented"><p id="eb0f1f03-7c18-4bb6-9b75-fae73a6ea930" class="">å®¹å™¨æ ‡å‡†è¾“å‡ºï¼Œdockerå†™å…¥æ—¥å¿—ï¼Œfluentdé‡‡é›†å¹¶å‘é€åˆ°è¿œç«¯çš„æ—¥å¿—åˆ†ææœåŠ¡å™¨</p><p id="e194a322-ed89-447d-b85d-9c28f85d4322" class="">è¾“å…¥çš„æ—¥å¿—å«åŸå§‹æ•°æ®ï¼Œinputæ’ä»¶æ ¹æ®æ ¼å¼çŸ¥é“æ•°æ®çš„ç»„æˆéƒ¨åˆ†ï¼ˆé‚£äº›æ˜¯æ—¶é—´ï¼Œå“ªäº›æ˜¯æ¶ˆæ¯ï¼‰</p></div></p><p id="de8e3f58-d98d-4514-ab4a-c9da4bf29c58" class="">fluentdå®˜æ–¹gitï¼š <a href="https://github.com/fluent/fluentd-kubernetes-daemonset">https://github.com/fluent/fluentd-kubernetes-daemonset</a></p><p id="2e1c5927-ed42-47a2-9267-4f8dbed7afa7" class="">parserå­—æ®µå®šä¹‰å¦‚ä½•è§£æåŸå§‹æ•°æ®ï¼Œæ¯”å¦‚apacheçš„ï¼Œnginxçš„ï¼š<a href="https://docs.fluentd.org/configuration/parse-section#parse-section-overview">https://docs.fluentd.org/configuration/parse-section#parse-section-overview</a><div class="indented"><p id="9eee0153-abc3-4208-921f-9deb9ecf4794" class="">can be under &lt;source&gt;, &lt;match&gt; or &lt;filter&gt; sectionï¼ŒIt is enabled for the plugins that support parser plugin features</p><p id="5666de63-3fd6-42a8-ab5d-b00f4299a871" class="">fluentdæ ¸å¿ƒå†…å»ºäº†ä¸€äº›å¸¸ç”¨parseræ’ä»¶ï¼Œå…¶ä»–çš„éœ€è¦è‡ªå·±æ‰‹åŠ¨æ·»åŠ ï¼Œæ¯”å¦‚ä¸‹é¢çš„kubernetesçš„parseæ’ä»¶å°±ä¸æ˜¯è‡ªå¸¦çš„</p><pre id="8b786743-3f19-4640-8aa6-0577862cadcc" class="code code-wrap"><code>&lt;parse&gt;
  @type kubernetes
  @type &quot;#{ENV[&#x27;FLUENT_CONTAINER_TAIL_PARSER_TYPE&#x27;] || &#x27;json&#x27;}&quot;  #å› ä¸ºdockerè¾“å‡ºçš„æ—¥å¿—æ˜¯jsonæ‰€ä»¥è½¬æˆJSONï¼Œå˜é‡æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ
  time_format %Y-%m-%dT%H:%M:%S.%NZ
&lt;/parse&gt;</code></pre></div></p><p id="950e2300-69c2-4eaf-b19f-5a984ddf5d31" class=""><code>#{ENV[...]}</code> è¿™æ˜¯rubyè¡¨è¾¾å¼ï¼Œç›®å‰çœ‹matchã€paserã€filterå—ä¸­éƒ½å¯ä»¥ç”¨</p><p id="b2c3514e-570c-429f-972c-46931b1791e1" class="">
</p><p id="5c013178-a086-4d79-a3af-8411e51e8b4d" class="">é’ˆå¯¹K8Sï¼Œtailæ’ä»¶éœ€è¦è·Ÿè¸ª/var/log/containersç›®å½•ï¼Œå…¶ä¸­ä¿å­˜æ‰€æœ‰å®¹å™¨æ—¥å¿—<div class="indented"><p id="6983a740-2a6a-45b9-b464-d01880228c1e" class="">å„ç§å®¹å™¨è¿è¡Œæ—¶ï¼ŒæŒ‰è§„èŒƒï¼Œå°†å®¹å™¨ç›®å½•é“¾æ¥åˆ°K8S Nodeçš„/var/log/containersç›®å½•ï¼Œä»¥ä¿æŒè·¯å¾„ä¸€è‡´</p></div></p><p id="a27f8e80-319b-47b4-ada3-3d66e28d9754" class="">
</p><p id="07ec7649-d519-4180-95ff-a62bcf6188d2" class="">fluentDç”Ÿæˆçš„å®¹å™¨æ—¥å¿—æ–‡ä»¶å’Œé“¾æ¥ï¼Œä»¥ä¸‹æ˜¯ç¤ºä¾‹<div class="indented"><p id="efc668e1-9856-4933-906f-81139ad31ffa" class="">å®¹å™¨å’ŒPodæ—¥å¿—ç›®å½•ï¼Œåº”è¯¥æ˜¯kubeletäº§ç”Ÿçš„ï¼š<div class="indented"><p id="adc23a3e-654f-4f44-b912-644ddef5ecc5" class="">è¿™æ˜¯é“¾æ¥å…³ç³»ï¼š/var/log/containers/podå_å‘½åç©ºé—´_å®¹å™¨å_å®¹å™¨ID.log â†’ /var/log/pods/å‘½åç©ºé—´_podå_podID/å®¹å™¨å/æ•°å­—.log â†’ /var/lib/containers/å®¹å™¨ID-json.log</p></div></p><pre id="72a92c08-9739-4841-9bed-c540bed66cad" class="code code-wrap"><code>containers/counter_default_count-94655d0176675b144209b497aa8b9589687b3fbcb9932a81f789f1b1f7ae06ff.log -&gt; /var/log/pods/default_counter_4e540339-1a56-40b4-884c-835ed9a51278/count/0.log</code></pre></div></p><p id="d5a0a130-b25c-41c0-9628-9f432d033334" class="">
</p></div></p><h1 id="b1d42d44-5ab9-4e26-ad4c-6f7106173213" class=""><time>@October 17, 2021</time> </h1><ol type="1" id="3f68d0d2-ede8-4c42-9b41-164032e3b4fe" class="numbered-list" start="1"><li><mark class="highlight-teal">å¤ä¹ ä¸€ä¸‹ESï¼Œå·²ç»å¤ä¹ äº†ç¬¬ä¸€é</mark></li></ol><ol type="1" id="b01fc587-26e5-43ce-8cef-b701513f03bc" class="numbered-list" start="2"><li>ESçš„ä¸»æœºæ–¹å¼çš„å®‰è£…å’Œæ­å»ºé›†ç¾¤<p id="125ddb72-1ef3-4a59-97d8-919efbf02e20" class="">è™½ç„¶ESæ˜¯JAVAå†™çš„ï¼Œä½†æ˜¯ä¸ç”¨å®‰è£…å› ä¸ºåŒ…é‡Œè‡ªå¸¦JDKä¸”é»˜è®¤æŒ‡å‘è‡ªå¸¦çš„JDK</p><p id="6af58e33-f3a8-47c4-96b4-fd6a52b7a697" class="">RPMå®‰è£…: <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/rpm.html">https://www.elastic.co/guide/en/elasticsearch/reference/current/rpm.html</a></p><pre id="479a2b7a-d644-4cf8-aa27-e50bace7d523" class="code code-wrap"><code>
æ–¹æ³•1ï¼š
rpm --import https://artifacts.elastic.co/GPG-KEY-elasticsearch
[elasticsearch]
name=Elasticsearch repository for 7.x packages
baseurl=https://artifacts.elastic.co/packages/7.x/yum
gpgcheck=1
gpgkey=https://artifacts.elastic.co/GPG-KEY-elasticsearch
enabled=0
autorefresh=1
type=rpm-md
yum install --enablerepo=elasticsearch elasticsearch
æ–¹æ³•2
wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.15.1-x86_64.rpm
wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.15.1-x86_64.rpm.sha512
shasum -a 512 -c elasticsearch-7.15.1-x86_64.rpm.sha512 
sudo rpm --install elasticsearch-7.15.1-x86_64.rpm

ç›´æ¥å¯åŠ¨å³å¯
systemctl enable --now elasticsearch

å½“ä½¿ç”¨RPMæˆ–debianåŒ…å¹¶ä¸”ä½¿ç”¨systemdç®¡ç†ï¼Œéœ€é€šè¿‡systemdæ¥è®¾ç½®system limit
systemctl edit elasticsearchç„¶åæ·»åŠ ï¼Œæœ€åsystemctl daemon-reload</code></pre><p id="5a329a32-cdf1-4aa3-abed-0b8229046898" class="">é›†ç¾¤é…ç½®</p><pre id="63df0850-aba3-4a51-8788-66bb883d47ba" class="code code-wrap"><code>é…ç½®æ–‡ä»¶
RPMåŒ…æœ‰ä¸¤ä¸ªä¸»è¦çš„é…ç½®æ–‡ä»¶
		/etc/sysconfig/elasticsearch ä¿å­˜ä¸€äº›ESç¯å¢ƒå˜é‡ï¼Œå…¶ä¸­ES_PATH_CONF=/etc/elasticsearchæŒ‡å®šé»˜è®¤é…ç½®æ–‡ä»¶çš„ä½ç½®
		/etc/elasticsearch/elasticsearch.yml ä¸»è¦å‚æ•°é…ç½®æ–‡ä»¶
			é…ç½®æ–‡ä»¶é‡‡ç”¨YAMLæ ¼å¼
			å…·ä½“æ ¼å¼https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html#_config_file_format

ESéœ€è°ƒæ•´çš„ä¸å¤šï¼Œä¸ç”Ÿäº§ç›¸å…³çš„ï¼Œéœ€æ³¨æ„çš„é…ç½®å‚æ•°ï¼š
	1.path.dataå­—æ®µï¼šindexç›¸å…³æ•°æ®çš„ç›®å½•ï¼Œå»ºè®®ç”¨LVMï¼Œé¿å…å·ç©ºé—´ä¸è¶³
	2.path.logå­—æ®µï¼šèŠ‚ç‚¹å’Œé›†ç¾¤å¥åº·å’Œæ“ä½œç›¸å…³æ—¥å¿—çš„ç›®å½•
		è­¦å‘Šï¼šäºŒè¿›åˆ¶å®‰è£…çš„ï¼Œé»˜è®¤dataç›®å½•ä½äºES_HOMEä¸‹ï¼Œå‡çº§åæœ‰è¦†ç›–å±é™©ï¼Œå®‰è£…æ—¶æŒ‡å®šdataå­—æ®µå°†å…¶æ”¾äºä¹‹å¤–
	        RPMå®‰è£…çš„ï¼Œä¸ä¼šæœ‰é—®é¢˜ï¼Œé»˜è®¤æ”¾äºä¹‹å¤–
	  é‡è¦ï¼šdataç›®å½•åº”åªè¢«elasticsearchæ‰“å¼€ï¼Œå…¶ä»–æœåŠ¡ä¸å¯è®¿é—®ï¼ŒåŒ…æ‹¬antivirus
  3.cluster.name
	  clusterå­—æ®µåç§°ä¸€è‡´ï¼ŒèŠ‚ç‚¹æ‰èƒ½åŠ å…¥é›†ç¾¤
    é»˜è®¤elasticsearch,å¯èµ·åˆ«çš„æ¯”å¦‚logging-prodï¼Œç”¨-prodæ ‡æ³¨å®ƒæ˜¯ç”Ÿäº§ç¯å¢ƒæ˜¯å¥½ä¹ æƒ¯
	4.node.name ä¸è®¾ç½®åˆ™é»˜è®¤æ˜¯ä¸»æœºå
  5.network.host 
		ç»‘å®šåœ°å€
		å½“è®¾ç½®ä¸ºéloopbackåœ°å€ï¼ŒESè®¤ä¸ºæ˜¯é…ç½®åœ¨ç”Ÿäº§ç¯å¢ƒï¼Œä»»ä½•æ£€æŸ¥å¤±è´¥éƒ½é€ æˆexceptionsè€Œä¸æ˜¯warmingã€‚æ‰€ä»¥æœ‰ä¸¤ç§æ¨¡å¼ï¼šproductionå’Œdevelopment
	6.discovery.seed_hosts æŒ‡å®šå…¶ä»–master-eligibleèŠ‚ç‚¹ï¼Œè‡ªåŠ¨å‘ç°
		æç¤ºï¼šå¦‚network.hostä¸ºç¯å›åœ°å€åˆ™è®¤ä¸ºæ˜¯developmentï¼Œè‡ªåŠ¨å‘ç°9300-9305çš„æœ¬åœ°çš„å…¶ä»–å‡ ç‚¹
    å®ƒçš„å€¼æ˜¯åˆ—è¡¨ï¼Œä¸‹é¢å†™éƒ½å¯ä»¥ï¼Œä¸å†™ç«¯å£å³9300
        [&quot;IP1&quot;,&quot;IP2&quot;]
        - IP1:9300
        - IP2
  7.cluster.initial_master_nodes 
		æ–°é›†ç¾¤ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶,éœ€æ‰€æœ‰eligible masterèŠ‚ç‚¹ä¸Šï¼Œç”¨è¯¥å­—æ®µï¼Œæ˜¾å¼å®šä¹‰æ‰€æœ‰çš„eligible masterèŠ‚ç‚¹ï¼Œä»¥å®Œæˆboostrappingã€‚
    æ¯ä¸ªèŠ‚ç‚¹ä¸Šï¼Œè¯¥è®¾ç½®éƒ½è¦ç›¸åŒåˆ‡è®°ï¼Œæ¯”å¦‚
    cluster.initial_master_nodes:
	  - master-a
	  - master-b
	  - master-c
    è¿™åªå‘ç”Ÿåœ¨ç¬¬ä¸€æ¬¡å¯åŠ¨ï¼Œboostrappingåè¿™å‡ ä¸ªèŠ‚ç‚¹éƒ½ä¿å­˜ä¸€ä»½é›†ç¾¤çŠ¶æ€äºdataç›®å½•ä¸­ï¼Œæ­¤åæ–°çš„èŠ‚ç‚¹å°†ä»elected masterèŠ‚ç‚¹å¾—åˆ°ä¸€ä»½é›†ç¾¤çŠ¶æ€ä¿¡æ¯
		å®ƒçš„å€¼æ˜¯åˆ—è¡¨ï¼Œå…ƒç´ æ˜¯èŠ‚ç‚¹çš„node.name(å¦‚æœªè®¾ç½®åˆ™å¡«å®ƒçš„ä¸»æœºåæˆ–network.hostæŒ‡å®šçš„åœ°å€ç«¯å£)
		å½“é›†ç¾¤å·²å½¢æˆï¼Œä¸è¦ä¸ºæ–°èŠ‚ç‚¹åŠ å…¥è¿™ä¸ªå­—æ®µï¼Œä¹Ÿä¸è¦ä¸ºineligible masterèŠ‚ç‚¹è®¾ç½®

ä¸ç”Ÿäº§ç›¸å…³çš„ï¼Œéœ€æ³¨æ„çš„ç³»ç»Ÿå‚æ•°ï¼š
	 1.å…³é—­swap 
			swapoff -a å¯ä¸ç”¨é‡å¯
			å¦å¤–æ³¨é‡Š/etc/fstabçš„swap sed -ri &#x27;s@(.*swap.*)@#\1@&#x27; /etc/fstab
   2.æ–‡ä»¶æè¿°ç¬¦ä¸Šè°ƒè‡³65535æˆ–æ›´é«˜ï¼Œ
			RPMä¸ç”¨è°ƒæ•´
			äºŒè¿›åˆ¶/etc/security/limits.conf nofileè°ƒä¸º65535
			ç”¨CURLæŸ¥è¯¢ï¼šGET _nodes/stats/process?filter_path=**.max_file_descriptors
		è™šæ‹Ÿå†…å­˜mmapä¸Šè°ƒè‡³262144
				ESä½¿ç”¨mmapä¿å­˜ç´¢å¼•
				RPMåŒ…ä¸ç”¨ä¿®æ”¹ï¼Œ
				äºŒè¿›åˆ¶ï¼šä¸´æ—¶ä¿®æ”¹sysctl -w vm.max_map_count=262144ï¼Œåœ¨/etc/sysctl.confæ–‡ä»¶æ°¸ä¹…ä¿®æ”¹vm.max_map_count
    çº¿ç¨‹æ•°è°ƒæ•´
				äºŒè¿›åˆ¶ï¼šä¸´æ—¶ulimit -u 4096ï¼Œæ°¸ä¹…/etc/security/limits.confçš„npcè®¾ä¸º4096
				RPMåŒ…ï¼šä¸ç”¨ä¿®æ”¹

æœ€ç»ˆé…ç½®ç±»ä¼¼è¿™æ ·ï¼Œè¿™æ˜¯node-1ï¼Œå…¶ä»–èŠ‚ç‚¹ç›¸åº”ä¿®æ”¹
cluster.name: mxy-prod
node.name: node-1
path.data: /var/lib/elasticsearch
path.logs: /var/log/elasticsearch
network.host: 192.168.31.201
discovery.seed_hosts: 
- 192.168.31.201
- 192.168.31.202
- 192.168.31.203
cluster.initial_master_nodes:
- node-1
- node-2
- node-3


å¯åŠ¨åæŸ¥çœ‹å‘½ä»¤
curl -XGET http://192.168.31.201:9200/?pretty ç¡®è®¤æ‰€æœ‰èŠ‚ç‚¹çš„cluster_uuidå·²è·å–
curl -XGET http://192.168.31.201:9200/_cluster/state/master_node?pretty
curl -XGET http://192.168.31.201:9200/_cluster/state/nodes?pretty</code></pre></li></ol><p id="119c293a-fce8-4da2-b696-4d49fec0ce80" class="">   </p><h1 id="8028c71f-3f8b-4b5f-9f22-d58bceccacf8" class=""><time>@October 18, 2021</time> </h1><p id="31bfca53-c816-48cf-ba65-87756f87ce75" class="">ES<div class="indented"><p id="abfaa460-58f7-4475-94c8-4d9c4e9d6f3c" class=""><code>resource.reload.interval.high</code> ESèƒ½å¤Ÿmonitorç›¸å…³æ–‡ä»¶(rtificates, keys, keystores, or truststoreså’Œä¸»æœºå)å¹¶è‡ªåŠ¨åŠ è½½ï¼Œé»˜è®¤5ç§’é’Ÿ</p><p id="77e86d88-470a-471b-bf2b-d308ebc11931" class="">ä¼˜åŒ–çš„index template<div class="indented"><pre id="70029f51-a018-4db6-a296-f568841556d9" class="code code-wrap"><code>
#mapping
&quot;settings&quot;: {
  &quot;index.mapping.ignore_malformed&quot;: true,
  &quot;index.query.default_field&quot;: &quot;message&quot;,
  &quot;index.refresh_interval&quot;: &quot;30s&quot;,
  &quot;index.search.slowlog.threshold.query.debug&quot;: &quot;0ms&quot;,
  &quot;index.search.slowlog.threshold.query.info&quot;: &quot;1s&quot;,
  &quot;index.search.slowlog.threshold.fetch.debug&quot;: &quot;0ms&quot;,
  &quot;index.search.slowlog.threshold.fetch.info&quot;: &quot;1s&quot;,
  &quot;index.translog.sync_interval&quot;: &quot;1m&quot;,
  &quot;index.number_of_shards&quot;: 4
  &quot;index.number_of_replicas&quot;: 1
}</code></pre></div></p><p id="b9036c8c-51bc-47d0-b82d-55e5aaa38536" class="">ä¸»æœºä¸Šç”¨RPMå®‰è£…Kibana<div class="indented"><p id="d07c7910-f949-4fb6-a8d6-5ea4bd7c9957" class="">é…ç½®<div class="indented"><pre id="bb93d70e-f4d6-4f2c-8212-8cff82487026" class="code code-wrap"><code>#/etc/kibana/kibana.ymlé…ç½®æ–‡ä»¶
server.host: &quot;192.168.31.201&quot;
elasticsearch.hosts: 
- http://192.168.31.201:9200
- http://192.168.31.202:9200
- http://192.168.31.203:9200</code></pre><p id="b091e642-94f5-4f28-b40f-c0181cad98ca" class="">å’ŒESä¸€æ ·ï¼Œé…ç½®æ–‡ä»¶é‡‡ç”¨YAMLæ ¼å¼ï¼Œé”®å¯ä»¥åˆ†çº§å†™ï¼›å€¼æœ‰ç±»å‹ï¼Œå¦‚æ˜¯åˆ—è¡¨åˆ™å¯[&quot;item1&quot;,&quot;item2&quot;],æˆ–å¦èµ·ä¸€è¡Œå¼€å¤´-å†™ä¸”ä¸ç”¨å¼•å·ï¼›å¦‚æ˜¯å­—ç¬¦ä¸²åˆ™åŒå¼•å·ï¼›å¦‚æ˜¯å¸ƒå°”åˆ™ä¸ç”¨å¼•å·ï¼Œå¦‚æ˜¯æ•°å­—ä¸ç”¨å¼•å·</p><p id="99bc6da2-69ca-4c2d-b58a-77fc23dd2a9b" class="">æ—¥å¿—è·¯å¾„:/var/log/kibana/kibana.log</p><p id="f4fc9122-81b8-47cc-befa-ee6d3300c565" class="">
</p><p id="90afa458-e8b5-45ea-9ad7-a0f686299910" class="">
</p></div></p></div></p></div></p><p id="f1673ac8-556a-4d36-b9af-37f47d871614" class="">
</p><p id="dac91aa9-d7b8-45d1-8742-98d233682f8f" class="">
</p><p id="8599591f-3b46-467f-aead-513710ab7eb8" class="">æ•´ç†å¥½çš„<div class="indented"><p id="e586e3a7-324a-45b2-91fc-86ff79730cef" class="">å‘½ä»¤æ€»ç»“<div class="indented"><pre id="97f18195-21dd-4f1f-b182-3075ffe4dcbe" class="code code-wrap"><code>å¯åŠ¨åæŸ¥çœ‹å‘½ä»¤
curl -XGET http://192.168.31.201:9200/?pretty ç¡®è®¤æ‰€æœ‰èŠ‚ç‚¹çš„cluster_uuidå·²è·å–
curl -XGET http://192.168.31.201:9200/_cluster/state/master_node?pretty
curl -XGET http://192.168.31.201:9200/_cluster/state/nodes?pretty
curl -XGET http://192.168.31.202:9200/_cluster/health
curl -XGET http://192.168.31.202:9200/_cat/indices?pretty
curl -XGET http://192.168.31.202:9200/_cat/nodes?pretty
curl -XGET http://192.168.31.202:9200/cat/shards
#æŸ¥çœ‹æ‰€æœ‰èŠ‚ç‚¹
GET /_cat/nodes
#æŸ¥çœ‹æ‰€æœ‰ç´¢å¼•
GET /_cat/indices

#æŸ¥çœ‹èŠ‚ç‚¹å±æ€§
GET /_cat/nodeattrs?v</code></pre></div></p><p id="0c3c45dc-7943-40c7-bf2a-a6eb8afe27f5" class="">fluentD<div class="indented"><p id="feb42512-6ce0-41c1-970c-a8e7cd203103" class=""><code>@type</code> æŒ‡å®šæ’ä»¶ç±»å‹</p><p id="9f3aead2-8e7a-452f-aac2-32d7f9ef7fb7" class=""><code>@id</code> Filter plugins by plugin id <mark class="highlight-orange">åˆ°åº•æ˜¯ç”¨æ¥åšä»€ä¹ˆçš„ï¼Ÿ</mark></p><p id="d7baf391-8997-4377-9afd-72d58b4e69a0" class="">é‡‡ç”¨äº†rubyæ¨¡æ¿è¡¨è¾¾å¼<code>&quot;#{}&quot; </code>é™¤äº†å˜é‡å…¶ä»–éƒ½è¦ç”¨å•å¼•å·æ‹¬èµ·æ¥</p><p id="e23d411b-9eb1-4522-93be-09ed416c27f2" class="">å¯åŠ¨æ—¶ä¼šè§£æé…ç½®æ–‡ä»¶ï¼Œrubyæ¨¡æ¿æ¸²æŸ“åå¦‚ä¸‹<div class="indented"><pre id="dc130b43-faac-4e11-a20f-cea8d9c35e05" class="code code-wrap"><code>&lt;source&gt;
    @type tail
    read_from_head true
    tag &quot;kubernetes.*&quot;
    path &quot;/var/log/containers/*.log&quot;
    pos_file &quot;/var/log/fluentd-containers.log.pos&quot;
    exclude_path [&quot;/var/log/containers/fluent*&quot;]
    &lt;parse&gt;
      @type &quot;json&quot;
      time_format &quot;%Y-%m-%dT%H:%M:%S.%NZ&quot;
      unmatched_lines 
      time_type string
    &lt;/parse&gt;
  &lt;/source&gt;

  &lt;filter kubernetes.**&gt;
    @type kubernetes_metadata
    @id filter_kube_metadata
    kubernetes_url &quot;https://10.96.0.1:443/api&quot;
    verify_ssl true
    ca_file &quot;&quot;
		skip_labels false
    skip_container_metadata false
    skip_master_url false
    skip_namespace_metadata false
  &lt;/filter&gt;

  &lt;match **&gt;
    @type elasticsearch
    host &quot;192.168.31.201&quot;
    port 9200
    logstash_prefix &quot;logstash&quot;
    logstash_dateformat &quot;%Y.%m.%d&quot;
    logstash_format true
    include_timestamp false
    type_name &quot;fluentd&quot;
  &lt;/match&gt;</code></pre></div></p><p id="50927d83-2d6b-4294-b38f-a572731dc71f" class="">fluentDçš„é…ç½®æ¨¡æ¿ä¸è§£é‡Š<div class="indented"><pre id="1cd842f4-8731-4034-bf34-025083a80b10" class="code code-wrap"><code>&lt;source&gt;
  @type tail
  @id in_tail_container_logs
  path /var/log/containers/*.log
  pos_file /var/log/fluentd-containers.log.pos
  tag &quot;#{ENV[&#x27;FLUENT_CONTAINER_TAIL_TAG&#x27;] || &#x27;kubernetes.*&#x27;}&quot;
  exclude_path &quot;#{ENV[&#x27;FLUENT_CONTAINER_TAIL_EXCLUDE_PATH&#x27;] || use_default}&quot;
  read_from_head true
  &lt;parse&gt;
    @type &quot;#{ENV[&#x27;FLUENT_CONTAINER_TAIL_PARSER_TYPE&#x27;] || &#x27;json&#x27;}&quot;
    time_format %Y-%m-%dT%H:%M:%S.%NZ
  &lt;/parse&gt;
&lt;/source&gt;


&lt;filter kubernetes.**&gt;
  @type kubernetes_metadata
  @id filter_kube_metadata
  kubernetes_url &quot;#{ENV[&#x27;FLUENT_FILTER_KUBERNETES_URL&#x27;] || &#x27;https://&#x27; + ENV.fetch(&#x27;KUBERNETES_SERVICE_HOST&#x27;) + &#x27;:&#x27; + ENV.fetch(&#x27;KUBERNETES_SERVICE_PORT&#x27;) + &#x27;/api&#x27;}&quot;
  verify_ssl &quot;#{ENV[&#x27;KUBERNETES_VERIFY_SSL&#x27;] || true}&quot;
  ca_file &quot;#{ENV[&#x27;KUBERNETES_CA_FILE&#x27;]}&quot;
  skip_labels &quot;#{ENV[&#x27;FLUENT_KUBERNETES_METADATA_SKIP_LABELS&#x27;] || &#x27;false&#x27;}&quot;
  skip_container_metadata &quot;#{ENV[&#x27;FLUENT_KUBERNETES_METADATA_SKIP_CONTAINER_METADATA&#x27;] || &#x27;false&#x27;}&quot;
  skip_master_url &quot;#{ENV[&#x27;FLUENT_KUBERNETES_METADATA_SKIP_MASTER_URL&#x27;] || &#x27;false&#x27;}&quot;
  skip_namespace_metadata &quot;#{ENV[&#x27;FLUENT_KUBERNETES_METADATA_SKIP_NAMESPACE_METADATA&#x27;] || &#x27;false&#x27;}&quot;
&lt;/filter&gt; 


&lt;match **&gt;
  @type elasticsearch
  #host &quot;#{ENV[&#x27;FLUENT_ELASTICSEARCH_HOST&#x27;] || &#x27;elasticsearch.elastic-kibana&#x27;}&quot;  å¯åœ¨deployå¯¹è±¡ä¸­å®šä¹‰FLUENT_ELASTICSEARCH_HOSTçš„å€¼
  host 192.168.31.201
  port &quot;#{ENV[&#x27;FLUENT_ELASTICSEARCH_PORT&#x27;] || &#x27;9200&#x27;}&quot; å¯åœ¨deployå¯¹è±¡ä¸­å®šä¹‰FLUENT_ELASTICSEARCH_PORTçš„å€¼
  logstash_prefix logstash     ç´¢å¼•çš„å‰ç¼€
  logstash_dateformat %Y.%m.%d  ä¾‹å¦‚æ˜¾ç¤ºä¸ºlogstash-2021.10.18
  logstash_format true   æ—¶é—´æ ¼å¼ï¼Œä½†ä¹Ÿä¸å¤ªæ¸…æ¥š   
  index_name logstash    è¦ESä¸­çš„ç´¢å¼•çš„å‰ç¼€ï¼Œè¿™ä¸logstash_prefixæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ
  include_timestamp false  åœ¨documentä¸­å¢åŠ ä¸€ä¸ª@timestampçš„å­—æ®µ
&lt;/match&gt;</code></pre></div></p><p id="75d9cb01-a2eb-44c5-b94a-0e363a0fecda" class="">
</p><p id="2f6f31cf-7a41-4564-b90f-a5afe3064fbc" class="block-color-teal_background">å®ç°EFKçš„è®¤è¯<div class="indented"><p id="f5db5ce9-c05a-4a65-95cf-ec014a785b4a" class="">ElasticSearchæä¾›äº†åŸºç¡€BASICå®‰å…¨ï¼Œè¿™æ˜¯å¿…è¦çš„ï¼š<div class="indented"><p id="5fdbb75f-4019-4a5d-be10-2fa202c719a8" class="">fluentDé€šè¿‡è®¤è¯åæ‰å¯ä»¥å‘å…¶ç´¢å¼•æ—¥å¿—æ—¥å¿—ï¼Œé˜²æ­¢æ¶æ„ä¿®æ”¹æ•°æ®</p><p id="62e2e128-2931-4c32-9a9a-2f3b55d829c5" class="">Kibanaä¸Šéœ€è¦è¾“å¯†ç æ‰å¯ç™»é™†</p></div></p><p id="186fc9fa-e062-43d0-84fa-a9c2a3b6a0cf" class="">æ“ä½œæ­¥éª¤ï¼š<div class="indented"><ol type="1" id="cfadc90b-b3be-45ca-a884-1ce58d016962" class="numbered-list" start="1"><li>å®ç°BASICè®¤è¯ä¹‹å‰ï¼Œéœ€è¦å…ˆå®ç°TLSï¼Œåº”è¯¥æ˜¯é˜²æ­¢å¯†ç ä¿¡æ¯è¢«çªƒå¬ï¼Œå‚è€ƒ<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/security-basic-setup.html">https://www.elastic.co/guide/en/elasticsearch/reference/current/security-basic-setup.html</a><ol type="a" id="2e8befb5-42e1-40a5-bca4-4fc60a5e646f" class="numbered-list" start="1"><li>æ‰€æœ‰èŠ‚ç‚¹å…³é—­Kibanaå’ŒES</li></ol><ol type="a" id="51c846ff-1c59-48bd-a721-d5a9d21e8195" class="numbered-list" start="2"><li>æ‰€æœ‰èŠ‚ç‚¹ï¼Œåœ¨/etc/elasticsearch.ymlæ–‡ä»¶åŠ å…¥<pre id="6413315d-a3c1-4933-a823-ba62982d1fe2" class="code code-wrap"><code>xpack.security.enabled: true
xpack.security.transport.ssl.enabled: true</code></pre></li></ol><ol type="a" id="34233f7b-087a-46e7-8e5d-a918d0068f1d" class="numbered-list" start="3"><li>å¯åŠ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šçš„ES</li></ol><ol type="a" id="25adf813-a2a6-4580-931e-ea962c1b40a4" class="numbered-list" start="4"><li>åœ¨ä»»ä¸€ä¸ªèŠ‚ç‚¹ä¸Šæ‰§è¡Œï¼Œè®°ä½æ˜¯ä»»æ„ä¸€ä¸ªï¼Œåªæ‰§è¡Œä¸€æ¬¡å³å¯<pre id="38a1a0c9-e956-44e9-af7b-6a2aff57c40e" class="code code-wrap"><code>
/usr/share/elasticsearch/bin/elasticsearch-certutil ca #ç”Ÿæˆelastic-stack-ca.p12ï¼Œå¯è‡ªå®šä¹‰æ–‡ä»¶åï¼Œå®ƒåŒ…å«CAè¯ä¹¦å’Œç­¾å‘è¯ä¹¦çš„å¯†é’¥ï¼›æç¤ºè¾“å…¥å¯†ç ï¼Œå¯ä¸ºç©º
/usr/share/elasticsearch/bin/elasticsearch-certutil cert --ca elastic-stack-ca.p12 #ä¸ºèŠ‚ç‚¹ç”Ÿæˆkeystoreæ–‡ä»¶ï¼ŒåŒ…å«äº†èŠ‚ç‚¹è¯ä¹¦å¯†é’¥å’ŒCAè¯ä¹¦ï¼Œæç¤ºè¾“å…¥å¯†ç å¯ç•™ç©º</code></pre></li></ol><ol type="a" id="cab6497f-d1be-4ae0-a579-745e1abb2e25" class="numbered-list" start="5"><li>å°†keystoreæ–‡ä»¶æ‹·è´åˆ°å…¶ä»–èŠ‚ç‚¹ä¸Šçš„$ES_PATH_CONFç›®å½•ä¸‹ï¼ŒRPMåŒ…å®‰è£…æ–¹å¼çš„ä½äº/etc/elasticsearch<p id="18eb83aa-784e-48bc-94b6-533fe59e3e2b" class="">æ³¨æ„æ–‡ä»¶çš„æƒé™ï¼Œæ‹·è´ä¹‹å‰å…ˆ<code>chmod g+rw </code></p><pre id="d4211e4a-b5ec-4e57-9535-1757b080ee73" class="code code-wrap"><code>#æ‹·è´å¥½ä¹‹åï¼Œæ‰€æœ‰èŠ‚ç‚¹ä¸Šï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­åŠ å…¥ä»¥ä¸‹ï¼šå¼€å¯èŠ‚ç‚¹ä¹‹é—´çš„TLSé€šä¿¡å’ŒæŒ‡å®šè¯ä¹¦æ–‡ä»¶ï¼Œç„¶åå†æ¬¡é‡å¯
xpack.security.transport.ssl.verification_mode: certificate
xpack.security.transport.ssl.client_authentication: required
xpack.security.transport.ssl.keystore.path: elastic-certificates.p12
xpack.security.transport.ssl.truststore.path: elastic-certificates.p12</code></pre></li></ol><ol type="a" id="52384330-8ce6-4d6a-9607-17679580c0d4" class="numbered-list" start="6"><li>æ‰€æœ‰çš„èŠ‚ç‚¹ï¼Œå¯åŠ¨ESæœåŠ¡, è·Ÿè¸ªä¸€ä¸‹æ—¥å¿—ï¼Œçœ‹åˆ°è¿™ä¸ªå°±è¡¨ç¤ºèŠ‚ç‚¹é—´é€šè¿‡TLSé€šä¿¡äº†ï¼Œè®°å¾—æ£€æŸ¥é›†ç¾¤çŠ¶æ€<pre id="7472cc03-1a2f-4f82-8c9d-56102600e030" class="code code-wrap"><code>[2021-10-18T07:52:07,107][INFO ][o.e.n.Node               ] [node-1] started
[2021-10-18T07:52:07,551][INFO ][o.e.l.LicenseService     ] [node-1] license [2bc4b40c-23f3-446b-a6ac-1fe7eaec20f1] mode [basic] - valid
[2021-10-18T07:52:07,553][INFO ][o.e.x.s.a.Realms         ] [node-1] license mode is [basic], currently licensed security realms are [reserved/reserved,file/default_file,native/default_native]
[2021-10-18T07:52:07,555][INFO ][o.e.x.s.s.SecurityStatusChangeListener] [node-1] Active license is now [BASIC]; Security is enabled</code></pre></li></ol></li></ol><ol type="1" id="72804466-fc4e-4093-9fb0-de2441bbb07d" class="numbered-list" start="7"><li>å®ç°BASICè®¤è¯ï¼Œå‚è€ƒ<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/security-minimal-setup.html#security-create-builtin-users">https://www.elastic.co/guide/en/elasticsearch/reference/current/security-minimal-setup.html#security-create-builtin-users</a><ol type="a" id="e6fdd3c2-0386-4132-b93b-1f8a48b86770" class="numbered-list" start="1"><li>RPMåŒ…çš„ï¼Œå‘½ä»¤ä½äº/usr/share/elasticsearch/bin/<p id="279e491a-b9c4-4ef3-8b71-cb25375ae10b" class="">å°†ç»“æœä¿å­˜åœ¨~/elasticsearch.password</p><pre id="f1e63eaa-21f0-427f-bfe1-550478570ba7" class="code code-wrap"><code>/usr/share/elasticsearch/bin/elasticsearch-setup-passwords auto</code></pre></li></ol><ol type="a" id="57ef251e-940a-4237-9f4f-53667c892f02" class="numbered-list" start="2"><li>åœ¨kibanaä¸Šä½¿ç”¨å†…å»ºç”¨æˆ·kibana_systemä»¥åŠåˆšç”Ÿæˆçš„å¯†ç <p id="74ec706d-83a8-4da3-ab85-60f6374ebf71" class="">kibanaä½¿ç”¨kibana_systemç”¨æˆ·æ‰§è¡Œä¸€äº›åå°ä»»åŠ¡æ•…éœ€é…ç½®</p><pre id="6b429a40-fbc9-47d0-9f26-faf54dd90fee" class="code code-wrap"><code>/usr/share/kibana/bin/kibana-keystore create
/usr/share/kibana/bin/kibana-keystore add elasticsearch.password  #è¿™é‡Œä¼šæç¤ºkibana_systemçš„å¯†ç </code></pre></li></ol><ol type="a" id="b1558520-d7f4-4636-9a31-9dadd6eda8c5" class="numbered-list" start="3"><li>é‡å¯Kibanaï¼Œå†æ¬¡ç™»é™†å°±ä¼šæç¤ºè¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼Œè¿™é‡Œè¾“å…¥ESçš„è¶…ç®¡elasticå’Œå®ƒçš„å¯†ç ï¼ŒBASICè®¤è¯å®ç°</li></ol><ol type="a" id="4dd658c8-d446-4cf7-829b-a1e7c75a4da8" class="numbered-list" start="4"><li>åœ¨fluentDä¸Šï¼Œæ·»åŠ ç”¨æˆ·åå’Œå¯†ç ï¼ŒBASICè®¤è¯å®ç°<pre id="c54dea82-4f4f-4da9-bfea-29cfe059965d" class="code code-wrap"><code>#ç”±äºESå¼€å¯äº†TLSï¼Œå¯¼è‡´fluentDæ— æ³•è¿æ¥ï¼Œå¦‚ä¸‹æ˜¯fluentDæ—¥å¿—
2021-10-18 12:19:12 +0000 [error]: #0 unexpected error error_class=Elasticsearch::Transport::Transport::Errors::Unauthorized error=&quot;[401] {\&quot;error\&quot;:{\&quot;root_cause\&quot;:[{\&quot;type\&quot;:\&quot;security_exception\&quot;,\&quot;reason\&quot;:\&quot;missing authentication credentials for REST request [/]\&quot;,\&quot;header\&quot;:{\&quot;WWW-Authenticate\&quot;:\&quot;Basic realm=\\\&quot;security\\\&quot; charset=\\\&quot;UTF-8\\\&quot;\&quot;}}],\&quot;type\&quot;:\&quot;security_exception\&quot;,\&quot;reason\&quot;:\&quot;missing authentication credentials for REST request [/]\&quot;,\&quot;header\&quot;:{\&quot;WWW-Authenticate\&quot;:\&quot;Basic realm=\\\&quot;security\\\&quot; charset=\\\&quot;UTF-8\\\&quot;\&quot;}},\&quot;status\&quot;:401}&quot;

#åœ¨matchå—ä¸­åŠ å…¥å‚æ•°ï¼Œé‡å¯fluentDå³å¯
user elastic
password y1SaSWSl5PS6zNdsBWXk</code></pre></li></ol></li></ol></div></p></div></p></div></p></div></p><p id="f40879ab-4038-488f-afc7-5eca61403cb0" class="">
</p><h1 id="f2220418-7828-4ad2-9d0f-c01753dedc2d" class=""><time>@October 19, 2021</time> </h1><p id="4e7ddf65-0aa4-45b1-8ad3-db9019e05c53" class="">
</p><p id="56142bdc-e21e-4f79-a45c-620c7378531b" class="">DEVOPSè§†é¢‘ç»§ç»­çœ‹ä¸€ä¸‹</p><p id="d470d6a5-28e8-4190-bc05-6cc3c0cf45b3" class="">Jenkinsç»§ç»­</p><figure id="fed5b127-055c-492a-b727-b7c5b4e56a3e" class="image"><a href="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%203.png"><img style="width:1072px" src="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%203.png"/></a></figure><p id="abe101de-13ff-4eca-ab46-66bbf9c6048a" class="">
</p><p id="efb04967-ac88-4354-a296-96f32f98862a" class="">
</p><p id="d80020d6-3991-4a2b-8a2a-dabd86d09a7c" class="">
</p><h1 id="9d6bae1b-06b0-4f85-9104-43784d275a0a" class=""><time>@October 20, 2021</time> </h1><p id="694fbcd4-6b91-44d8-aa8d-4d98d0f0a469" class="block-color-orange">é—®é¢˜<div class="indented"><p id="bbb9431f-1fba-419f-9d89-03ecc672838f" class="">ansible<div class="indented"><p id="56039d33-7bc2-4d53-8008-328afdcdcf33" class="">with_itemsä¸loopæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p></div></p></div></p><p id="8fd5a719-2164-4eb6-aae5-da7b5e469470" class="">å­¦ä¹ <div class="indented"><p id="9ef2cc7f-91dc-461d-87c0-56cdc33e77ed" class="block-color-orange_background">å¤šåˆ†æ”¯ç‰¹æ€§<div class="indented"><p id="76309bdc-ad44-4481-a101-3dd9d8fb1c94" class="">ä¸ºä»€ä¹ˆä½¿ç”¨ï¼Ÿ</p><p id="1437bf47-2d05-465d-a07e-81c36d268279" class="">å¦‚ä½•å®ç°<div class="indented"><ol type="1" id="53daffa2-5c5b-4311-b66b-168f004d6a2f" class="numbered-list" start="1"><li>SSH KEYå’ŒTOKEN<p id="89733986-d85e-4068-a688-401e988f5b3e" class="">å¤åˆ¶jenkinsä¸»æœºçš„sshå…¬é’¥.ssh/id_rsa.pubæ–‡ä»¶å†…å®¹ï¼Œç²˜è´´åˆ°gitlabUser Settingsâ†’SSH Keysâ†’Keyâ†’add Key</p><p id="19618a8e-a739-4640-91f9-2cfe061815e7" class="">è·å–gitç”¨æˆ·çš„tokenï¼Œæ³¨æ„scopæ˜¯api </p></li></ol><ol type="1" id="a6580046-9511-4aeb-aba1-210628afb481" class="numbered-list" start="2"><li>åœ¨Jenkinsä¸Šï¼Œåˆ›å»ºJENKINSä¸»æœºç§é’¥çš„å‡­è¯ï¼Œåˆ›å»ºTOKENçš„å‡­è¯</li></ol><ol type="1" id="5715b863-a244-460b-b9d8-a2c92bf267aa" class="numbered-list" start="3"><li></li></ol></div></p></div></p><p id="07cd2d81-1752-4d5a-9fba-c3f6f4f58ac9" class="block-color-teal_background">Kubernetes <div class="indented"><p id="5d4417da-4df0-477b-8771-5989c1e75c32" class="">Network<div class="indented"><p id="50e3c003-e638-42df-b729-de2bb2c433ca" class="">K8Sç½‘ç»œæ ‡å‡†ï¼š<div class="indented"><p id="efcadc8c-b536-4a0b-8a6e-00966ce79780" class="">æ‰€æœ‰èŠ‚ç‚¹ä¸Šçš„Podï¼Œä¹‹é—´å¯ä»¥äº’é€š,ä¸ä½¿ç”¨NAT</p><p id="c0894ae2-a4e1-46f4-90af-aadc7fe8fd89" class="">æ‰€æœ‰K8S SVCä¸æ‰€æœ‰Podä¹‹é—´å¯ä»¥äº’é€š,ä¸ä½¿ç”¨NAT</p></div></p><p id="280cc9cd-8597-4353-8b41-1074c487b21f" class="">ä¸‰ç§ç½‘ç»œ<div class="indented"><p id="f4960ded-a68e-4417-bc05-deeae012fff9" class="">èŠ‚ç‚¹ç½‘ç»œ</p><p id="3dfeadfc-bfa6-4b5d-8063-5d427f86ac1c" class="">Podç½‘ç»œ</p><p id="c1508ca8-6da6-4b28-9ac4-28a96d987606" class="">é›†ç¾¤ç½‘ç»œï¼ˆSVCä½¿ç”¨ï¼Œå¯å®šä¹‰æ®µï¼‰</p></div></p><p id="ddc77519-3b79-44dc-9aca-84e10f999d73" class="">ç½‘ç»œè®¿é—®æ¨¡å‹<div class="indented"><p id="0d43272a-5a72-4543-b72a-a47c414913ff" class="">åŒPODï¼Œå®¹å™¨é—´è®¿é—®é€šè¿‡localhost</p><p id="6fdddd33-31bf-4e78-99eb-df304a26ee9e" class="">åŒNodeï¼Œè·¨PODçš„å®¹å™¨é—´è®¿é—®é€šè¿‡è™šæ‹Ÿç½‘æ¡¥æˆ–è·¯ç”±å™¨(çœ‹å…·ä½“CNIæ’ä»¶)</p><p id="2d2bc7dc-73f9-4932-8818-2437aa973f4a" class="">ä¸åŒNodeï¼ŒPodçš„äº’ç›¸è®¿é—®ä¾é Overlayæ–¹å¼(å°±æ˜¯å°†PodæŠ¥æ–‡å°è£…åœ¨ç‰©ç†ç½‘ç»œæŠ¥æ–‡ä¸­)æˆ–è€…Directæ–¹å¼</p></div></p><p id="8914fc19-833e-4f3f-85c9-d3fd07a5191f" class="">CNIå’ŒCNIæ’ä»¶<div class="indented"><p id="2662c362-643d-4e55-a6cb-6a9e5fe95649" class="">CNIæ¥å£è§„èŒƒï¼ŒCNIæ’ä»¶è´Ÿè´£å®Œæˆè¿™äº›å·¥ä½œï¼š<div class="indented"><p id="7258f547-3b3f-40da-939e-05cec5bab135" class="">ä¸ºPODæ·»åŠ æ–°çš„ç½‘ç»œå‘½åç©ºé—´</p><p id="1ec55ff1-4726-409f-8881-bd03d3039703" class="">ä¸ºPodæ·»åŠ è™šæ‹Ÿæ¥å£å¯¹(vethPair)ï¼Œä¸€ä¾§åœ¨Podä¸€ä¾§åœ¨å®¿ä¸»æœº</p><p id="1ee4a746-a347-46b4-8013-f94993b3be54" class="">ä¸ºPodåˆ†é…åœ°å€</p><p id="92e48a10-5b13-4b26-8feb-d6803637895d" class="">ä¸ºPodåˆ†é…é»˜è®¤è·¯ç”±ï¼›åœ¨å®¿ä¸»æœºæ·»åŠ å»å¾€Podçš„è·¯ç”±</p></div></p><figure id="ff0d228b-99c4-4934-83bd-895bb6dfbb44" class="image"><a href="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%204.png"><img style="width:432px" src="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%204.png"/></a></figure></div></p><p id="adc73b95-82a5-4076-b160-c67a89fc37eb" class="">Calico</p></div></p><p id="95994e5e-3ef1-4e75-b294-24f1f8e5bf2e" class="">dockerå’Œdocker-shim<div class="indented"><p id="dc699457-777f-4ede-88ee-8f1f1ae3e961" class="">CRIæ˜¯å®¹å™¨è¿è¡Œæ—¶çš„æ¥å£ï¼Œå¯æ”¯æŒå¤šç§å®¹å™¨è¿è¡Œæ—¶CRIO/ContainerDï¼Œä¸ºäº†å…¼å®¹Dockeræå‡ºäº†ä¸€ä¸ªç»„ä»¶docker-shimä½œä¸ºCRIçš„æ›¿æ¢ï¼Œå®ƒä¸kubeletäº¤äº’ï¼Œä»è€Œç»§ç»­æ”¯æŒdockerå®¹å™¨è¿è¡Œæ—¶ï¼Œä»¥ååªæ”¯æŒCRIO/ContainerDã€‚</p></div></p><p id="ed407d3e-8752-4696-bb42-db3041db18e7" class="">deploymentå’Œservice<div class="indented"><p id="57e0fec8-6461-463c-aff5-41fa19f5a36d" class="">service</p></div></p><pre id="00ad3dda-b0ab-4274-a66e-d70268eb3107" class="code code-wrap"><code>kubectl scale --replicas=4 deploy/deopyå¯¹è±¡</code></pre><p id="b46793c5-d737-4147-ae1d-05936be16c96" class="">liveness </p><p id="a8188ec1-e68c-45c9-828d-74a26151e72e" class="">readiness</p><p id="4d975b9b-73aa-4a87-85ab-f6b2ccf91fd5" class="">
</p></div></p></div></p><p id="8a3b7d4a-f6e5-4678-b715-bf7668ca3a37" class="">æ•´ç†<div class="indented"><p id="fbac0d59-e89b-4d8f-92a5-73538e34fe96" class="block-color-teal_background">Tini<div class="indented"><p id="fd19c150-3a1e-4a22-abdf-19fd26e4a7dd" class="block-color-teal_background"><code>ENTRYPOINT [&quot;tini&quot;, &quot;--&quot;, &quot;/fluentd/entrypoint.sh&quot;] </code> tiniæ˜¯ä»€ä¹ˆï¼Ÿ</p><p id="21375f81-1105-4d8c-89b8-9041e52fecac" class="">gité¦–é¡µï¼š<a href="https://github.com/krallin/tini">https://github.com/krallin/tini</a>  å‚è€ƒä½¿ç”¨<div class="indented"><p id="1a5da6c1-1a2d-4575-877c-48c1399fce7a" class="">æ˜¯krallinå¼€å‘çš„ä¸€ä¸ªç¨‹åºï¼Œç”¨æ¥åšå®¹å™¨PID1ï¼Œè´Ÿè´£æ”¶å‰²åƒµå°¸è¿›ç¨‹å’Œè½¬å‘ä¿¡å·</p><p id="41884cb3-a89f-4944-a87d-1f76a6388614" class="">çŸ¥è¯†å‚è€ƒï¼š<div class="indented"><p id="038ba808-3b5b-404f-837e-551d5378f317" class=""><a href="https://github.com/krallin/tini/issues/8">https://github.com/krallin/tini/issues/8</a></p><p id="1258ffab-70c4-4430-9b93-b61fe4ba7a91" class=""><a href="https://blog.phusion.nl/2015/01/20/docker-and-the-pid-1-zombie-reaping-problem/">https://blog.phusion.nl/2015/01/20/docker-and-the-pid-1-zombie-reaping-problem/</a></p></div></p></div></p></div></p></div></p><p id="d52cb568-252d-46a3-94c2-3701930cd220" class="">å¤ä¹ <div class="indented"><p id="048fd6f4-83cf-4d67-bc0c-00591808b311" class="">Groovy<div class="indented"><p id="1760ed18-74e7-4e05-901c-da8b989d60dd" class="">å¤ä¹ åˆ°äº†é—­åŒ…,æ¥ä¸‹æ¥é—­åŒ…</p></div></p><p id="db7bedaa-faac-4ac5-b6ad-f7a996e4115c" class="">Ansible<div class="indented"><p id="42670c46-68cd-45e3-a7ca-48fce37338df" class="">blockæ”¯æŒå¾ªç¯</p><p id="e9e67c34-1d90-480d-9125-1917c05de809" class="">urlæ¨¡å—çš„ä½¿ç”¨<div class="indented"><pre id="95b3e54c-2b1c-4045-af28-a98ff443fad2" class="code code-wrap"><code>- name: Queue build
  uri:
    url: &quot;http://{{ HostName }}/job/{{ JobName }}/build?token={{ TokenName }}&quot;
    method: POST
    user: &quot;{{ User }}&quot;
    password: &quot;{{ Pass }}&quot;
    force_basic_auth: yes
    status_code: 201</code></pre></div></p><p id="e35b1e68-4ac7-44d4-ae0f-17423dced724" class="">å…¶ä»–æ¨¡æ¿çš„å¤ä¹ <div class="indented"><pre id="32ee2f33-1f7b-43fb-a22c-5600a1b36cf6" class="code code-wrap"><code>YUMå®‰è£…æœ¬åœ°çš„RPMåŒ…
- name: install nginx rpm from a local file
  yum:
    name: /usr/local/src/nginx-release-centos-6-0.el6.ngx.noarch.rpm
    state: present

- hosts: all
  gather_facts: no
  
  tasks:
    - package:
        name: py-dnspython
        state: present
    - lineinfile:
        path: /etc/hosts
        line: &quot;{{ item }} ip-{{ item | replace(&#x27;.&#x27;, &#x27;-&#x27;) }}&quot;
      loop: &quot;{{ lookup(&#x27;dig&#x27;, &#x27;stackoverflow.com.&#x27;).split(&#x27;,&#x27;) }}&quot;</code></pre></div></p><p id="16d54739-89dd-47b0-908d-6f9eac6068c3" class="">built-inå˜é‡<div class="indented"><pre id="4d3c3103-d901-4523-8f8e-de6d820f90f8" class="code code-wrap"><code>ansible_host æ¥è‡ªinventroyæ–‡ä»¶ï¼Œå¦‚å®šä¹‰ansible_ssh_host=192.168.31.103åˆ™å–åœ°å€ï¼›å¦‚æ²¡æœ‰åˆ™å–ä¸»æœºåç§°ï¼›å¦‚ä¸»æœºåç§°æ˜¯åœ°å€åˆ™å–åœ°å€
inventory_hostname  æ¥è‡ªinventoryæ–‡ä»¶ï¼Œå–çš„æ°¸è¿œæ˜¯ä¸»æœºåç§°

groups.all åˆ—è¡¨ç±»å‹ï¼Œå…ƒç´ æ˜¯ä¸»æœºåç§°ï¼Œç”¨å¾ªç¯æ¯”å¦‚with_itemsæˆ–loopæ¥å–
hostvarsæ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œå…ƒç´ æ˜¯ä¸€ä¸ªmappingï¼šé”®æ˜¯ä¸»æœºåç§°ï¼Œå€¼æ˜¯mappingï¼Œå€¼æè¿°ä¸€ä¸ªä¸»æœºçš„æ•°æ®ï¼Œå®ƒçš„ansible_ssh_hostå­—æ®µæ˜¯ä¸»æœºçš„åœ°å€ã€‚
hostvars[&quot;ä¸»æœºåç§°&quot;]å¯è·å¾—ä¸‹é¢çš„
{
  &quot;inventory_hostname&quot;: &quot;web1&quot;,
  &quot;inventory_file&quot;: &quot;/etc/ansible/hosts&quot;,
  &quot;ansible_playbook_python&quot;: &quot;/usr/bin/python2&quot;,
  &quot;inventory_hostname_short&quot;: &quot;web1&quot;,
  &quot;ansible_forks&quot;: 5,
  &quot;playbook_dir&quot;: &quot;/practice&quot;,
  &quot;ansible_inventory_sources&quot;: [
    &quot;/etc/ansible/hosts&quot;
  ],
  &quot;ansible_ssh_pass&quot;: 1,
  &quot;inventory_dir&quot;: &quot;/etc/ansible&quot;,
  &quot;ansible_diff_mode&quot;: false,
  &quot;ansible_ssh_host&quot;: &quot;192.168.31.103&quot;,
  &quot;group_names&quot;: [
    &quot;webs&quot;
  ],
  &quot;ansible_verbosity&quot;: 0,
  &quot;groups&quot;: {
    &quot;ungrouped&quot;: [],
    &quot;webs&quot;: [
      &quot;web1&quot;
    ],
    &quot;all&quot;: [
      &quot;web1&quot;
    ]
  },
  &quot;ansible_check_mode&quot;: false,
  &quot;ansible_run_tags&quot;: [
    &quot;all&quot;
  ],
  &quot;ansible_skip_tags&quot;: [],
  &quot;ansible_facts&quot;: {},
  &quot;ansible_version&quot;: {
    &quot;major&quot;: 2,
    &quot;full&quot;: &quot;2.9.25&quot;,
    &quot;string&quot;: &quot;2.9.25&quot;,
    &quot;minor&quot;: 9,
    &quot;revision&quot;: 25
  },
  &quot;ansible_ssh_user&quot;: &quot;root&quot;
}
</code></pre></div></p><p id="8c63cecc-930c-4758-914a-13bfffeee2e4" class="">é…ç½®æ¨¡æ¿<div class="indented"><pre id="fbd1f837-fa10-4211-b1ac-f1c83535bfdd" class="code code-wrap"><code>1.æ¨¡æ¿æ¨¡å—, æ³¨æ„ï¼šdestå­—æ®µéœ€æŒ‡å®šå…·ä½“æ–‡ä»¶ï¼Œç‰¹åˆ«æ˜¯åç¼€
- templateï¼š
   src: æ¨¡æ¿æ–‡ä»¶è·¯å¾„
   dest: ç›®çš„é…ç½®æ–‡ä»¶
   owner: 
   group:
   mode:
  
2.æ¨¡æ¿æ–‡ä»¶åç¼€.j2
3.æ¨¡æ¿è¯­æ³•
æ¨¡æ¿ä¸­ä½¿ç”¨{{ å˜é‡ }}å¼•ç”¨å˜é‡

forå¾ªç¯
	{% for å¾ªç¯å˜é‡å in range(æ•°å­—,æ•°å­—) %}
	å†…å®¹
	{% endfor %}

æ¡ä»¶
	{% if expression  %}
	å†…å®¹
	{% else  %}
	å†…å®¹
	{% endif  %}

	ä¾‹å­ï¼š
	{% if mysql_port %}   mysql_portæ˜¯playbookå®šä¹‰çš„å˜é‡ï¼Œåˆ¤æ–­å˜é‡æ˜¯å¦å­˜åœ¨
	bind-address = 0.0.0.0:{{ mysql_port }}
	{% else %}
	bind-address = 0.0.0.0:3306
	{% endif  %}


æ ¼å¼åŒ–
	192.168.37.{{ id }} web{{  &quot;%02d&quot; | format(id-200) }}.magedu
	&quot;%02d&quot; è¡¨ç¤º 2è¡¨ç¤ºæ•°å­—å®½åº¦å³æœ€å¤§2ä½æ•°ï¼Œ0è¡¨ç¤ºä¸è¶³2ä½æ•°åˆ™å·¦ä¾§å¡«å……0
	æ ¼å¼æ ·ä¾‹ï¼š192.168.37.201 web01.magedu



{% for node in groups[&quot;webs&quot;] %}
{{ node | join(&quot;&quot;) }}:5672
{% if not loop.last %}
{% endif %}
{% endfor %}</code></pre></div></p></div></p></div></p><p id="3dfb1d38-ed71-4a7f-b34d-8975c36539b6" class="">chrondæ—¶é—´åŒæ­¥è®¾ç½®<div class="indented"><p id="cc63bdf1-ecb9-4105-aec9-8072c3a5cf26" class="">Chrony synchronize the system clockâ€™s time faster and with better accuracy than the ntp.As of RHEL8/CentOS8, ntp is not available anymore, being replaced by the chrony.</p><pre id="ab7b2e22-96a1-4956-9121-f8f08e938bd2" class="code code-wrap"><code>yum install chrony -y
#chronyc 
#chronyd

vim /etc/chrony.conf
server time1.aliyun.com iburst
driftfile /var/lib/chrony/drift
makestep 1.0 3
rtcsync
logdir /var/log/chrony

systemctl enable --now chronyd
æ£€æŸ¥åŒæ­¥æƒ…å†µ chronyc tracking
æ£€æŸ¥æ—¶é—´æº chronyc sources -v
æ£€æŸ¥è¯¦ç»†çš„æ—¶é—´æº chronyc sources -v</code></pre><figure id="e578f64e-3753-4cc2-8ee6-9875c27abc44" class="image"><a href="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%205.png"><img style="width:528px" src="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%205.png"/></a><figcaption>å¯ä»¥ç”¨chronydæœåŠ¡å‘½ä»¤</figcaption></figure></div></p><p id="9ad019fd-4de1-4760-8a2e-8e0f3c553d24" class="">WSL<div class="indented"><p id="e85a01aa-4a30-4ac0-a160-5e7866af2f95" class="">ä¸ºä»€ä¹ˆéœ€è¦ï¼Ÿ<div class="indented"><p id="152797c7-285e-4a1a-a085-c721c063331c" class="">å¯ä»¥ç›´æ¥åœ¨WINDOWSæ“ä½œç³»ç»Ÿä¸Šå®‰è£…Linuxåº”ç”¨å’Œå·¥å…·ï¼Œä¸å¿…å†åƒä»¥å‰ä½¿ç”¨è™šæ‹Ÿæœºäº†<div class="indented"><pre id="02cafb65-a090-4322-a106-908b3a859e7f" class="code code-wrap"><code>wsl.exe -l -o #åˆ—å‡ºå¯æ”¯æŒçš„linux distribution
wsl.exe --install -d &lt;Distribution Name&gt; å®‰è£…
</code></pre></div></p><p id="15cbc52e-97cc-4a43-b48e-7315021b1661" class="">å®‰è£…å‡ºç°ï¼Œè§£å†³å‚è€ƒï¼š<a href="https://github.com/microsoft/WSL/issues/4299">https://github.com/microsoft/WSL/issues/4299</a></p><p id="e00a1464-12c6-4dcb-b68c-0038decde315" class="">WSLæ•™ç¨‹:<a href="https://docs.microsoft.com/zh-cn/windows/wsl/">https://docs.microsoft.com/zh-cn/windows/wsl/</a></p><p id="4f53d006-ec8e-4eef-8424-f0421d3273e9" class="">
</p></div></p></div></p><h1 id="61765493-58ee-440d-b15f-24123826c436" class=""><time>@October 25, 2021</time> </h1><p id="32ee6d35-b764-427e-b12d-26763aaace57" class="block-color-orange">é—®é¢˜</p><ul id="605e9467-dec6-4600-adbe-173f001c7338" class="bulleted-list"><li style="list-style-type:disc"><mark class="highlight-orange">è¿™æœ‰ä»€ä¹ˆç”¨é€”?
agent { label  &quot;build&quot; }
options {
skipDefaultCheckout true
}</mark></li></ul><ul id="69bb4ae4-b184-4c70-a552-24d71387e73b" class="block-color-red bulleted-list"><li style="list-style-type:disc">harbor<mark class="highlight-orange">å¦‚ä½•æ¸…ç†?å¦‚ä½•å¦‚ä½•ä½œæƒé™çš„ç®¡ç†?</mark></li></ul><ul id="ad2bbc56-4a37-49f4-8bb0-78235a67723f" class="block-color-red bulleted-list"><li style="list-style-type:disc"><mark class="highlight-orange">åœ¨éå®¹å™¨åœºæ™¯ä¸‹, å¦‚ä½•å®ç°CD?</mark></li></ul><ul id="711e6009-e630-487d-a890-99d56f1e7fa6" class="bulleted-list"><li style="list-style-type:disc"><mark class="highlight-orange">é•œåƒåç§°è§„èŒƒ? å‚è€ƒï¼š</mark><a href="https://stevelasker.blog/2018/03/01/docker-tagging-best-practices-for-tagging-and-versioning-docker-images/">https://stevelasker.blog/2018/03/01/docker-tagging-best-practices-for-tagging-and-versioning-docker-images/</a><ul id="5b04ec23-d9be-4a0a-87b5-cb857c4d7939" class="bulleted-list"><li style="list-style-type:circle"><mark class="highlight-teal">åœ¨å¼€å‘ç¯å¢ƒï¼Œé‡‡ç”¨commit-idçš„æ¯”è¾ƒå¤š</mark></li></ul></li></ul><ul id="247bffe3-83f3-4894-975b-a2991b462d0a" class="bulleted-list"><li style="list-style-type:disc">prometheus<ul id="629b12e0-f567-4926-9582-de74f05c92b6" class="bulleted-list"><li style="list-style-type:circle">K8Sä¸­Serviceså˜åŠ¨é¢‘ç¹ï¼Œå¦‚ä½•åŠ¨æ€è·å–åˆ°targetï¼Ÿ</li></ul><ul id="ab7f1df2-9730-4214-8f26-cd04474b40ab" class="bulleted-list"><li style="list-style-type:circle">PromQLå¦‚ä½•å­¦ï¼Ÿ</li></ul></li></ul><p id="aca2983b-6f59-41a2-8f90-79d050ce2d5a" class="">
</p><p id="eff148f6-8fe2-4cdc-ab4c-8373a8770bd5" class="">
</p><p id="9d658c97-0374-4ef9-8240-24659ac7f7e2" class="">
</p><p id="c217daf2-dd72-4c90-860c-3ab22fca9805" class="">å­¦ä¹ è®¡åˆ’<div class="indented"><p id="33deb7d4-ac41-4e7e-ba69-de0a2b506de8" class="">python
ç›‘æ§
å¾®æœåŠ¡</p></div></p><p id="e3da24db-bdd4-42b1-9805-b65a9ab36f03" class="">å¤ä¹ <div class="indented"><p id="564e12d6-fb87-4dca-8948-28b7a02ed0ee" class="">ansible</p><p id="1fc51114-81c0-4b47-bba9-c276b280ed2d" class="">ES+elasticSearch</p><p id="688f3d0d-ecab-44a0-8d37-c82c1ebc1787" class="">Jenkinså¤šåˆ†æ”¯+input+æ„å»ºå‚æ•°åŒ–
</p></div></p><p id="342e57ad-d7e5-4cd0-a5ed-f559db4e140a" class="">Prometheus<div class="indented"><p id="8e34ff29-760d-4740-a9d0-bb282acc3865" class="">PromQLå½’çº³<div class="indented"><pre id="3b3f56db-a99d-498e-b7b3-538c7cc685ab" class="code code-wrap"><code>rate(&lt;metricåå­—&gt;[&lt;æ•°å­—&gt;&lt;æ—¶é—´å•ä½å•ä½&gt;])
ä¾‹å­ï¼šrate(http_server_requests_seconds_count[5m])
</code></pre></div></p><p id="bfc94887-3338-437e-85c6-77223f185b7d" class="">å‘Šè­¦-alertmanager<div class="indented"><p id="5abfb5a0-291e-4e92-bc16-80d5c059e8d2" class="">alertmanageræ˜¯ä¸€ä¸ªå•ç‹¬çš„æœåŠ¡ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œç”¨äºå‘é€å‘Šè­¦ç»™æ¥æ”¶è€…</p><p id="ec2c62b5-be36-45a5-b7c9-49970eac82eb" class="">éœ€å…³å¿ƒçš„ï¼š</p><ul id="a6a13aec-90dc-4193-9bd1-1809b4148832" class="bulleted-list"><li style="list-style-type:disc">æœåŠ¡è¿˜åœ¨è¿è¡Œä¹ˆï¼Ÿ</li></ul><ul id="bfd545d5-426c-4d37-a29b-ec5a42479eab" class="bulleted-list"><li style="list-style-type:disc">è¯·æ±‚ç‡æ˜¯å¦è¾¾åˆ°æœ€é«˜ï¼Ÿ</li></ul><ul id="9bba3fb9-4fe3-4c72-bb33-0b1688199d7f" class="bulleted-list"><li style="list-style-type:disc">CPUå’Œå†…å­˜ä½¿ç”¨ç‡â‰¥95?</li></ul><p id="47b8302c-966b-4c26-982b-761ecd8b6de0" class="">ä¸¤ä¸ªéœ€å¼„æ¸…æ¥šçš„æ¦‚å¿µï¼š<div class="indented"><ul id="14e0bc31-4bb7-4bbe-8119-cd1069d6ed84" class="bulleted-list"><li style="list-style-type:disc">receiverï¼šå®šä¹‰å‘Šè­¦çš„æ¥æ”¶è€…ï¼Œæ¯”å¦‚é‚®ç®±æ¥æ”¶è€…ï¼Œæˆ–è€…é’‰é’‰æ¥æ”¶è€…</li></ul><ul id="34594ab3-292c-4e99-845d-79f217cc522b" class="bulleted-list"><li style="list-style-type:disc"> routeï¼šå‘Šè¯‰alertmanagerå‘å“ªä¸ªæ¥æ”¶è€…å‘é€å‘Šè­¦</li></ul></div></p><p id="2067ec99-e4f4-444a-9032-5cc50386d922" class="">prometheusé…ç½®æ–‡ä»¶èƒ½åšå“ªäº›äº‹æƒ…<div class="indented"><ul id="4f18bcc4-8b30-4a1c-8933-0f15acdd14bb" class="bulleted-list"><li style="list-style-type:disc">å‘Šè¯‰prometheus éœ€è¦é‡‡é›†çš„endpointæ˜¯ä»€ä¹ˆ<pre id="a2122a00-4ee9-4200-ae52-fa864f2547d5" class="code code-wrap"><code>- job_name: node
    metrics_path: /metrics
    static_configs:
      - targets:
        - &quot;192.168.31.101:9100&quot;
        - &quot;192.168.31.251:9100&quot;
        - &quot;127.0.0.1:9090&quot;   #Prometheusè‡ªå·±çš„endpoint</code></pre></li></ul><ul id="70dd2e09-3c49-4fc9-ba7e-c9e66520ab56" class="bulleted-list"><li style="list-style-type:disc">å¦‚ä½•label</li></ul><ul id="2d9c7afd-cd1d-4b09-989c-a0fdeae98e8b" class="bulleted-list"><li style="list-style-type:disc">å‘Šè­¦è§„åˆ™æ˜¯ä»€ä¹ˆ</li></ul><ul id="1ab83025-0723-408e-86a4-e417fd52bbe8" class="bulleted-list"><li style="list-style-type:disc">å½“è§„åˆ™firingæ—¶ï¼Œå¦‚ä½•é€šè¿‡alertmanagerå‘é€ç»™æ¥æ”¶è€…</li></ul></div></p><p id="1cbb89d9-8b5e-43ae-b92d-00d53c9b5406" class="">éƒ¨ç½²alertmanagerå’Œé…ç½®å‘Šè­¦<div class="indented"><ol type="1" id="2791a04e-f7a2-4d23-8480-f3469eb1bfa2" class="numbered-list" start="1"><li>è®¾ç½®alertmanager.ymlé…ç½®æ–‡ä»¶å¹¶å¯åŠ¨alertmanager</li></ol><ol type="1" id="a6e5dece-3f93-4613-884c-46dda3909e05" class="numbered-list" start="2"><li>è®¾ç½®rules</li></ol></div></p><p id="f95dd0d1-cc76-4101-b098-f1d060c4cccd" class="">
</p><p id="d336119e-bfc6-4155-afb5-5d3c0617b698" class="">PromSQLå…¥é—¨</p><ul id="e8d6c468-f832-446d-b465-9d55e748b615" class="bulleted-list"><li style="list-style-type:disc">é€‰æ‹©serie<ul id="36448c22-c81f-4de2-8bd5-24a73766ee14" class="bulleted-list"><li style="list-style-type:circle">ç”¨metricåå­—ï¼Œè¿”å›ç›¸åŒmetricåå­—çš„æ‰€æœ‰serie<figure id="15766709-38c7-4c17-9e08-c91339735cec" class="image"><a href="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%206.png"><img style="width:336px" src="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%206.png"/></a></figure></li></ul><ul id="10faea0b-91e2-4f84-934e-da6e51b01631" class="bulleted-list"><li style="list-style-type:circle">ç”¨metricåå­—+æ ‡ç­¾</li></ul><ul id="cc656a88-de22-4f99-b070-3c9dcdf8171b" class="bulleted-list"><li style="list-style-type:circle">ä½¿ç”¨æ—¶é—´èŒƒå›´<figure id="afa58dcf-7357-4046-a2dc-5446601bba89" class="image"><a href="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%207.png"><img style="width:336px" src="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%207.png"/></a></figure></li></ul><ul id="293dd29a-0c96-41d3-9857-f773bd0350c5" class="bulleted-list"><li style="list-style-type:circle">ä½¿ç”¨æ­£åˆ™ï¼Œå¯¹æŸä¸ªæ ‡ç­¾è¿›è¡ŒåŒ¹é…ï¼Œä»è€Œç­›é€‰å‡ºæœŸæœ›çš„serie<figure id="ea82b005-cfed-4fba-b926-c01f0405f358" class="image"><a href="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%208.png"><img style="width:528px" src="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%208.png"/></a></figure></li></ul></li></ul><ul id="f53f2963-7a24-4c64-8f89-d0d66a369a23" class="bulleted-list"><li style="list-style-type:disc"></li></ul><p id="6a81e809-b575-4731-a26a-b3ba0949dc9e" class="">é€šè¿‡PromSQLï¼ŒæŒ‰ç…§USEæ–¹æ³•ç›‘æ§ç¡¬ä»¶æœåŠ¡å™¨çš„CPU/Mem/IO/Network</p><ul id="b354779f-2ce3-4231-9a7a-4dfe39f04c30" class="bulleted-list"><li style="list-style-type:disc">CPU:<p id="abf7cb53-810d-47c2-9e99-b95b4f0fe3ec" class=""><code>sum(rate(node_cpu_seconds_total{mode!=&quot;idle&quot;,mode!=&quot;iowait&quot;,mode!~&quot;^(?:guest.*)$&quot;}[5m])) BY (instance)</code></p><p id="67769301-c969-43ef-8159-5c89018d16f2" class="">
</p></li></ul><p id="55e24817-a516-4bf4-a493-e8cf90bb0706" class="">
</p></div></p><p id="b7e61808-3f79-475b-a4d5-585c52afff98" class="">
</p><p id="3235fd3a-252f-488f-a92d-6f085045c2bf" class="">
</p></div></p><h1 id="2cc03372-05d9-4444-9014-b557ffdd6b70" class=""><time>@October 26, 2021</time> </h1><p id="7c1d23d2-b83c-4d04-8a32-43264fdb1d06" class="">ç›‘æ§<div class="indented"><p id="3c226f92-17d1-4b9b-9eab-a6a5493ce599" class="">å¦‚ä½•ç›‘æ§K8Sçš„èŠ‚ç‚¹<div class="indented"><p id="9e08da11-4880-4507-8bd9-c544e37b430d" class="">ç›‘æ§CPU/å†…å­˜/IO/ç½‘ç»œ<div class="indented"><ul id="63ea3e66-1b44-4b61-863b-72fffce3f156" class="bulleted-list"><li style="list-style-type:disc">Utility</li></ul><ul id="649b1221-9fea-4403-854b-3f3fddaf16a2" class="bulleted-list"><li style="list-style-type:disc">Saturate</li></ul><ul id="032162d0-f778-4534-b6fb-83d71399f51c" class="bulleted-list"><li style="list-style-type:disc">Error</li></ul><p id="6ef0f860-eff7-4ab1-9c8b-1f053f7a6faa" class="">
</p></div></p><ol type="1" id="c3e9680d-5454-4fa8-ada0-c59103b4cb59" class="numbered-list" start="1"><li>ä»èŠ‚ç‚¹å–åˆ°æŒ‡æ ‡<blockquote id="8955f05b-7ac3-4fbb-8d50-4a766b4985e4" class=""><p id="3b003075-c994-4ede-b3dd-9a65fb73096c" class="">è¦å¯ç”¨ API æŒæœ‰è€…ä»¤ç‰Œï¼ˆåŒ…æ‹¬æœåŠ¡å¸æˆ·ä»¤ç‰Œï¼‰ä»¥å¯¹ kubelet çš„ HTTPS ç«¯ç‚¹è¿›è¡Œèº«ä»½éªŒè¯ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p><ul id="a7d734d4-f078-4322-96fb-7cc374205210" class="bulleted-list"><li style="list-style-type:disc">ç¡®ä¿åœ¨ API æœåŠ¡å™¨ä¸­å¯ç”¨äº†Â <code>authentication.k8s.io/v1beta1</code>Â API ç»„</li></ul><ul id="28a39014-212a-4f64-8f34-4c4e45d68a66" class="bulleted-list"><li style="list-style-type:disc">å¸¦Â <code>-authentication-token-webhook</code>Â å’ŒÂ <code>-kubeconfig</code>Â æ ‡å¿—å¯åŠ¨ kubelet</li></ul><ul id="1e271c39-7a48-44e2-9588-1ca36a4ac048" class="bulleted-list"><li style="list-style-type:disc">kubelet è°ƒç”¨å·²é…ç½®çš„ API æœåŠ¡å™¨ä¸Šçš„Â <code>TokenReview</code>Â APIï¼Œä»¥æ ¹æ®æŒæœ‰è€…ä»¤ç‰Œç¡®å®šç”¨æˆ·ä¿¡æ¯</li></ul></blockquote><p id="d6397194-02eb-4494-9ed2-f3f8dd5c6364" class=""><a href="https://kubernetes.io/zh/docs/reference/command-line-tools-reference/kubelet-authentication-authorization/#kubelet-%E9%89%B4%E6%9D%83"><strong></strong></a></p></li></ol></div></p><p id="9f057d03-9964-457c-be58-d20b1087f30b" class="">å¦‚ä½•ç›‘æ§å®¹å™¨<div class="indented"><p id="a242b7ac-51ab-4978-be37-40a52168f038" class="">ç›‘æ§CPU/å†…å­˜/IO/ç½‘ç»œ<div class="indented"><ul id="bc89e5cc-d094-4e69-b3f2-b0f8d478d59c" class="bulleted-list"><li style="list-style-type:disc">Utility</li></ul><ul id="6b67e70b-a938-4103-962d-8677367cac36" class="bulleted-list"><li style="list-style-type:disc">Saturate</li></ul><ul id="260936cb-87b1-4579-8644-4be9a94504ad" class="bulleted-list"><li style="list-style-type:disc">Error</li></ul></div></p></div></p><h1 id="eeb34c41-04bd-4d6a-9114-94dac4c1abf0" class=""><time>@October 27, 2021</time> </h1></div></p><p id="227de23c-8878-4e76-bfd4-e72a0722c933" class="">
</p><h1 id="929811b4-ac33-4ce0-ba07-b6c1808546ae" class=""><time>@October 28, 2021</time> </h1><p id="df0c3488-5b41-431e-a679-3e2fbf3229e3" class="">
</p><h1 id="0f567f9b-780a-4125-b2bc-282e69265838" class=""><time>@October 31, 2021</time> </h1><p id="399959b5-a907-40e1-b1b4-d425c9ea18a0" class="">
</p><h1 id="f8f94ff9-12fc-4e48-a91f-6ef93234058e" class=""><time>@November 1, 2021</time> </h1><p id="9ea54baa-58c5-47c0-b61d-6bce5a419eea" class="block-color-orange">ç–‘é—®<div class="indented"><p id="ed748c35-049b-4080-9ea3-67a5bbc8b2b7" class="">Grafana<div class="indented"><p id="3bac989c-12ff-4556-85a9-65e2227cf097" class="">å¦‚ä½•å¯¼å…¥dashboardæ–‡ä»¶ï¼Ÿ</p></div></p><p id="86ee561f-10eb-4ce4-8cc3-5b0c8a63e85d" class="">ES<div class="indented"><p id="d8199409-ceac-4241-b52e-46818adc7ca0" class="">ä¼ ä¸Šæ¥çš„æ—¥å¿—æ²¡æœ‰æ—¶é—´ï¼Œä¸ºä»€ä¹ˆï¼Ÿæ€ä¹ˆè§£å†³ï¼Ÿ</p></div></p><p id="c03276c0-23e1-4c27-9023-6c96014a7b12" class="">fluentD<div class="indented"><p id="89bac89b-8b5f-44b7-a35b-7ec240e030b0" class="">å¦‚ä½•ä¼˜åŒ–ç´¢å¼•ï¼š<a href="https://code.cash.app/tuning-elasticsearch-index-settings-for-logs">https://code.cash.app/tuning-elasticsearch-index-settings-for-logs</a></p><p id="2be7a32d-2b02-4b4c-9a53-b1e97668f6a3" class="">&lt;label @FLUENT_LOG&gt; æ˜¯ä»€ä¹ˆï¼Ÿ å‚è€ƒ<a href="https://github.com/fluent/fluentd-kubernetes-daemonset/blob/master/docker-image/v1.11/debian-elasticsearch7/conf/kubernetes.conf">https://github.com/fluent/fluentd-kubernetes-daemonset/blob/master/docker-image/v1.11/debian-elasticsearch7/conf/kubernetes.conf</a></p><p id="781f2bcb-3ad4-40ef-8708-2bdb0d9651e7" class="">fluentDçš„elasticsearchæ’ä»¶ï¼Œå¦‚ä½•ä¸ºindexåç§°æ·»åŠ æ—¥æœŸåç¼€</p><p id="39de01bb-c318-4f52-a1d2-f83a5e23ef87" class="">åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹ï¼Œéœ€è¦æ­é…kafka</p><p id="0504796b-ef21-43d7-bc1e-edf8ef05d56d" class="">å¦‚ä½•ä½¿ç”¨parseå—</p><p id="ca7bb619-3480-4f9d-b4c9-c175b772ad0c" class="">ES6ä¸ES7æœ‰å¤§çš„åŒºåˆ«ä¹ˆï¼Ÿ<div class="indented"><p id="cd698949-9556-4fbc-be38-6aa60bbc029b" class=""><mark class="highlight-teal">æ¯”å¦‚typeï¼ŒES7ä¸å†æ”¯æŒå®šä¹‰typeï¼Œä¸€ä¸ªç´¢å¼•åªæœ‰ä¸€ä¸ªtypeå°±æ˜¯_doc</mark></p></div></p><p id="5dd65a8e-2e35-4f0f-8a72-e37442698e45" class="">å¦‚ä½•å†™parseræ’ä»¶ï¼Ÿ<a href="https://docs.fluentd.org/plugin-development/api-plugin-parser">https://docs.fluentd.org/plugin-development/api-plugin-parser</a> ç›®å‰è¿˜ä¸éœ€è¦çŸ¥é“</p><ul id="4da388d7-c74e-42a1-9ede-960fa1e146ea" class="toggle"><li><details open=""><summary>å¯¹äºå®˜æ–¹fluentDçš„é…ç½®ï¼Œè¿™äº›æ˜¯ä¸æ¸…æ¥šçš„</summary><pre id="628ec7bf-3820-4ce4-806a-a2c71369e1ec" class="code code-wrap"><code>&lt;filter kubernetes.**&gt;
watch &quot;#{ENV[&#x27;FLUENT_KUBERNETES_WATCH&#x27;] || &#x27;true&#x27;}&quot;
&lt;/filter&gt;

@id out_es
   @log_level info
   include_tag_key true
   path &quot;#{ENV[&#x27;FLUENT_ELASTICSEARCH_PATH&#x27;]}&quot;
   scheme &quot;#{ENV[&#x27;FLUENT_ELASTICSEARCH_SCHEME&#x27;] || &#x27;http&#x27;}&quot;
   ssl_verify &quot;#{ENV[&#x27;FLUENT_ELASTICSEARCH_SSL_VERIFY&#x27;] || &#x27;true&#x27;}&quot;
   ssl_version &quot;#{ENV[&#x27;FLUENT_ELASTICSEARCH_SSL_VERSION&#x27;] || &#x27;TLSv1_2&#x27;}&quot;
   user &quot;#{ENV[&#x27;FLUENT_ELASTICSEARCH_USER&#x27;] || use_default}&quot;
   password &quot;#{ENV[&#x27;FLUENT_ELASTICSEARCH_PASSWORD&#x27;] || use_default}&quot;
   reload_connections &quot;#{ENV[&#x27;FLUENT_ELASTICSEARCH_RELOAD_CONNECTIONS&#x27;] || &#x27;false&#x27;}&quot;
   reconnect_on_error &quot;#{ENV[&#x27;FLUENT_ELASTICSEARCH_RECONNECT_ON_ERROR&#x27;] || &#x27;true&#x27;}&quot;
   reload_on_failure &quot;#{ENV[&#x27;FLUENT_ELASTICSEARCH_RELOAD_ON_FAILURE&#x27;] || &#x27;true&#x27;}&quot;
   log_es_400_reason &quot;#{ENV[&#x27;FLUENT_ELASTICSEARCH_LOG_ES_400_REASON&#x27;] || &#x27;false&#x27;}&quot;
   target_index_key &quot;#{ENV[&#x27;FLUENT_ELASTICSEARCH_TARGET_INDEX_KEY&#x27;] || use_nil}&quot;
   type_name &quot;#{ENV[&#x27;FLUENT_ELASTICSEARCH_LOGSTASH_TYPE_NAME&#x27;] || &#x27;fluentd&#x27;}&quot;
   template_name &quot;#{ENV[&#x27;FLUENT_ELASTICSEARCH_TEMPLATE_NAME&#x27;] || use_nil}&quot;
   template_file &quot;#{ENV[&#x27;FLUENT_ELASTICSEARCH_TEMPLATE_FILE&#x27;] || use_nil}&quot;
   template_overwrite &quot;#{ENV[&#x27;FLUENT_ELASTICSEARCH_TEMPLATE_OVERWRITE&#x27;] || use_default}&quot;
   sniffer_class_name &quot;#{ENV[&#x27;FLUENT_SNIFFER_CLASS_NAME&#x27;] || &#x27;Fluent::Plugin::ElasticsearchSimpleSniffer&#x27;}&quot;
   request_timeout &quot;#{ENV[&#x27;FLUENT_ELASTICSEARCH_REQUEST_TIMEOUT&#x27;] || &#x27;5s&#x27;}&quot;
   suppress_type_name &quot;#{ENV[&#x27;FLUENT_ELASTICSEARCH_SUPPRESS_TYPE_NAME&#x27;] || &#x27;true&#x27;}&quot;
   enable_ilm &quot;#{ENV[&#x27;FLUENT_ELASTICSEARCH_ENABLE_ILM&#x27;] || &#x27;false&#x27;}&quot;
   ilm_policy_id &quot;#{ENV[&#x27;FLUENT_ELASTICSEARCH_ILM_POLICY_ID&#x27;] || use_default}&quot;
   ilm_policy &quot;#{ENV[&#x27;FLUENT_ELASTICSEARCH_ILM_POLICY&#x27;] || use_default}&quot;
   ilm_policy_overwrite &quot;#{ENV[&#x27;FLUENT_ELASTICSEARCH_ILM_POLICY_OVERWRITE&#x27;] || &#x27;false&#x27;}&quot;
   &lt;buffer&gt;
     flush_thread_count &quot;#{ENV[&#x27;FLUENT_ELASTICSEARCH_BUFFER_FLUSH_THREAD_COUNT&#x27;] || &#x27;8&#x27;}&quot;
     flush_interval &quot;#{ENV[&#x27;FLUENT_ELASTICSEARCH_BUFFER_FLUSH_INTERVAL&#x27;] || &#x27;5s&#x27;}&quot;
     chunk_limit_size &quot;#{ENV[&#x27;FLUENT_ELASTICSEARCH_BUFFER_CHUNK_LIMIT_SIZE&#x27;] || &#x27;2M&#x27;}&quot;
     queue_limit_length &quot;#{ENV[&#x27;FLUENT_ELASTICSEARCH_BUFFER_QUEUE_LIMIT_LENGTH&#x27;] || &#x27;32&#x27;}&quot;
     retry_max_interval &quot;#{ENV[&#x27;FLUENT_ELASTICSEARCH_BUFFER_RETRY_MAX_INTERVAL&#x27;] || &#x27;30&#x27;}&quot;
     retry_forever true
   &lt;/buffer&gt;</code></pre></details></li></ul></div></p><p id="db6f6b61-ded3-43a2-a079-17ae3811161d" class="">dockerbuild<div class="indented"><p id="79b254aa-80d8-419c-878f-0f9992f13979" class="">v1.14.1-debian-elasticsearch6-1.0 è¿™ä¸ªtagï¼Œæ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ</p><p id="3fbc2250-392b-4b68-933f-eb7d7ddf324e" class="">å¯¹äºaptï¼Œå¦‚ä½•ä½¿ç”¨å›½å†…é•œåƒ</p><p id="51f8b92c-2117-4ef3-b3e6-1790053606e5" class="">å¯¹äºrubyï¼Œå¦‚ä½•ä½¿ç”¨å›½å†…é•œåƒ</p><p id="fe88fc1f-36bf-4914-9447-3a13c28e41b0" class="">å¦‚ä½•åœ¨fluentdåŸºç¡€é•œåƒåŸºç¡€ä¸Šï¼ŒåŠ å…¥éœ€è¦çš„æ’ä»¶ï¼Œæ„å»ºä¸€ä¸ªæ–°fluentdé•œåƒï¼Ÿ<div class="indented"><p id="9f5e51a5-d2cf-469b-a971-478fbd4b1ea5" class="">â†’å¯¹æ’ä»¶è¦äº†è§£ï¼Œç›®å‰è¿˜ä¸æ¸…æ¥šï¼Œæ€»ç»“ä¸€ä¸‹æœ‰å“ªäº›<div class="indented"><ul id="f3319d4d-e169-4801-b3a7-e91e24f666f4" class="bulleted-list"><li style="list-style-type:disc">è‡ªå¸¦çš„æ’ä»¶ï¼šinputã€outputã€éƒ¨åˆ†parseræ’ä»¶(ä¸çŸ¥é“æ˜¯å¦æ€»ç»“å…¨)</li></ul><ul id="b4ade824-def3-45e4-92c8-2e943baef923" class="bulleted-list"><li style="list-style-type:disc">kubernetes</li></ul></div></p><p id="7e06c1c6-a8ba-40f3-bf10-09c4a862d35a" class="block-color-teal">â†’å®˜æ–¹gitä¸“é—¨æä¾›äº†K8Sçš„fluentd-kubernetes-daemonsetï¼Œæä¾›äº†è‹¥å¹²åœºæ™¯çš„Dockerfileå’Œç›¸å…³æ–‡ä»¶ï¼Œå¯ä¾æ®è‡ªå·±åœºæ™¯é€‰æ‹©ç„¶åè‡ªè¡Œdocker build<div class="indented"><p id="63916c78-b8bf-4c58-8cd6-9eab3bf8642d" class=""><a href="https://github.com/fluent/fluentd-kubernetes-daemonset/tree/master/docker-image/v1.11">https://github.com/fluent/fluentd-kubernetes-daemonset/tree/master/docker-image/v1.11</a> è¿™æ˜¯å®˜æ–¹gitï¼Œdocker-image/ä¸‹ï¼Œå¯é€‰æ‹©ES6æˆ–ES7çš„åœºæ™¯ï¼Œç›®å‰è¿˜ä¸æ¸…æ¥šä¸¤è€…å·®åˆ«ï¼Œå› ä¸ºå¯¹ES6å’Œ7ä¸äº†è§£ï¼›åœ¨æ ¹ç›®å½•æ”¾ç€å¯¹åº”åœºæ™¯çš„K8Sèµ„æºæ¸…å•</p></div></p></div></p></div></p><p id="b6c621be-ec1d-474b-b656-6ce6a4bbb718" class="">K8S<div class="indented"><p id="e3debe63-d77d-4beb-93e3-68a88886a82f" class="">ä¸ºä»€ä¹ˆkubeletçš„æœåŠ¡ç«¯è¯ä¹¦(kubelet.crt)ç­¾å‘è€…ä¸æ˜¯é›†ç¾¤CA, è€Œæ˜¯<code>Issuer: CN=master01-ca@1631707730</code></p></div></p><p id="7d9164ff-a8ff-4261-87c7-0807cb953797" class="block-color-teal_background">ç›‘æ§<div class="indented"><p id="9f0e74ab-1abe-4e56-81d5-ce1a488f9588" class="">USEå’ŒREDæ¦‚å¿µ<div class="indented"><p id="df5ea7f3-e525-4829-83d5-9c4d211c1107" class="">USE, å¯¹äºæœåŠ¡å™¨å’Œå®¹å™¨ï¼Œè¡¡é‡ç¡¬ä»¶èµ„æºï¼šCPUï¼Œå†…å­˜ï¼Œç½‘ç»œ<div class="indented"><ul id="0cc4e106-377b-4a7c-848e-f47827f2f86f" class="bulleted-list"><li style="list-style-type:disc">Utilization the average time that the resource was busy servicing work</li></ul><ul id="1e4743e7-3e05-423f-8952-170383ff11a3" class="bulleted-list"><li style="list-style-type:disc">Saturation: the degree to which the resource has extra work which it can&#x27;t service often queued<figure id="deba7c4a-68bb-4ac3-8693-973e81cc6db5" class="image"><a href="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%209.png"><img style="width:384px" src="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%209.png"/></a><figcaption>ä½ çš„åˆ©ç”¨ç‡ä»ªå™¨å·²ç»çˆ†è¡¨ï¼Œè¶…è¿‡äº†æœ€å¤§åˆ©ç”¨ç‡ï¼Œè¿™è¶…è¿‡çš„éƒ¨åˆ†å¦‚ä½•åº¦é‡å‘¢ï¼Ÿç”¨Saturationé¥±å’Œåº¦ï¼Œä¸ä½¿ç”¨SWAPçš„ä¸»æœºä¸éœ€è¦æµ‹é‡é¥±å’Œåº¦ï¼Œæ¯”å¦‚K8SèŠ‚ç‚¹</figcaption></figure></li></ul><ul id="7e23d3de-1555-40b5-9869-eba3fb71a0fa" class="bulleted-list"><li style="list-style-type:disc">Errors: the count of error events</li></ul></div></p><p id="800b1e5c-bd10-4727-9454-49985897cef3" class="">RED, å¯¹äºæœåŠ¡<div class="indented"><ul id="05addc77-757e-4dec-b9dc-29ad56a95e8f" class="bulleted-list"><li style="list-style-type:disc">Rate:  the number of requests per second</li></ul><ul id="7d7f9256-20a9-4cf4-b174-a59ad5f9bfae" class="bulleted-list"><li style="list-style-type:disc">Errors: the number of errors per second</li></ul><ul id="6f9f3d6e-8a15-43d5-98fe-a1d741967ad3" class="bulleted-list"><li style="list-style-type:disc">Duration: the length of time required to service the request</li></ul></div></p></div></p><p id="35717843-5549-49bf-b38d-9182a3018a90" class="">KubernetesåŒæ—¶éœ€è¦ä½¿ç”¨ä¸Šé¢ä¸¤ä¸ªï¼š<div class="indented"><p id="1295a129-cd74-4632-9e4e-3ddaf217ad99" class="">NodeæŒ‡æ ‡æ¥è‡ª<strong>node_exporter</strong><div class="indented"><figure id="029ff5d1-5d75-49ac-81e3-873c4cf5bf29" class="image"><a href="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2010.png"><img style="width:432px" src="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2010.png"/></a></figure><ul id="53c3e4b9-950d-4a48-8d67-dc05fac3edb0" class="bulleted-list"><li style="list-style-type:disc">USE for Node CPU<p id="62ef8b95-4b83-40df-af4d-30390b3b3b65" class="">node-exporter v1.2.2 CPU modeå…±8ä¸ª: user, system, nice, idle, iowait, steal, soft_irq and irq. æ²¡æœ‰guest, guest_nice</p><pre id="049435d7-98e1-4d90-aaa2-b70099d36d5a" class="code code-wrap"><code>#Utilization
sum(rate(node_cpu_seconds_total{mode!=&quot;idle&quot;,mode!=&quot;iowait&quot;}[5m])) BY(instance)

#Saturation
sum(node_load1) BY(instance)/count(node_cpu_seconds_total{mode=&quot;system&quot;}) BY(instance)

#errors
#å…³äºCPUé”™è¯¯ï¼Œnode-exporteræ˜¯ä¸é‡‡é›†çš„</code></pre></li></ul><ul id="be3efabc-ee43-4f04-8fc1-630c3f03a74c" class="bulleted-list"><li style="list-style-type:disc">USE for Node Memory<figure id="13ffabc3-856d-4117-9e1d-740392f7d1a5" class="image"><a href="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2011.png"><img style="width:720px" src="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2011.png"/></a></figure><p id="8043947f-85b6-4a09-b5ea-7389389186bd" class="">å†…å­˜ä¸CPUä¸åŒï¼Œå®ƒä¸èƒ½å°†ç›®å‰å¤„ç†ä¸äº†çš„å·¥ä½œæ’è¿›é˜Ÿåˆ— â˜ ï¸</p><pre id="9873b543-99fd-4789-a106-edc30fe337cf" class="code code-wrap"><code>#Utilization
1 - sum(node_memory_MemAvailable_bytes) by (instance) / sum(node_memory_MemTotal_bytes) by (instance)

#Saturationï¼ŒKubernetes Nodeç¦æ­¢ä½¿ç”¨SWAPï¼Œæ‰€ä»¥ä¸ç”¨é‡‡é›†
#å½“Linuxç³»ç»Ÿå†…å­˜ä½¿ç”¨è¶…è¿‡ä¸€å®šé˜ˆå€¼æ—¶,ä¼šå°†æœ€è¿‘ä¸ç”¨çš„pageç§»åˆ°SWAPåˆ†åŒºï¼Œä»¥ç©ºå‡ºå†…å­˜ã€‚
</code></pre></li></ul><ul id="ec93ac2a-2239-457e-8ca5-bec6bc119361" class="bulleted-list"><li style="list-style-type:disc">USE for Disk<p id="3917b409-ea5a-4d14-854b-2fd3169e5a7d" class="">ğŸ’¡Disk capacity is the amount of data that a disk can store (i.e. how full/empty is my disk) 
ğŸ’¡disk throughput is how much can I read/write to the disk per second.</p><pre id="08ec077d-05da-4129-bf1d-f403e7858131" class="code code-wrap"><code>
#ä½¿ç”¨ç©ºé—´
#Utilization
1 - node_filesystem_free_bytes{fstype=&quot;xfs&quot;,mountpoint=~&quot;.*&quot;} / node_filesystem_size_bytes{fstype=&quot;xfs&quot;,mountpoint=~&quot;.*&quot;}
#Saturation
node_filesystem_free_bytes{fstype=&quot;xfs&quot;,mountpoint=~&quot;.*&quot;} / node_filesystem_size_bytes{fstype=&quot;xfs&quot;,mountpoint=~&quot;.*&quot;}

#ååé‡è®¡ç®—
(ç©º)</code></pre></li></ul><ul id="a481d8c1-c745-4edb-98f4-1d083ad1b063" class="bulleted-list"><li style="list-style-type:disc">USE for Network<p id="7efe807f-f5a7-4171-9561-03abc970e744" class="">ğŸ˜•<mark class="highlight-orange">Utilizationåªèƒ½çœ‹å‡ºæ¯ç§’çš„æ”¶å‘é‡ï¼Œå¦‚æœçœ‹åˆ°ä¸æ€»é‡çš„æ¯”å€¼æ˜¯å¦æ›´å¥½ï¼Ÿå¦‚æœæ˜¯è¯¥æ€ä¹ˆåšï¼Ÿ</mark></p><pre id="db0e1f1f-3053-4dee-be11-e277224627a5" class="code code-wrap"><code>#Utilization
rate(node_network_receive_bytes_total{device=~&quot;(ens|eth).*&quot;}[5m]) + rate(node_network_transmit_bytes_total{device=~&quot;(ens|eth).*&quot;}[5m])
#Saturation
rate(node_network_receive_drop_total{device=~&quot;(eth|ens).*&quot;}[5m]) + rate(node_network_transmit_drop_total{device=~&quot;(eth|ens).*&quot;}[5m])</code></pre></li></ul></div></p></div></p><p id="e7867760-773e-4c1a-86a7-3a51d8b1c8e0" class="">ContaineræŒ‡æ ‡<div class="indented"><ul id="2a20f808-c6cd-403e-94d2-f3a471ccbf60" class="bulleted-list"><li style="list-style-type:disc">kubelet, ä»¥Prometheusæ ¼å¼ï¼Œå°†æ‰€æœ‰<strong>å®¹å™¨è¿è¡Œæ—¶æŒ‡æ ‡å’ŒcAdvisoræŒ‡æ ‡</strong>æš´éœ²åˆ°<code>/metrics</code> </li></ul><ul id="5e62fbed-a8ea-437c-8f02-8a6f943c822a" class="bulleted-list"><li style="list-style-type:disc">cAdvisoræŒ‡æ ‡å…¶å®æ˜¯æ¥è‡ªäºLinuxåº•å±‚CgroupæŠ¥å‘Šçš„æŒ‡æ ‡</li></ul><ul id="575650e0-3f1e-4b59-8a62-6c3810a4f049" class="bulleted-list"><li style="list-style-type:disc">requstï¼šè¿è¡Œç¨‹åºæ‰€éœ€è¦çš„èµ„æºï¼Œå¦‚ä¸è®¾ç½®åˆ™é»˜è®¤ç­‰äºlimit<p id="7115c615-7a85-4201-8bac-bf9adcf1f19c" class="">limit: å®¹å™¨å¯ä»¥ ä½¿ç”¨çš„æœ€å¤§èµ„æºï¼Œè¶…è¿‡CPU limitåˆ™è¢«&quot;å¡ä½&quot;ï¼Œè¶…è¿‡Mem limitåˆ™å®¹å™¨è¢«&quot;å¹²æ‰&quot;</p></li></ul><figure id="ab692f99-e154-40ce-996b-5b9fccc7f2f5" class="image"><a href="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2012.png"><img style="width:480px" src="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2012.png"/></a></figure><ul id="d010de2a-48ed-4d46-ae7c-aa32d48e0d02" class="bulleted-list"><li style="list-style-type:disc">USE for Container CPU<pre id="7a27b3fc-0d92-4cd4-941c-af88c7eed946" class="code code-wrap"><code>#utilization
rate(container_cpu_usage_seconds_total[5m])

#saturation å½“å®¹å™¨è®¾ç½®limitä¸”è¶…è¿‡æ—¶ï¼Œè¿™ä¸ªå®¹å™¨ä¼šè¢«throttledï¼Œkube-metric-statuså°†throttleæƒ…å†µå†™åˆ°container_cpu_cfs_throttled_seconds_totalæŒ‡æ ‡
rate(container_cpu_cfs_throttled_periods_total[5m])

#Errorsï¼Œä¸æä¾›CPUé”™è¯¯</code></pre><figure id="ce95cc9c-9a2b-4c6a-aaff-28095c3a1f7f" class="image"><a href="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2013.png"><img style="width:528px" src="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2013.png"/></a></figure></li></ul><ul id="c7fa1047-f32e-474c-93b8-f7fb36439c12" class="bulleted-list"><li style="list-style-type:disc">USE for Container Memory<pre id="081afa49-0580-4ae5-8334-a68ccc7fd88c" class="code code-wrap"><code>#utilization
container_memory_working_set_bytes{container!=&#x27;POD&#x27;}
#è¡¥å……ï¼š we need to exclude the container whoâ€™s name contains â€œPODâ€. This is parent cgroup for this container and will track stats for all the containers in the pod.

#saturation è¿™é‡Œæˆ‘æŒ‰ç…§Podçº§åˆ«ç»Ÿè®¡çš„ï¼Œä¹Ÿå¯ä»¥æŒ‰ç…§containerçº§åˆ«
100 * sum(container_memory_working_set_bytes{container!=&#x27;POD&#x27;}) by(pod) / sum(kube_pod_container_resource_limits{container!=&#x27;POD&#x27;}) by(pod)
</code></pre><figure id="d44a538d-4488-424d-bd29-b53aeed55484" class="image"><a href="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2014.png"><img style="width:672px" src="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2014.png"/></a></figure><pre id="e56a6e44-08ac-4c4c-b8ce-9fef1394b21d" class="code code-wrap"><code>#utilization
sum(rate(container_fs_writes_bytes_total[5m])) by (container,device) + sum(rate(container_fs_reads_bytes_total[5m])) by (container,device)

#saturationå’Œerrors ç›®å‰æ²¡æœ‰æœ‰æ•ˆçš„æ–¹æ³•
sum(rate(container_network_receive_packets_dropped_total[5m])) by(name) + sum(rate(container_network_transmit_packets_dropped_total[5m])) by(name)</code></pre><p id="3cdf1cf1-61fd-45f3-9ac2-cc7d49cbc96a" class="">å¦‚æœæ¸…æ¥šå®¹å™¨å†…å­˜é¥±å’Œåº¦ï¼Œå°±å¯çŸ¥é“å®ƒç¦»å†…å­˜é™åˆ¶è¿˜æœ‰å¤šå°‘ï¼Œä»¥ä¾¿æŠŠæ§ï¼ˆå¢åŠ ï¼‰</p></li></ul><ul id="2e5c0547-8bf5-4941-acdd-c2d3fe587246" class="block-color-orange bulleted-list"><li style="list-style-type:disc">USE for networking<pre id="50101eb0-9e26-42a3-bee2-9522d9b8fb02" class="code code-wrap"><code>#utilization
sum(rate(container_network_receive_bytes_total[5m])) by (name) + sum(rate(container_network_transmit_bytes_total[5m])) by (name)

#saturation
sum(rate(container_network_receive_packets_dropped_total[5m])) by(name) + sum(rate(container_network_transmit_packets_dropped_total[5m])) by(name)

#errors
sum(rate(container_network_receive_errors_total[5m])) by(name) + sum(rate(container_network_transmit_errors_total[5m])) by(name)</code></pre></li></ul><p id="dbf74596-83bd-4ddf-bebc-ed5377ac943a" class="">API Controllerçš„æŒ‡æ ‡<div class="indented"><pre id="addb3d72-71b0-4b7a-bf36-986d7458184f" class="code code-wrap"><code>#utilization
sum(rate(apiserver_request_total[5m]))
sum(rate(apiserver_request_total[5m])) by(code,resource)

#errors
rate(apiserver_request_count{code=~&quot;^(?:5..)$&quot;}[5m]) / rate(apiserver_request_count[5m])
100 * sum by (instance,job) (rate(rest_client_requests_total{code!~&#x27;2..&#x27;}[5m])) /
sum by (instance,job) (rate(rest_client_requests_total[5m]))
#ä¸¤è€…æœ‰ä»€ä¹ˆåŒºåˆ«?

#duration
histogram_quantile(0.9, sum(rate(apiserver_request_latencies_bucket[5m])) 
by (le, resource, subresource, verb) ) / 1e+06</code></pre><figure id="ad5ab341-2844-4b06-a84a-c8cf16058a31" class="image"><a href="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2015.png"><img style="width:624px" src="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2015.png"/></a></figure><ul id="f4fb1a34-2398-4ed1-b389-64f7a8aff771" class="bulleted-list"><li style="list-style-type:disc">RED for API Server<figure id="4312a530-97c6-47ed-8dce-d7413922a9cd" class="image"><a href="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2016.png"><img style="width:624px" src="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2016.png"/></a></figure></li></ul><ul id="e49927cb-d083-4f97-ac57-e7acf772d089" class="bulleted-list"><li style="list-style-type:disc">kube-state-metrics éå¸¸æœ‰ç”¨çš„<figure id="046030c3-5033-4799-82d5-ada19d33b87c" class="image"><a href="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2017.png"><img style="width:528px" src="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2017.png"/></a></figure></li></ul><ul id="a14042d4-8fc7-4a3f-b3ba-f9e3bdbb66fe" class="bulleted-list"><li style="list-style-type:disc">ETCDæŒ‡æ ‡<figure id="a244a8c6-7d49-4d6b-a415-11faafb64222" class="image"><a href="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2018.png"><img style="width:432px" src="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2018.png"/></a></figure><p id="0a4ce335-4078-4075-916e-034b90bd0ba4" class="">ç£ç›˜IOæ€§èƒ½éå¸¸é‡è¦</p><p id="92e9ba65-0142-437a-942a-f628e7a300d5" class="">gRPCæ˜¯ä»€ä¹ˆï¼Ÿ</p></li></ul></div></p></div></p><p id="1aa9a8ee-463b-4f41-b813-fa60889ed09a" class="">
</p></div></p><p id="817bfda1-8785-4625-9cbf-404d948fcbd7" class="">Prometheus Operator<div class="indented"><p id="d2f2681f-7076-4340-94f6-9730681d52f2" class="">node-exporterå®‰è£…<div class="indented"><pre id="60162414-8cc5-4c55-a7c3-d306602b0d43" class="code code-wrap"><code>https://github.com/prometheus-operator/kube-prometheus/blob/main/manifests/node-exporter-daemonset.yaml</code></pre><p id="04154814-aff3-463f-af61-9c930118a9a1" class="">
</p></div></p></div></p></div></p><h1 id="a3a4f1a1-e39e-4e6c-b42d-f9ec0854386f" class=""><time>@November 6, 2021</time> </h1><p id="f2aea647-5ca6-4b5e-bd75-46c3815817ad" class="block-color-red">å¿˜äº†å’Œåšé”™äº†å“ªäº›ï¼Ÿ<div class="indented"><p id="8aad6fd2-618a-4659-820c-09f8545ecd44" class="">k8s<div class="indented"><p id="efd87cc0-b128-4610-aeac-1a8ec71790a8" class="">kubectl api-resources -o wide</p><p id="2c0a6380-1cbc-4771-bc3f-bb6c70511d33" class="">kubeadmå®‰è£…æ–¹å¼ï¼Œæ§åˆ¶ç»„ä»¶çš„æ–‡ä»¶æ”¾åœ¨å“ªé‡Œï¼Ÿ</p><p id="2f94e01f-8db9-4f5e-ad80-a618a18279c9" class="">æ–°é›†ç¾¤å»ºç«‹çš„24å°æ—¶ä¹‹åï¼Œtokenå°±ä¼šæ›´æ–°ï¼Œæ­¤åä¸å¯å†ç”¨åŸæ—¥å¿—ä¸­çš„æ·»åŠ èŠ‚ç‚¹å‘½ä»¤å»æ·»åŠ æ–°å·¥ä½œèŠ‚ç‚¹ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ<div class="indented"><pre id="8c51a14a-3d56-4756-8252-fff3d2895ea2" class="code code-wrap"><code># master æŸ¥çœ‹èŠ‚ç‚¹æ£€æŸ¥tokenæ˜¯å¦æœ‰æ•ˆ
kubeadm token list
# ç”Ÿæˆæ–°çš„tokenå’Œå‘½ä»¤ã€‚ç„¶ååœ¨nodeé‡æ–°æ‰§è¡Œ
kubeadm token create --print-join-command
#å¤åˆ¶ç²˜è´´åˆ°å·¥ä½œèŠ‚ç‚¹ä¸Šå³å¯</code></pre></div></p></div></p><p id="db38d087-95ca-4c49-b4fa-e27bc970693e" class="">docker<div class="indented"><p id="ccd2d941-7350-49e1-b28e-baecb91bda2f" class="">docker-composeæ–‡ä»¶æ˜¯<code>docker-compose.yaml</code></p><p id="c125f295-05ff-44cf-93f4-c36913e11f8d" class="">docker-compose <code>Version</code> å­—æ®µçš„å€¼æ˜¯å­—ç¬¦ä¸²</p><p id="e0e18872-6183-4168-aba5-5824e3f6fb57" class="">å¦‚æœä½ ä¸çŸ¥é“å½“å‰ESèŠ‚ç‚¹æ˜¯ä»€ä¹ˆç‰ˆæœ¬ï¼Œç”¨ä»€ä¹ˆæŸ¥çœ‹ï¼Ÿ<code>curl -XGET http://192.168.31.201:9200/?pretty </code></p></div></p><p id="d8d1df22-b424-4f0b-9580-4ed523a36690" class="">groovy <div class="indented"><p id="e5340818-67fc-48d8-88ce-1662359182f5" class="">è§£é‡Šæ€§å­—ç¬¦ä¸²ä¸­çš„å˜é‡å¦‚ä½•å¼•ç”¨</p><p id="e2dd3dc0-1e74-4f7a-b36b-5be79aaf066a" class="">æ˜ å°„èµ‹å€¼å¦‚ä½•åš</p><p id="c95f22a9-f4d6-4865-989e-d285a382a46a" class="">åˆ¤æ–­èµ‹å€¼æ€ä¹ˆåš</p></div></p><p id="26b0c12f-2948-4b8f-81de-9853e40e2d9f" class="">ansible<div class="indented"><p id="62310d88-31ac-4aa6-b3f9-23b9813ccf00" class="">yumæ¨¡å—å‚æ•°stateæœ‰presentå’Œabsent</p><p id="a432c9a9-5441-43c5-8ce3-fa8a1d69c490" class="">jinjia ifå’Œforæ˜¯å•èŠ±æ‹¬å·{%%}</p><p id="99dd87fb-b95c-47ab-8fbd-010f7a8bb77d" class="">inventory_hostnameæ³¨æ„ä¸è¦å†™é”™äº†</p><p id="49a7b613-1077-4e4f-94eb-0b1f2523ae1c" class="">åœ¨jinjaæ¨¡æ¿é‡Œï¼Œè¯·ä¸è¦ä¸º{{}}æ‰“ä¸ŠåŒå¼•å·, åŒå¼•å·ä¸è¢«æ¸²æŸ“è€Œæ˜¯ç›´æ¥ç•™ä¸‹æ¥</p><p id="30ac8169-29b4-48ef-8075-c9e6c5cdbfe3" class="">groups<div class="indented"><pre id="e6190bad-c07c-4dec-ad7f-a1347f5eb7eb" class="code code-wrap"><code>#æ¯ä¸ªhostéƒ½æœ‰å¯¹åº”groups built-inå˜é‡

&quot;groups&quot;: {
    &quot;all&quot;: [        #inventoryæ–‡ä»¶ä¸­çš„æ‰€æœ‰ä¸»æœºåç§°åˆ—åœ¨allçš„åˆ—è¡¨ä¸­
        &quot;node-02&quot;, 
        &quot;node-01&quot;, 
        &quot;node-03&quot;
    ],                   #inventoryæ–‡ä»¶ä¸­æ‰€æœ‰çš„ç»„éƒ½åˆ—å‡ºæ¥ï¼Œåˆ—è¡¨æ˜¯å®ƒçš„æˆå‘˜
    &quot;elasticsearch0&quot;: [   
        &quot;node-01&quot;
    ], 
    &quot;elasticsearch1&quot;: [   #æ¶‰åŠçš„ç»„
        &quot;node-02&quot;
    ], 
    &quot;elasticsearch2&quot;: [   #æ¶‰åŠçš„ç»„
        &quot;node-03&quot;
    ], 
    &quot;ungrouped&quot;: []
}

ä¾‹å­ï¼š
- name: add host record to /etc/hosts
    lineinfile:
        dest: /etc/hosts
        regex: &quot;^{{ hostvars[item].ansible_ssh_host }} .*&quot;
        line: &quot;{{ hostvars[item].ansible_ssh_host }} {{item}}&quot;
    with_items: &quot;{{ groups.all }}&quot;  #å¾—åˆ°åˆ—è¡¨</code></pre></div></p></div></p></div></p><p id="6211db62-0eb4-4915-9ef4-c8160ccfe147" class="">
</p><p id="811ecc61-5e2b-4cd9-802a-9a5e7f597b15" class="">IngressåŸºç¡€çŸ¥è¯†æ•´ç†<div class="indented"><p id="f025d683-1adf-40e0-929b-759ef2eeecf2" class="">How Ingress-Nginx works<div class="indented"><p id="00db22db-4857-418f-b41d-d9436a893fd6" class="">
</p></div></p><p id="895d2d15-d882-48c1-a710-ff325805abec" class="">åœ¨Kubernetesæœ‰ä¸¤ç§Ingress-nginxï¼š<div class="indented"><ul id="27cf1702-da9a-4e60-9258-515701550fcf" class="bulleted-list"><li style="list-style-type:disc">Nginxinc/Kubernetes-Ingress æ›´åŠ æ´»è·ƒ<ul id="4a8b0fae-12a5-4f8d-be25-84e55862da38" class="bulleted-list"><li style="list-style-type:circle">æ¥è‡ªkubernetesç¤¾åŒº</li></ul><ul id="9512934f-0565-457a-88ab-a37819cb3079" class="bulleted-list"><li style="list-style-type:circle">è‡ªå®šä¹‰NGINXæ„å»ºï¼ŒåŒ…å«ä¸€äº›nginxç¬¬ä¸‰æ–¹æ¨¡å—</li></ul><ul id="030b3496-45f4-42cf-8351-0945da3cb8d6" class="bulleted-list"><li style="list-style-type:circle">æ‰€æœ‰Ingress Resourceåœ¨ä¸€ä¸ªé…ç½®æ–‡ä»¶ä¸­</li></ul></li></ul><ul id="600a5fed-698c-4258-9d1f-8cad601f122f" class="bulleted-list"><li style="list-style-type:disc">Kubernetes/Ingress-Nginx æ›´åŠ ç¨³å®š<ul id="c59533ea-abce-4c05-b010-670eb91f99c3" class="bulleted-list"><li style="list-style-type:circle">æ¥è‡ªNGINX inc. and Community</li></ul><ul id="d7100b68-9d27-450c-a08b-78e36a0364ec" class="bulleted-list"><li style="list-style-type:circle">Official NGINX build</li></ul><ul id="12ba34ff-c63a-46d1-aed7-bc687d645a14" class="bulleted-list"><li style="list-style-type:circle">æ¯ä¸ªIngress Resourceæœ‰ç‹¬ç«‹çš„é…ç½®æ–‡ä»¶</li></ul></li></ul></div></p><p id="95b9c66f-e7d0-459f-afbc-19e4fb59cf38" class="">éƒ¨ç½²<div class="indented"><pre id="6740a3b1-b09c-49a0-84cc-ccf83a952645" class="code"><code>helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx
helm repo update

helm pull ingress-nginx/ingress-nginx
tar xf ${taråŒ…}
vim values.yaml
  #å°†.Values.kindæ”¹ä¸ºDaemonSet
    kind: DaemonSet
  #å°†.Values.hostNetwork
		hostNetwork: true		
  #å°†.Values.hostPort.enabled
		hostPort:
		    enabled: true

kubectl create ns ingress-nginx
helm upgrade --install -n ingress-nginx ingress-nginx</code></pre><p id="9a8c1e37-2df1-49fd-ac81-1da7f6361923" class="">ğŸ’¡æ§åˆ¶Ingress-Nginxåœ¨æŒ‡å®šçš„Nodeä¸Šè¿è¡Œï¼Œè¿™ä¸ªæ–¹æ³•å¥½ï¼<div class="indented"><pre id="b0daa7cd-2d4e-4e0e-b7e1-a16a95d44787" class="code"><code></code></pre></div></p><p id="ba5f6842-87be-40a6-b85a-efaa8f5985f9" class="">åšåˆ°è¿™ä¸€æ­¥ï¼ŒNginx-Ingresså°±éƒ¨ç½²å¥½äº†ï¼Œæ¥ä¸‹æ¥å¯ä»¥å®šä¹‰ingressèµ„æºå¯¹è±¡äº†</p><p id="09582fa2-8470-4a64-ae0c-2b274358b113" class="">ğŸ˜•å…³äºingresså¯¹è±¡ï¼Œåº”è¯¥æœ‰å“ªäº›çŸ¥è¯†ç‚¹éœ€è¦äº†è§£ï¼Ÿ</p></div></p></div></p><p id="13018e88-ab82-40fa-bad8-41ce4bb20c4b" class="">
</p><p id="56b8dece-245b-462f-b329-a1af40ada499" class="">Cert-Manager<div class="indented"><p id="5da878e8-7b41-4d89-9ab2-e5919d60b368" class="">â“æœ‰ä»€ä¹ˆç”¨ï¼šä¸ºä¾¿æ·å®ç°Ingress-Nginxçš„TLSåŠŸèƒ½ï¼Œéœ€è¦å€ŸåŠ©Cert-Manager</p><p id="c5feea55-adf9-4d76-a8a2-766ee09a4ae6" class="">éƒ¨ç½²<div class="indented"><pre id="64cc86d8-dc8d-43fe-a918-adbb274108ac" class="code"><code>#å®‰è£…CRD Custom Resources Definition
kubectl apply -f https://github.com/jetstack/cert-manager/releases/download/v1.6.1/cert-manager.crds.yaml
challenges/orders/certificaterequests/certificates/clusterissuers/issuers/certificatesigningrequests

helm pull jetstack/cert-manager                           
tar xf cert-manager-v1.6.1.tgz
helm upgrade -n cert-manager --install cert-manager cert-manager</code></pre></div></p></div></p><p id="02821360-f974-45a3-b9d4-42231f5af7a5" class="">
</p><h1 id="0301a7b9-62f9-44ab-aa70-fcb685abea7d" class=""><time>@November 23, 2021</time> </h1><h1 id="ad25da08-8695-4c47-ac1d-d994c2347f98" class=""><time>@November 24, 2021</time> </h1><h1 id="acc3c882-0119-40b5-b648-8c0727539d0a" class=""><time>@November 25, 2021</time> </h1><p id="4bedfe4a-9561-44b3-bc36-b2a09bbb4c1d" class="">AWS DEVOPS<div class="indented"><p id="d18336a1-0f5f-45a3-9aba-3fd9bff351ca" class="">ä¸æ‡‚çš„åŸºç¡€æ¦‚å¿µ</p><ul id="c9d821e7-2f72-4178-917c-c4042c0afb80" class="bulleted-list"><li style="list-style-type:disc">ä»€ä¹ˆæ˜¯role?</li></ul><p id="4a15d983-bf1a-41a5-be9a-d773bbab51fc" class="">æ¶‰åŠDEVOPSçš„æ¦‚å¿µ:</p><ul id="776c3440-a8f9-4247-ad4d-7542257bdb0b" class="bulleted-list"><li style="list-style-type:disc">Elastic Beanstalk æä¾›äº†ä¸€ä¸ªåº•å±‚ç¯å¢ƒ ç”¨äºè¿è¡Œåº”ç”¨ </li></ul><ul id="dac843f9-a061-43bd-9cb1-3b2f4afa64a5" class="bulleted-list"><li style="list-style-type:disc">CodeBuild: compile + test + package + parallel build execution</li></ul><ul id="4560360f-98a9-4da9-840e-542cda774087" class="bulleted-list"><li style="list-style-type:disc">CodePipeline </li></ul><ul id="16d17ab1-9e7a-4844-b550-285cf49d823d" class="bulleted-list"><li style="list-style-type:disc">CodeDeploy</li></ul><p id="77c43b14-c7c6-431c-8a31-b61b7f2e7305" class="">æ¶‰åŠDEVOPSçš„ä¸æ‡‚çš„</p><ul id="4fc7b05c-322d-45ad-8220-66fd6146eeae" class="bulleted-list"><li style="list-style-type:disc">buildSpec</li></ul><p id="4e7584c7-f015-44bd-9268-80e4ad7d5755" class="">
</p></div></p><p id="d98d47d6-c2c9-4f1e-9086-5b356d0d4858" class="">AWS fundamentals<div class="indented"><p id="4adf88ce-9732-46a8-807f-a124a621fe3c" class="">products<div class="indented"><figure id="a9f553bc-06a1-481f-89cd-d310b9897114" class="image"><a href="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2019.png"><img style="width:624px" src="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2019.png"/></a></figure></div></p><p id="787d69eb-23cd-4c7b-8edc-4e3c0bc55b09" class="">Region &amp; Available Zone<div class="indented"><p id="e4833513-fa94-4bdf-b3c3-c5e548654380" class="">Regionï¼Œä»£è¡¨ä¸€ä¸ªåœ°åŒº, æ¯”å¦‚æ‚‰å°¼ã€æ–°åŠ å¡ï¼Œè¿™ä¸ªåœ°åŒºæœ‰å‡ ä¸ªAvailable Zoneç»„æˆ</p><p id="5078bb21-8c69-4830-81d4-102698e40544" class="">Available Zone<div class="indented"><p id="4821fd64-f512-4da9-92f2-478788552aee" class="">ä¸€ä¸ªåœ°åŒºç”±å‡ ä¸ªç‰©ç†ä¸Šå½¼æ­¤éš”ç¦»çš„AZç»„æˆï¼Œå½¼æ­¤ç›¸è·100kmï¼Œä¹‹é—´äº’è”æ˜¯å†—ä½™çš„é«˜å¸¦å®½å’Œä½å»¶è¿Ÿçš„ï¼Œä¸€æ—¦æœ‰ç¾å®³å‘ç”Ÿå¯ä¿è¯é«˜å¯ç”¨</p><p id="44deaf49-7d6a-471d-a4f4-a211cb9d6a45" class="">ä¸€ä¸ªAZç”±å¤šä¸ªæ•°æ®ä¸­å¿ƒç»„æˆï¼ŒAZ è”æƒ³ä¸€ä¸‹ï¼šç§»åŠ¨å…¬å¸çš„æœºæˆ¿å›­åŒºï¼Œå®ƒç”±å¤šä¸ªæ•°æ®ä¸­å¿ƒå¤§æ¥¼ç»„æˆ</p><figure id="fc090a6e-44c3-4173-884b-abe887a96120" class="image"><a href="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2020.png"><img style="width:1412px" src="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2020.png"/></a></figure></div></p><p id="d78644f8-9e11-402d-83a5-556ea7571932" class="">Global Infrastructure <div class="indented"><p id="cf6e7422-9a68-4940-ac22-a197035bfca0" class="">(ç©º)</p></div></p></div></p><p id="454b92b6-241c-44d2-a366-b7e7abc5414e" class="">
</p><p id="759c843c-0ccc-4c1d-b970-22c19d7dd6da" class="">IAM(Identity Access Management)<div class="indented"><p id="74b572bc-6a24-46ee-9bd5-484a87dc2e18" class="">What &amp; Why<div class="indented"><p id="90ff53ce-37fb-4e98-b6ab-d041301a6933" class="">IAMï¼Œä¸€ç»„ä¿¡æ¯ï¼Œå®ƒè§„å®šäº†æŸä¸ªç”¨æˆ·å¯¹æŒ‡å®šçš„AWSèµ„æºæ‹¥æœ‰ä»€ä¹ˆæ ·çš„æƒé™</p><figure id="50153909-0894-4d31-9cf5-8838272c974a" class="image"><a href="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2021.png"><img style="width:1859px" src="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2021.png"/></a></figure><figure id="4d40a662-c42a-4bd4-b573-36d462882746" class="image"><a href="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2022.png"><img style="width:1100px" src="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2022.png"/></a></figure><p id="51e3f783-6e44-41a4-8c81-3a37a2b4e240" class="">Two Authentication Methods to access AWS  resources<div class="indented"><figure id="e53117be-e7e3-494a-91b5-47db217126cb" class="image"><a href="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2023.png"><img style="width:1152px" src="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2023.png"/></a></figure></div></p></div></p><p id="6757cca2-f84d-4dfb-b608-45186b4025a2" class="">How<div class="indented"><p id="634cb71b-7725-4c20-b5ef-dc7992070ce0" class="">Create IAM Users and Groups<div class="indented"><ol type="1" id="ec1f7ad9-083c-485b-9c1c-80a825e7be06" class="numbered-list" start="1"><li>define an IAM policy</li></ol><ol type="1" id="de848e31-1cb2-4aba-ad82-a25dfcdc2056" class="numbered-list" start="2"><li>Create a group and attach the IAM policy to the group</li></ol><ol type="1" id="a71dd10b-f68e-4e1e-ba91-3e4d6f7c9165" class="numbered-list" start="3"><li>Create a user and put the user into the group</li></ol></div></p></div></p></div></p></div></p><p id="2147f72e-d8ba-4399-aac8-17efbb1aebd7" class="">
</p><p id="f0be5a12-be14-4660-8dfe-549f3677fc1d" class="">VPC/Subnets/Routers/Internet Gateway<div class="indented"><p id="2d1e072e-0d57-4861-af0b-e4cb0f585212" class="">What &amp; Why<div class="indented"><p id="2f30bc8b-f2b6-4dbe-9186-25a3dfb8f9ac" class="">VPC å¸®åŠ©ç§Ÿæˆ·å®Œå…¨åœ°æ§åˆ¶è‡ªå·±çš„è™šæ‹Ÿç½‘ç»œ, åŒ…æ‹¬èµ„æºæ”¾ç½®ã€è¿æ¥æ€§å’Œå®‰å…¨æ€§<div class="indented"><ul id="92590b3d-8686-4a4b-a6ed-74fd78a4ce04" class="bulleted-list"><li style="list-style-type:disc">ä¸€ä¸ªVPCå­˜åœ¨äºæŸä¸ªRegionä¸­</li></ul><ul id="3c9bbf26-05d5-480a-9cf3-bb4b7d841b54" class="bulleted-list"><li style="list-style-type:disc">ä¸€ä¸ªVPCï¼Œé»˜è®¤ä¸ºæ¯ä¸ªAZï¼Œåˆ›å»ºä¸€ä¸ªSubnetï¼Œæ¯”å¦‚æ‚‰å°¼æœ‰3ä¸ªAZæ•…æœ‰3ä¸ªsubnetes</li></ul><figure id="1a79553e-d6b9-4f23-ac18-15cf15b7a795" class="image"><a href="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2024.png"><img style="width:1351px" src="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2024.png"/></a></figure><figure id="da9b1ca5-41c7-4ab9-a701-f005f76702ad" class="image"><a href="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2025.png"><img style="width:1382px" src="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2025.png"/></a></figure></div></p></div></p></div></p><p id="ab0962ec-d96b-4701-a1d2-ce8c955f53ed" class="">How<div class="indented"><p id="44d43264-11a8-4660-929b-772f0bb29e5b" class="">Security Groups<div class="indented"><p id="793b293b-cf57-49ce-bc8b-8b90a2a0702e" class="">What<div class="indented"><ol type="1" id="e86c710c-051f-43e3-885a-1c65559cc800" class="numbered-list" start="1"><li>æ˜¯æœ‰<mark class="highlight-red">çŠ¶æ€çš„instance-levelçš„</mark>firewall</li></ol><ol type="1" id="1f2533b7-1a21-4a47-bcac-b0a84275d22a" class="numbered-list" start="2"><li>åˆ†ä¸ºinboundå’Œoutboundï¼Œåœ¨å„è‡ªä¸­å®šä¹‰allowè§„åˆ™ï¼Œåªå¯allowå› ä¸ºé»˜è®¤denyæ‰€æœ‰ï¼Œè§„åˆ™åŸºäºåè®®ä¸ç«¯å£</li></ol><ol type="1" id="91bc1914-c413-4df9-9d56-14f7520ddf41" class="numbered-list" start="3"><li>VPCè‡ªåŠ¨å¸¦æœ‰ä¸€ä¸ªSecurity Group defaultï¼Œä¸å¯åˆ é™¤ï¼Œinboundå…è®¸æ¥è‡ªæœ¬Security Groupçš„instanceçš„è®¿é—®ï¼Œoutbound allowæ‰€æœ‰<figure id="2427b60f-7146-48b1-a0e7-c17705aaebe4" class="image"><a href="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2026.png"><img style="width:480px" src="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2026.png"/></a></figure></li></ol><ol type="1" id="91066637-de2b-4d5c-899f-610bca76b970" class="numbered-list" start="4"><li>æ–°å»ºçš„Security Groupï¼Œinboundæ²¡æœ‰è§„åˆ™å³æ‹’ç»æ‰€æœ‰å…¥æ–¹å‘æµé‡(å³æ—¶åœ¨åŒä¸€ä¸ªSecurity Groupçš„instanceä¹‹é—´ä¹Ÿæ— æ³•é€šä¿¡ï¼Œé™¤éé…ç½®è§„åˆ™ï¼Œä¾‹å¤–ï¼šSecurity Group default)ï¼›outboundæ˜¯æ”¾å¼€æ‰€æœ‰<p id="f5de3782-38df-4885-a11b-e0d1ca3c2bb4" class="">outboundé»˜è®¤å¼€æ”¾æ‰€æœ‰ï¼ˆè‹¥ç©ºåˆ™ä¹Ÿdeny allï¼‰ï¼Œ</p></li></ol><ol type="1" id="5b5e4e1e-9959-46d3-adb2-cb25ab84b4a4" class="numbered-list" start="5"><li>quotasä¸æ‡‚ï¼Œå‚è€ƒ<a href="https://docs.aws.amazon.com/vpc/latest/userguide/amazon-vpc-limits.html">https://docs.aws.amazon.com/vpc/latest/userguide/amazon-vpc-limits.html</a></li></ol><ol type="1" id="2f9ebf05-e7cd-4c8c-9c9b-9c9f17849138" class="numbered-list" start="6"><li>Security Groupå…³è”instanceçš„network interface. æ–°å»ºinstanceçš„primary network interfaceä¸Security Groupå…³è”. å¦‚Security Groupå…³è”äº†network interfaceåˆ™æ— æ³•è¢«åˆ é™¤.</li></ol><ol type="1" id="632f080a-3086-4580-8c00-4ae776ecacc1" class="numbered-list" start="7"><li>å¯å°†instanceå…³è”åˆ°æ–°çš„Security Groupï¼Œä¸€ä¸ªinstanceè‡³å°‘è¦æœ‰ä¸€ä¸ªSecurity Groupï¼Œæœ€å¤šå¯å…³è”5ä¸ªSecurity Groupï¼Œ</li></ol><ol type="1" id="2692ad4f-fc71-4f90-96f0-8488c859767f" class="numbered-list" start="8"><li>å¯ç”¨å‘½ä»¤è¡Œæ·»åŠ Security Group</li></ol><p id="6bf68302-a726-4bd3-b200-a4f6849aeb7e" class="">è¡¥å……ï¼š<div class="indented"><p id="752b3b11-2bdd-4bba-b588-f8c8dd7428be" class="">VPCè‡ªåŠ¨å¸¦æœ‰ä¸€ä¸ªé»˜è®¤Security Group<div class="indented"><ul id="aef3cc13-31af-4ce9-9f58-220f82c75bbb" class="bulleted-list"><li style="list-style-type:disc">å¦‚ä½¿ç”¨è‡ªåŠ¨è„šæœ¬åˆ›å»ºinstanceï¼Œè‹¥ä¸æ˜¾ç¤ºæŒ‡å®šSecurity Groupåˆ™æŒ‡å®šä¸ºé»˜è®¤çš„Security Group</li></ul><ul id="bbfbd083-21b8-4be6-bc3c-8a799ca86ec8" class="bulleted-list"><li style="list-style-type:disc">è‹¥é€šè¿‡consoleåˆ›å»ºinstanceï¼Œåˆ™æ–°å»ºå¹¶æŒ‡å®šä¸º<code>launch-wizard-</code><code><em>xx</em></code>Security Group</li></ul></div></p><p id="97ecc1a4-93f2-4d05-83da-8ff31122b93a" class="">Centrally manage VPC security groups using AWS Firewall Manager ï¼ˆæœªç ”ç©¶ï¼‰å‚è€ƒ<a href="https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html#changing-instance-security-groups">https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html#changing-instance-security-groups</a></p></div></p></div></p><p id="1434a1be-9bfe-486e-933d-860b4389389c" class="">Operation<div class="indented"><p id="a8fe7377-f2d4-4323-b2ee-fb71086eed56" class=""><mark class="highlight-teal">Modify the default security group
Create a security group
View your security groups
Tag your security groups
Add rules to a security group
Update security group rules
Tag security group rules
Delete security group rules
Change the security groups for an instance
Delete a security group</mark></p></div></p></div></p><p id="acb07aad-2eaf-4ec5-aad6-63ae1211cbcc" class="">NACL<div class="indented"><p id="f08300f4-a07b-4fcc-b4f5-9bdc85d0d7fd" class="">What<div class="indented"><ol type="1" id="3f2f8646-59a0-420b-a1e2-8c4a59f34ec1" class="numbered-list" start="1"><li>ä½œä¸ºä¸€ç§è¡¥å……ï¼Œæ§åˆ¶å­ç½‘è¿›å‡ºæµé‡çš„statelessé˜²ç«å¢™ï¼ŒåŸºäºå­ç½‘</li></ol><ol type="1" id="d2d07dab-6f48-4641-93c7-3f1439caa8fb" class="numbered-list" start="2"><li>VPCè‡ªåŠ¨å¸¦æœ‰ä¸€ä¸ªNACL defaultï¼Œå®ƒé»˜è®¤å…è®¸è¿›å‡ºtrafficï¼›è€Œè‡ªå®šä¹‰çš„NACLé»˜è®¤denyè¿›å‡ºæµé‡</li></ol><ol type="1" id="62330eb6-c50a-4a7e-bc8f-db91088ee113" class="numbered-list" start="3"><li>æ¯ä¸ªsubnetå¿…é¡»å…³è”ä¸€ä¸ªNACLï¼Œè‹¥ä¸æŒ‡å®šåˆ™å…³è”NACL default</li></ol><ol type="1" id="415b7293-813f-41e7-9d9f-281fa19a6464" class="numbered-list" start="4"><li>ä¸€ä¸ªNACLå¯å…³è”å¤šä¸ªsubnetï¼Œè€Œsubnetåªå¯å…³è”ä¸€ä¸ªNACL</li></ol><ol type="1" id="fb06ac80-a720-4a9c-a6bb-ff4d55581465" class="numbered-list" start="5"><li>ä¸€ä¸ªNACLåˆ†inboundå’Œoutboundï¼Œå„è‡ªå¯åŒ…å«ä¸€ç»„rulesï¼Œruleå¯ä¸ºallowæˆ–denyï¼Œä»æœ€ä½å·å¼€å§‹åŒ¹é…ï¼Œå®šä¹‰å·ç æ—¶å»ºè®®æ­¥è¿›ä¸º100</li></ol><ol type="1" id="c5403daf-a6eb-4ab6-b57f-0a3c3756ddda" class="numbered-list" start="6"><li>statelessï¼Œå³inboundæµé‡æ˜¯å¦allowedï¼Œç”±inboundè§„åˆ™å†³å®šï¼Œå¿…é¡»æ³¨æ„ï¼ï¼ä¸statefulå®Œå…¨ä¸ä¸€æ ·</li></ol><ol type="1" id="368f7aef-f5c3-46c7-b5f1-e37662c9bcfb" class="numbered-list" start="7"><li>é…ç½®rulesåï¼Œå³æ—¶ç”Ÿæ•ˆ</li></ol></div></p><p id="e8c129c8-4c82-482b-a871-789a0f29e50c" class="">Operationï¼š<div class="indented"><p id="56abd40d-1729-465f-a410-57a718cb83ea" class="">inbound/outbound add rules &amp; delete rules</p><p id="cead0e10-abbf-41d2-9562-a963b6efa280" class="">create &amp; delete NACL </p></div></p><p id="f7c6d494-5b3b-42d5-b96b-bdeaef6310b8" class="">è¡¥å……ï¼š<div class="indented"><ul id="b5a1e101-4fdf-4683-93dd-e5ef9d00ff42" class="bulleted-list"><li style="list-style-type:disc">ç”¨APIæˆ–å‘½ä»¤è¡Œå·¥å…·ï¼Œåˆ™åªèƒ½åˆ åˆ›ï¼Œä¸å¯ä¿®æ”¹ï¼›ç”¨consoleå¯å¢åˆ æ”¹</li></ul></div></p><ul id="77e10536-70ec-4e31-9487-31487a089b65" class="bulleted-list"><li style="list-style-type:disc">åŒºåˆ«<figure id="866f69d7-e13c-40bf-b3a9-0c462fd896bd" class="image"><a href="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2027.png"><img style="width:971px" src="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2027.png"/></a></figure></li></ul><ul id="b2c183b1-2b5c-4a70-aa0f-96495e1e3fb0" class="bulleted-list"><li style="list-style-type:disc">subnet-level firewall</li></ul><ul id="a5add95e-bffd-4bb1-a1a4-5c74ccab7bc2" class="bulleted-list"><li style="list-style-type:disc">default allow all traffic</li></ul><ul id="5cc54081-5817-42de-9fc2-2d01f604ec1e" class="bulleted-list"><li style="list-style-type:disc">inbound + outbound + subnet association </li></ul></div></p></div></p><p id="69e986fa-b731-450f-a409-386dbc402f18" class="">
</p><p id="92a756bb-00a5-40ba-b94a-2951a282ab05" class="">EC2<div class="indented"><ul id="d638c7ef-f050-4906-bb27-651557cde37e" class="bulleted-list"><li style="list-style-type:disc">Public subnetsä¸­çš„instanceæœ‰privateå’Œpublic IP; Private subnetsä¸­çš„instanceåªæœ‰private IP</li></ul><ul id="c066c268-d1c5-4730-a440-13016d1bc335" class="bulleted-list"><li style="list-style-type:disc">An EC2 instance is a virtual machine, assigned with CPU&amp;Mem&amp;NetworkCard&amp;Storage&amp;OperatorSystem&amp;APP<figure id="2ef73780-1d54-4f22-b880-70e68b90cbfe" class="image"><a href="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2028.png"><img style="width:1335px" src="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2028.png"/></a></figure></li></ul><ul id="df40c7c6-74d1-4060-91b8-ee53ff7ad6ca" class="bulleted-list"><li style="list-style-type:disc">EC2 instances can have three kind of IP: Public/Private/Elastic IP<figure id="c71fa450-9005-45b2-b3c3-8f4d32ed5d5f" class="image"><a href="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2029.png"><img style="width:624px" src="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2029.png"/></a></figure></li></ul><ul id="624ad845-4078-4a24-b1dc-46ec601fb0bb" class="bulleted-list"><li style="list-style-type:disc">NAT<figure id="3d02143d-b4da-4148-9284-53f24bc75a09" class="image"><a href="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2030.png"><img style="width:624px" src="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2030.png"/></a></figure></li></ul><ul id="e4573174-7fe9-44a3-85cd-451827699913" class="bulleted-list"><li style="list-style-type:disc">Launch an EC2 instance<ul id="1931ef3d-75a8-4fe5-9b19-41270ec1e6d1" class="bulleted-list"><li style="list-style-type:circle">AMIå¯ç†è§£ä¸ºä¸€ä¸ªå¹²å‡€çš„æ“ä½œç³»ç»Ÿçš„å¿«ç…§<figure id="4ceb369d-387c-4367-89df-246ac60ee786" class="image"><a href="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2031.png"><img style="width:903px" src="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2031.png"/></a></figure></li></ul></li></ul><ul id="3b0fd9fb-d7f7-4f87-a675-b287c11d292b" class="bulleted-list"><li style="list-style-type:disc">Connecting to EC2<p id="cb5caeb5-4b07-4c25-b691-27b8a6ee3dd5" class="">(å¾…è¡¥å……)</p></li></ul><ul id="94016f1a-1796-4cb9-be36-b2f21466ecad" class="bulleted-list"><li style="list-style-type:disc">ä½¿ç”¨User dataå¯å®ç°è‡ªåŠ¨é…ç½®ï¼Œæ¯”å¦‚å¯è‡ªåŠ¨é…ç½®ä¸€ä¸ªWebåº”ç”¨, ç®­å¤´å¤„ä½ å¯ç²˜è´´Shellè¯­å¥, å°†è‡ªåŠ¨è¿è¡Œè„šæœ¬<figure id="c364b2e2-c4bb-45cc-a733-2ad8fed7570d" class="image"><a href="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2032.png"><img style="width:716px" src="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2032.png"/></a></figure></li></ul><ul id="42e8cc66-e35b-4296-ad69-8fe94a031964" class="bulleted-list"><li style="list-style-type:disc">Using Key Pairs with Amazon EC2(æœªå¼„æ¸…é™¤)<figure id="01f90f7c-3409-42aa-b545-1927b6655efa" class="image"><a href="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2033.png"><img style="width:1187px" src="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2033.png"/></a></figure></li></ul><ul id="7203c2dd-5ddd-4c6a-abe7-5f5d22463766" class="bulleted-list"><li style="list-style-type:disc">Using IAM Roles with AWS EC2<p id="701bc39a-edae-4015-befa-69b20d17e395" class="">Roles is assumed by EC2 instances.</p><figure id="9903895c-5c7b-4546-a507-94d3912db400" class="image"><a href="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2034.png"><img style="width:1243px" src="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2034.png"/></a></figure></li></ul><ul id="ac72954a-900e-4a87-a3e0-dc037aba1480" class="bulleted-list"><li style="list-style-type:disc">EC2 Auto Scaling<p id="99855bdb-976b-4a91-a082-d6ebb5f43d13" class="">automatically launch and terminate EC2 instances<div class="indented"><ul id="9f8b2d04-39c4-4d4b-89d7-2ccafc873ecd" class="bulleted-list"><li style="list-style-type:disc">terminate the instance that failure and replace that with a new EC2<figure id="b9b6badf-01cd-4f9a-8800-4c727480cd6b" class="image"><a href="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2035.png"><img style="width:1150px" src="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2035.png"/></a></figure></li></ul><ul id="ee58764a-bdcd-4016-bf9f-bd6efab81db8" class="bulleted-list"><li style="list-style-type:disc">CloudWatch é‡‡é›†æŒ‡æ ‡ï¼Œå½“Auto Scaling groupä¸­instancesçš„æŸä¸ªå…¨å±€èµ„æºæŒ‡æ ‡(æ¯”å¦‚CPU)è¾¾åˆ°é˜ˆå€¼ï¼Œåˆ™CloudWatché€šçŸ¥Auto Scaling group, Auto Scaling group launchæ–°çš„EC2; å½“æŒ‡æ ‡é™åˆ°é˜ˆå€¼ä»¥ä¸‹ï¼Œåˆ™CloudWatché€šçŸ¥Auto Scaling group,Auto Scaling group terminate EC2<figure id="f25788dd-47d3-42fc-9916-ba8ee90b24ad" class="image"><a href="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2036.png"><img style="width:1110px" src="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2036.png"/></a></figure></li></ul><p id="86b906f2-fbea-4b75-8909-886d58bcedd9" class="">QA:<div class="indented"><p id="1e1f7a2e-fe4a-427f-b8cd-94551ac5a5e8" class="">EC2 health checkæ˜¯å•¥ï¼Ÿ</p></div></p><p id="1082bd1c-7d63-4411-b3fd-e315c3117e1c" class="">æ“ä½œæµç¨‹ï¼š<div class="indented"><ol type="1" id="5a6a7dac-8eec-45f9-860c-1921342ba4e5" class="numbered-list" start="1"><li>Define Launch Template</li></ol><ol type="1" id="a6c29304-e2f3-40c2-83a1-bfe5edfaa318" class="numbered-list" start="2"><li>Define Auto Scaling Group and attach LT to it</li></ol><ol type="1" id="ea5a4998-393c-4b04-b6ef-575db314b9d2" class="numbered-list" start="3"><li>Define dynamically scale policy</li></ol></div></p></div></p></li></ul><ul id="5e29621b-545b-4ec6-a8fd-a882995f42d0" class="bulleted-list"><li style="list-style-type:disc">Add Load Balancing with Amazon ELB<p id="45d9d4c3-b90c-4e98-bf20-a3cc7813d2db" class="">Introduction<div class="indented"><ul id="4d958da5-4d74-414f-a45c-ab2b29c87085" class="bulleted-list"><li style="list-style-type:disc">Elastic LBæŒ‡å¼•æµé‡åˆ°EC2ï¼ŒEC2ä½äºä¸åŒAZå³å¯ä»¥ä½äºä¸åŒsubnets</li></ul><ul id="f6c90878-8e42-4fb5-a61a-de26b8ab1959" class="bulleted-list"><li style="list-style-type:disc">ELB å¯¹EC2 instancesä½œhealth checkï¼Œå¦‚æŸä¸ªfailedåˆ™å°†å…¶ä»serviceç§»å‡ºå¹¶é€šçŸ¥Auto Scaling, Auto Scaling terminate the failed instanceï¼Œå¹¶launch new instanceï¼Œ ELBå°†new instanceæ”¾å…¥service.<ul id="7c5db981-4cb8-4c4c-8b81-92b51b3cd111" class="bulleted-list"><li style="list-style-type:circle">protocol + port </li></ul><ul id="95a9082f-6968-4b39-919b-a2bfa7a7db73" class="bulleted-list"><li style="list-style-type:circle">url path</li></ul><figure id="729f3d3d-3ab7-4323-a199-af8d5eddd9e0" class="image"><a href="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2037.png"><img style="width:528px" src="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2037.png"/></a></figure><figure id="38b91113-0c89-47b0-8ca4-b1cec4543e87" class="image"><a href="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2038.png"><img style="width:528px" src="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2038.png"/></a></figure></li></ul><ul id="7e267787-9b83-456d-b72f-861d497b268e" class="bulleted-list"><li style="list-style-type:disc">three kinds of ELB: http&amp;https / tcp&amp;udp&amp;tls /(ç•¥)</li></ul></div></p></li></ul><p id="3ba9cd9e-3ebc-4862-b585-a9a7cba19cd2" class="">æ“ä½œé¡ºåºï¼š<div class="indented"><ol type="1" id="dc797886-6c4e-4186-a060-2b24b58d1d88" class="numbered-list" start="1"><li>TG</li></ol><ol type="1" id="364550bb-8665-49ca-8f1c-15993223ab26" class="numbered-list" start="2"><li>Launch Template â†’ Auto Scaling Group</li></ol><ol type="1" id="2f12891b-c8d0-40b9-878d-3efb2d8615e8" class="numbered-list" start="3"><li>LB</li></ol></div></p><p id="1c06617d-341e-4b16-8cd3-930a9d5ad69f" class="">
</p></div></p><p id="9cd1e583-cf54-42c0-92d5-2973032e6e39" class="">Storage Services<div class="indented"><p id="0ff26cae-f393-4154-952f-e2d156d34a9d" class="">AWS Storage Overview<div class="indented"><figure id="df33a2fe-4001-4f98-a70a-f801b1d92ac8" class="image"><a href="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2039.png"><img style="width:1440px" src="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2039.png"/></a></figure></div></p><p id="fd2d9fcf-ab43-4a62-a5bf-9d0409f8a89b" class="">EBS<div class="indented"><figure id="ba648ea2-eb23-4b56-b3ae-55d1a8720f7a" class="image"><a href="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2040.png"><img style="width:1190px" src="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2040.png"/></a></figure><p id="e86219f0-4365-4e97-b763-a8331eb52b25" class="">What: <div class="indented"><p id="b197916f-75ad-4962-bb64-4731bd45e89f" class="">The mainly four categories<div class="indented"><p id="1e76f153-8d59-4bb4-9147-58d5889fe9ff" class="">å…³äºIOPSå’ŒThroughputçš„è¯¦æƒ…éœ€å‚è€ƒï¼š<a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ebs-optimized.html">https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ebs-optimized.html</a></p><figure id="db894caa-d6bb-4b1f-a90d-e4221dbb2d6b" class="image"><a href="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2041.png"><img style="width:1307px" src="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2041.png"/></a></figure><figure id="87194e02-78dc-4e5d-a8b9-14cc08f21641" class="image"><a href="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2042.png"><img style="width:1287px" src="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2042.png"/></a></figure><p id="05a6209f-be48-4902-9cde-7eebbda12298" class="">EBSæ˜¯persistent storage; Instance Storesæ˜¯non-persistent storage.</p><p id="ff6f1431-3c03-4237-88e2-72ae5247dbc4" class="">EBSæ˜¯åŸºäºç½‘ç»œçš„å—å­˜å‚¨; Instance Storageæ˜¯ç‰©ç†æœåŠ¡å™¨ä¸Šçš„ç‰©ç†å­˜å‚¨ï¼Œæä¾›äº†é«˜æ€§èƒ½</p><figure id="f7c4257f-d418-47b8-847c-5751572397f1" class="image"><a href="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2043.png"><img style="width:939px" src="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2043.png"/></a></figure></div></p><p id="a60f3bf9-22ac-43a4-b865-0d8d39821e7e" class=""><div class="indented"><figure id="ff7abdec-67c7-47fe-bbb5-ea5a8621037c" class="image"><a href="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2044.png"><img style="width:1412px" src="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2044.png"/></a></figure></div></p><p id="73cd90a0-81fd-4e68-94d2-cf6e86171c23" class=""><div class="indented"><figure id="aa271f93-1df4-4430-ae06-d8de5411e383" class="image"><a href="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2045.png"><img style="width:1321px" src="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2045.png"/></a></figure></div></p><p id="3a056829-718e-465b-8d08-dce5166b4b92" class="">Howï¼šEC2 â†’ Volumes</p><p id="9ffb34b3-082d-4cdd-bcbf-f2d933c3be0c" class="">QAï¼š<div class="indented"><ul id="3fecbcd4-a3dc-45c4-a527-d00a73dfe438" class="bulleted-list"><li style="list-style-type:disc">Diff between IOPS and Throughput â“<p id="064296f2-ed18-49a9-ac61-50864ba9bf29" class="">IO operations per second (IOPS) is a measure of how many IO requests can be completed by the storage device in a second. </p><p id="009ed6a5-8fcc-46e6-9ffc-2b865cec3dde" class="">Throughput is the measure of the amount of data transferred from/to a storage device in a second.</p></li></ul></div></p><p id="6c0d82cc-d4ae-4a47-80f9-7b24e643da83" class="">EBS Snapshot<div class="indented"><p id="1f16e38a-b696-4116-9139-737302e4111c" class="">What&amp;Why<div class="indented"><ul id="29d14ddd-6bb0-42d5-809a-83bf09769b42" class="bulleted-list"><li style="list-style-type:disc">For baseline(å°†RootVolumeçš„snapshotåšæˆAMI)or backup</li></ul><ul id="1ed32845-b6d8-4be8-b16a-aac84ababb34" class="bulleted-list"><li style="list-style-type:disc">the built-in way <mark class="highlight-red">taking backup of an EBS volume </mark>that backed up to a snapshot sit on a Amazon S3</li></ul><ul id="9a105da8-68e3-499b-9237-8a2640a83f4a" class="bulleted-list"><li style="list-style-type:disc">A snapshot is in a region not in an availability zone</li></ul><ul id="1ddd8074-0d40-45d5-82a5-4d325c556268" class="bulleted-list"><li style="list-style-type:disc">snapshots <em>incremental</em>Â backups</li></ul><figure id="acef4b27-8d7f-4238-a0e4-4b491439d403" class="image"><a href="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2046.png"><img style="width:983px" src="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2046.png"/></a></figure></div></p><p id="e8f96311-bf3c-4da2-ab0f-dd9776c57b04" class="">How to work<div class="indented"><ol type="1" id="a990d0ab-7c5f-48aa-a380-dfb348c9a78b" class="numbered-list" start="1"><li><strong>Relations among multiple snapshots of the same volume</strong><figure id="ca404260-b3a8-4fb0-97cf-50d1a6340ed3" class="image"><a href="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2047.png"><img style="width:432px" src="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2047.png"/></a></figure></li></ol><ol type="1" id="f2e11715-b3b8-415f-831b-df10e99b6745" class="numbered-list" start="2"><li><strong>Relations among incremental snapshots of different volumes</strong><figure id="7aa54484-609b-4ff2-9ea3-0e2491be2e91" class="image"><a href="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2048.png"><img style="width:432px" src="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2048.png"/></a></figure></li></ol><ul id="0fd31138-8e1d-4da8-99bb-cbc665ce8058" class="bulleted-list"><li style="list-style-type:disc">ç¬¬ä¸€ä¸ªå¿«ç…§(initial snapshots)æ˜¯å…¨å¤‡ï¼Œåç»­å¿«ç…§(subsequent snapshots)æ˜¯å¢é‡</li></ul><ul id="caa82ca9-dd3c-4f73-9925-d28adafcb1da" class="bulleted-list"><li style="list-style-type:disc">å¯ä»¥å¯¹attached volumeä½œsnapshotï¼Œä½†æ˜¯å› APPå¯èƒ½ç¼“å­˜æ•…å­˜åœ¨ä¿å­˜ä¸å®Œæ•´çš„é—®é¢˜ï¼Œæ‰€ä»¥å»ºè®®: å…ˆumount volumeå†ä½œsnapshotï¼Œåœ¨snapshotä¸ºpendingçŠ¶æ€æ—¶å†mountå³å¯.</li></ul><ul id="f16dc19b-e7fc-4fe5-9685-deccf8c3d39c" class="bulleted-list"><li style="list-style-type:disc">tag snapshotæ–¹ä¾¿ç®¡ç†</li></ul><ul id="5bee4e0d-9f37-4ebf-b7e9-5fb7ff70fbad" class="bulleted-list"><li style="list-style-type:disc">å¿«ç…§åŠ å¯†ï¼Œoriginal volume â†’ encrypted snapshot â†’ encrypted volume</li></ul><ul id="f54d4eb2-88f2-435b-aca7-811bcdd636ec" class="bulleted-list"><li style="list-style-type:disc">Multi-volume snapshots<ul id="44003b67-7b56-4313-a351-a93e2f1c58bd" class="bulleted-list"><li style="list-style-type:circle">å¯¹ä¸€ä¸ªå®ä¾‹ä¸Šæ‰€æœ‰attached volumesä½œå¿«ç…§åŠ¨ä½œï¼Œå¯æ­é…å®šæ—¶ä»»åŠ¡(å‚è€ƒ<a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/snapshot-lifecycle.html">https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/snapshot-lifecycle.html</a>)</li></ul><ul id="e497eda5-4a0e-4d40-bce7-ad73680d4260" class="bulleted-list"><li style="list-style-type:circle">ç”Ÿæˆç»“æœæ˜¯æ¯ä¸ªattached volumeséƒ½æœ‰å•ç‹¬çš„snapshot</li></ul><ul id="7cddad45-e614-46ea-8f51-063411d728cf" class="bulleted-list"><li style="list-style-type:circle">è¿™äº›å¿«ç…§ï¼Œä½œä¸ºä¸€ä¸ªæ•´ä½“è¿›è¡Œæ¢å¤</li></ul><ul id="b01e8fb3-26ab-4d50-aa95-e431aca17c34" class="bulleted-list"><li style="list-style-type:circle">å…¶ä¸­ä»»ä¸€å¿«ç…§failedï¼Œå…¶ä»–å¿«ç…§ä¹Ÿæ˜¾ç¤ºé”™è¯¯ï¼Œå¹¶ç”ŸæˆCloudWatch event<code>createSnapshots</code></li></ul><ul id="b61ddcb5-6bc8-4828-bdbe-5a61a50ac565" class="bulleted-list"><li style="list-style-type:circle">å¯æ‰‹åŠ¨æˆ–è‡ªåŠ¨æ‰§è¡Œå¿«ç…§</li></ul><ul id="e63ef7bb-615e-4438-90b0-b6f9acb3da21" class="bulleted-list"><li style="list-style-type:circle">Share an EBS snapshots<p id="98792ce7-6191-492b-b8d1-afc96c922dcb" class="">You can share a snapshot across AWS accounts by modifying its access permissions. You can make copies of your own snapshots as well as snapshots that have been shared with you.</p><p id="68550782-4970-47ba-b2fc-5480d6b8ba5c" class="">å‚è€ƒï¼š<a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ebs-modifying-snapshot-permissions.html">https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ebs-modifying-snapshot-permissions.html</a></p></li></ul><ul id="bdc0f405-4c2a-41d8-80e9-728eed50f7da" class="bulleted-list"><li style="list-style-type:circle">Copy an EBS snapshots<p id="ba4654be-31f0-4fd4-bfca-6265ed073589" class="">snapshotä½äºRegionä¸­ï¼Œå¯æ‹·è´åˆ°å…¶ä»–çš„Regionä¸­ï¼Œç”¨äºgeographical expansion, data center migration, and disaster recovery</p></li></ul></li></ul></div></p><p id="67a78e48-12e2-4c65-bddc-1cea736b40dc" class="">Operations<div class="indented"><ul id="a52b3332-7737-4c2e-a3c4-ed98e27e7190" class="bulleted-list"><li style="list-style-type:disc"></li></ul></div></p><p id="17321379-5e8b-410e-a67e-e466d9492ff0" class="">Best Practices<div class="indented"><ul id="00ceca8f-fe9b-479e-bf53-a904875f6230" class="bulleted-list"><li style="list-style-type:disc">è‹¥EBSæ˜¯bootï¼Œåˆ™snapshotå‰åº”å…³é—­ç³»ç»Ÿ</li></ul><ul id="838feb30-a08f-4836-ab15-6badf28a02cd" class="bulleted-list"><li style="list-style-type:disc">ä¸€ä¸ªvolumeï¼ŒåŒæ—¶å­˜åœ¨å¤šä¸ªå¤„äºpendingçš„snapshotï¼Œä¼šå½±å“è¯¥volumeçš„performance</li></ul><ul id="9cde1c9d-4813-4e67-850f-7476c250e82d" class="bulleted-list"><li style="list-style-type:disc">st1å’Œsc1ä»…èƒ½æœ‰ä¸€ä¸ªå¤„äºpendingçš„snapshotï¼Œè€Œå…¶ä»–å¯ä»¥åŒæ—¶æœ‰5ä¸ª</li></ul><ul id="2539d279-4b25-443f-ae8d-fff176bef59e" class="block-color-yellow bulleted-list"><li style="list-style-type:disc">When you create a snapshot for an EBS volume that serves as a root device, you should stop the instance before taking the snapshot.</li></ul><ul id="e1efc2d9-d63c-49cd-b877-245cb927ab2a" class="block-color-yellow bulleted-list"><li style="list-style-type:disc">You cannot create snapshots from instances for which hibernation is enabled.</li></ul><ul id="c345a875-a7e9-46ef-a574-b96640ffd07f" class="block-color-yellow bulleted-list"><li style="list-style-type:disc">You cannot create snapshots from hibernated instances.</li></ul></div></p></div></p></div></p></div></p></div></p><p id="f5bcd091-221c-4f49-b19d-30fc2de1f27c" class="">EFS<div class="indented"><figure id="0c42a82f-0775-4d61-b026-2939c98723ac" class="image"><a href="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2049.png"><img style="width:432px" src="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2049.png"/></a></figure><p id="080f7cf7-5428-458f-b201-f4608cd8f397" class="">What &amp; Why<div class="indented"><ul id="c81665e6-6763-487f-a740-8e1e79167f0a" class="bulleted-list"><li style="list-style-type:disc">You can use an EFS file system as a common data source for workloads and applications running on multiple instances.</li></ul><ul id="99462562-f367-42bf-81a1-30d66ac34fe1" class="bulleted-list"><li style="list-style-type:disc">Mount targets in each default subnet in the selected VPC, using the VPC&#x27;s default security group.<figure id="5a5a075d-3002-4228-bbe6-237a2f799e8e" class="image"><a href="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2050.png"><img style="width:1827px" src="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2050.png"/></a></figure></li></ul></div></p><p id="a712938b-b433-42c0-99ac-c32b959f6d8d" class="">Operation<div class="indented"><ul id="26a02bb2-cf44-4808-98f5-81a73df5a9fc" class="bulleted-list"><li style="list-style-type:disc">Create an EFS</li></ul><ul id="a1563f59-e987-4826-9349-dfd5476f341c" class="bulleted-list"><li style="list-style-type:disc">Add a inbound rule to allow the traffic to NFS from local security group<figure id="4c9c70c6-fed8-4b9e-b906-72dcb1c05530" class="image"><a href="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2051.png"><img style="width:854px" src="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2051.png"/></a></figure></li></ul><ul id="0f25195e-0efb-4755-86b7-c8cd475421a4" class="bulleted-list"><li style="list-style-type:disc">Attach EFS volume<pre id="efd5991d-2793-4fb3-aee0-9ac45dfb142f" class="code"><code>sudo yum install -y amazon-efs-utils
sudo mkdir /mnt/efs
sudo mount -t efs -o tls fs-0abf90350ea061b71:/ efs
sudo mount -t efs -o tls fs-0abf90350ea061b71:/ /mnt/efs/
#æ³¨æ„ï¼šè¿˜éœ€åœ¨/etc/fstabä¸­æ·»åŠ </code></pre></li></ul></div></p><p id="39e04ad4-fa0b-4af4-9534-6e9fd9076059" class="">
</p><p id="ecdbec00-2ae6-4181-9065-de9c69bffaf6" class="">
</p></div></p><p id="2ba882f0-f65e-4e59-9054-1e63098479dd" class="">EKS<div class="indented"><p id="97628b35-9a90-4096-b2f3-c94edf34bd61" class="">What<div class="indented"><ul id="90826442-9206-490f-8ee0-0016f5a434ea" class="bulleted-list"><li style="list-style-type:disc">Amazon Elastic Kubernetes Service (Amazon EKS)</li></ul></div></p></div></p><p id="4db64d77-cdbe-44df-854d-1980fc12e390" class="">
</p><p id="c4364fce-cdfa-454d-99b9-0d49c0f102ed" class="">AWS-CLI<div class="indented"><ul id="49248108-982c-4b02-9310-47edad1da027" class="bulleted-list"><li style="list-style-type:disc">Logout of AWS-CLI: <code>rm -rf ~/.aws/credentials</code></li></ul></div></p><p id="4a9acd58-936f-4769-942e-26a2a37dcae2" class="">
</p><h1 id="201b524b-e911-4e8a-a266-85c4e8bdaeef" class=""><time>@December 3, 2021</time> </h1><p id="df813bca-991c-4a92-a536-3044259ccce4" class=""><code>jq</code>å·¥å…·ä½¿ç”¨<div class="indented"><ul id="8c4052a8-cacc-4854-8c51-36494bce2909" class="bulleted-list"><li style="list-style-type:disc">ä½¿ç”¨jqæœç´¢Array<pre id="e7b6a08e-cb46-4965-887a-63b5ca27ec6e" class="code"><code>ä¾‹å­ï¼š
{
    &quot;ok&quot;: true,
    &quot;items&quot;: [
        {&quot;id&quot;: 123, &quot;name&quot;: &quot;thing-1&quot;},
        {&quot;id&quot;: 124, &quot;name&quot;: &quot;thing-2&quot;},
        {&quot;id&quot;: 125, &quot;name&quot;: &quot;thing-3&quot;}
    ]
}

		å‘½ä»¤ï¼š /.,mnbvcxz&#x27;;lkjfds;uytroiuytrewqpowq\]=-098765432 gv fdz `vcxzvcxzxx  xzrsaY6YUK?.,MN 1`
cat file.json | jq &#x27;.items[] | select(.name == &quot;thing-3&quot;)&#x27; 
  </code></pre></li></ul><ul id="3a8a952d-fb8a-4e3a-bd56-999ce242bb17" class="bulleted-list"><li style="list-style-type:disc"><code>aws-cli</code> ä¹Ÿæœ‰ç›¸ä¼¼çš„åŠŸèƒ½, è¿‡æ»¤å‡ºéœ€è¦çš„ä¿¡æ¯<pre id="68ba9b17-0d3f-4194-95a0-96ecc09db832" class="code"><code></code></pre></li></ul></div></p><p id="0ecb7223-87b1-41bd-a868-731663a234d3" class="">
</p><p id="90e6b173-4588-4abc-a2aa-82574668bdb0" class="">IAM<div class="indented"><figure id="7e6e7fed-dd39-4e83-b3a2-1d336cc009f0" class="image"><a href="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2052.png"><img style="width:588px" src="%E5%AD%A6%E4%B9%A0%E6%B5%81%E6%B0%B4%20262c3/Untitled%2052.png"/></a></figure></div></p><p id="0e6519ef-8d02-4aa7-88c3-60a760c7eb70" class="">
</p><ol type="1" id="33190758-a4e6-4ff3-b89f-60f3ba91b7d6" class="numbered-list" start="1"><li>Maven Pom Paren</li></ol><ol type="1" id="a3280616-b4b2-48c4-9b90-2ec7d0954b67" class="numbered-list" start="2"><li>CVE(Common Vulnerabilities and Exposure)</li></ol><ol type="1" id="7123ee90-8363-4a7d-b2ff-97e434f8d05a" class="numbered-list" start="3"><li>What is Image Hardening?</li></ol><ol type="1" id="4795454f-8468-4540-b846-5c9b75a44763" class="numbered-list" start="4"><li></li></ol><p id="1f9ccde9-7b55-4bf4-9ffc-901fbd60490f" class="">
</p></div></article></body></html>